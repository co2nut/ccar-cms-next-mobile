{"ast":null,"code":"var _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useEffect, useState } from 'react';\nimport { Row, Col, Table, Card, Button, Checkbox, Tabs, Select, message, Empty, Icon, Form } from 'antd';\nimport _ from 'lodash';\nimport client from '../../feathers';\nimport { connect } from 'react-redux';\nimport { notEmptyLength, removeNullFromArray } from '../../common-function';\nimport { fetchFeaturesList, updateCheckedFeaturesDate } from '../../redux/actions/productsList-actions';\nimport moment from 'moment';\nimport axios from 'axios';\nimport { withRouter } from 'next/router';\nimport { loading } from '../../redux/actions/app-actions';\nvar TabPane = Tabs.TabPane;\nvar Option = Select.Option;\nvar reviewContainerRef = React.createRef();\nvar RATINGPAGESIZE = 4;\nvar columns = [{\n  title: 'Category',\n  dataIndex: 'category',\n  key: 'category',\n  render: function render(text, row) {\n    if (row.field == 'skip') {\n      return {\n        children: __jsx(\"span\", null, __jsx(\"strong\", null, text)),\n        props: {\n          colSpan: 3\n        }\n      };\n    } else {\n      return {\n        children: __jsx(\"span\", null, text)\n      };\n    }\n  }\n}, {\n  title: 'Field',\n  dataIndex: 'field',\n  key: 'field',\n  render: function render(text, row) {\n    if (text == 'skip') {\n      return {\n        props: {\n          colSpan: 0\n        }\n      };\n    } else {\n      return {\n        children: __jsx(\"span\", null, text)\n      };\n    }\n  }\n}, {\n  title: 'Value',\n  dataIndex: 'value',\n  key: 'value',\n  render: function render(text, row) {\n    if (text == 'skip') {\n      return {\n        props: {\n          colSpan: 0\n        }\n      };\n    } else {\n      return {\n        children: __jsx(\"span\", null, text)\n      };\n    }\n  }\n}];\n\nvar KeyFeatures = function KeyFeatures(props) {\n  _s();\n\n  var _useState = useState(''),\n      id = _useState[0],\n      setId = _useState[1];\n\n  var _useState2 = useState(null),\n      companyId = _useState2[0],\n      setCompanyId = _useState2[1];\n\n  var _useState3 = useState({}),\n      productDetails = _useState3[0],\n      setProductDetails = _useState3[1];\n\n  var _useState4 = useState([]),\n      carSpecs = _useState4[0],\n      setCarSpecs = _useState4[1];\n\n  var _useState5 = useState([]),\n      expandedRow = _useState5[0],\n      setExpandedRow = _useState5[1];\n\n  var _useState6 = useState([]),\n      ratings = _useState6[0],\n      setRatings = _useState6[1];\n\n  var _useState7 = useState(1),\n      ratingPage = _useState7[0],\n      setRatingPage = _useState7[1];\n\n  var _useState8 = useState(0),\n      ratingTotal = _useState8[0],\n      setRatingTotal = _useState8[1];\n\n  var _useState9 = useState([]),\n      ownRating = _useState9[0],\n      setOwnRating = _useState9[1];\n\n  useEffect(function () {\n    if (props.productDetails._id != id) {\n      setId(props.productDetails._id);\n      setProductDetails(props.productDetails);\n      setCompanyId(props.productDetails.companys._id);\n\n      var uniqSpec = _.uniqBy(props.productDetails.carspecsAll.specification, 'category');\n\n      var cloneUniqSpec = _.cloneDeep(uniqSpec);\n\n      uniqSpec.map(function (v, i) {\n        cloneUniqSpec[i].key = i;\n        cloneUniqSpec[i].children = [];\n        cloneUniqSpec[i].field = 'skip';\n        cloneUniqSpec[i].value = 'skip';\n        props.productDetails.carspecsAll.specification.map(function (v1, i1) {\n          if (v1.category == v.category) {\n            cloneUniqSpec[i].children.push({\n              key: i + '' + i1,\n              field: v1.field,\n              value: v1.value\n            });\n          }\n        });\n      });\n      setCarSpecs(cloneUniqSpec);\n    }\n  });\n  useEffect(function () {\n    if (!props.productsList.checkedFeaturesDate || moment(props.productsList.checkedFeaturesDate).isBefore(moment(), 'day')) {\n      // props.loading(true);\n      axios.get(\"\".concat(client.io.io.uri, \"getFeatureList\")).then(function (res) {\n        props.loading(false);\n        props.fetchFeaturesList(res.data.data);\n        props.updateCheckedFeaturesDate(moment());\n      })[\"catch\"](function (err) {\n        props.loading(false);\n        message.error(err.message);\n      });\n    }\n  }, []);\n  useEffect(function () {\n    getRatings(0);\n  }, [productDetails]);\n  useEffect(function () {\n    getRatings((ratingPage - 1) * RATINGPAGESIZE);\n  }, [ratingPage]);\n  useEffect(function () {\n    init();\n  }, [productDetails, props.user]);\n\n  function init() {\n    setRatingPage(1);\n    setRatingTotal(0);\n    getRatings(0);\n    getOwnRating();\n  }\n\n  function getRatings(skip) {\n    if (productDetails._id) {\n      var query = {\n        productId: productDetails._id,\n        type: 'product',\n        $populate: [{\n          path: 'companyId',\n          ref: 'companys'\n        }, {\n          path: 'reviewerId',\n          ref: 'users'\n        }],\n        $limit: RATINGPAGESIZE,\n        $skip: skip\n      };\n\n      if (props.user.authenticated) {\n        query.reviewerId = {\n          $ne: props.user.info.user._id\n        };\n        query[\"hideBy.userId\"] = {\n          $ne: props.user.info.user._id\n        };\n      } // props.loading(true);\n\n\n      client.service('rating').find({\n        query: query\n      }).then(function (res) {\n        props.loading(false);\n\n        if (notEmptyLength(res.data)) {\n          var data = ratings.concat(res.data);\n          setRatingTotal(res.total);\n          setRatings(data);\n        }\n      })[\"catch\"](function (err) {\n        props.loading(false);\n        message.error(err.message);\n      });\n    } else {\n      setRatings([]);\n    }\n  }\n\n  function getOwnRating() {\n    if (productDetails._id && props.user.authenticated) {\n      // props.loading(true);\n      client.service('rating').find({\n        query: {\n          productId: productDetails._id,\n          reviewerId: props.user.info.user._id,\n          $populate: [{\n            path: 'companyId',\n            ref: 'companys'\n          }, {\n            path: 'reviewerId',\n            ref: 'users'\n          }],\n          $limit: 1\n        }\n      }).then(function (res) {\n        props.loading(false);\n\n        if (notEmptyLength(res.data)) {\n          setOwnRating(res.data);\n        } else {\n          setOwnRating([]);\n        }\n      })[\"catch\"](function (err) {\n        props.loading(false);\n        message.error(err.message);\n      });\n    } else {\n      setOwnRating([]);\n    }\n  }\n\n  var _renderFeatures = function _renderFeatures(data) {\n    if (notEmptyLength(props.productsList.featuresList) && notEmptyLength(data)) {\n      var temp = _.filter(props.productsList.featuresList, function (item) {\n        return _.includes(data, item.value);\n      });\n\n      if (notEmptyLength(temp)) {\n        var list = temp.map(function (item) {\n          return __jsx(Col, {\n            span: 12\n          }, __jsx(\"div\", {\n            className: \"flex-justify-start flex-items-align-center padding-x-sm fill-parent \"\n          }, __jsx(\"span\", {\n            className: \"margin-x-sm relative-wrapper\",\n            style: {\n              height: \"30px\",\n              width: '30px'\n            }\n          }, __jsx(\"img\", {\n            src: item.icon ? item.icon : null,\n            className: \"fill-parent absolute-center\"\n          })), __jsx(\"span\", {\n            className: \"padding-sm headline flex-justify-center flex-items-align-center text-truncate-threeline\"\n          }, item.text ? item.text : null)));\n        });\n        return __jsx(Row, {\n          type: \"flex\",\n          align: \"middle\",\n          gutter: [10, 10]\n        }, list);\n      } else {\n        return __jsx(Empty, {\n          style: {\n            position: 'relative',\n            top: '50%',\n            transform: 'translateY(-50%)'\n          },\n          image: \"/empty.png\",\n          imageStyle: {\n            height: 60\n          },\n          description: __jsx(\"span\", null, \"No Result\")\n        });\n      }\n    } else {\n      return __jsx(Empty, {\n        style: {\n          position: 'relative',\n          top: '50%',\n          transform: 'translateY(-50%)'\n        },\n        image: \"/empty.png\",\n        imageStyle: {\n          height: 60\n        },\n        description: __jsx(\"span\", null, \"No Result\")\n      });\n    }\n  };\n\n  return __jsx(\"div\", null, _renderFeatures(productDetails.features));\n};\n\n_s(KeyFeatures, \"iMv74bcEJUetRU2UIo5WdWlTzfQ=\");\n\n_c = KeyFeatures;\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    user: state.user,\n    productsList: state.productsList\n  };\n};\n\nvar mapDispatchToProps = {\n  loading: loading,\n  fetchFeaturesList: fetchFeaturesList,\n  updateCheckedFeaturesDate: updateCheckedFeaturesDate\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(Form.create()(withRouter(KeyFeatures)));\n\nvar _c;\n\n$RefreshReg$(_c, \"KeyFeatures\");","map":{"version":3,"sources":["/Users/faraheen/ccar-cms-next-mobile/components/product-list/key-features.jsx"],"names":["React","useEffect","useState","Row","Col","Table","Card","Button","Checkbox","Tabs","Select","message","Empty","Icon","Form","_","client","connect","notEmptyLength","removeNullFromArray","fetchFeaturesList","updateCheckedFeaturesDate","moment","axios","withRouter","loading","TabPane","Option","reviewContainerRef","createRef","RATINGPAGESIZE","columns","title","dataIndex","key","render","text","row","field","children","props","colSpan","KeyFeatures","id","setId","companyId","setCompanyId","productDetails","setProductDetails","carSpecs","setCarSpecs","expandedRow","setExpandedRow","ratings","setRatings","ratingPage","setRatingPage","ratingTotal","setRatingTotal","ownRating","setOwnRating","_id","companys","uniqSpec","uniqBy","carspecsAll","specification","cloneUniqSpec","cloneDeep","map","v","i","value","v1","i1","category","push","productsList","checkedFeaturesDate","isBefore","get","io","uri","then","res","data","err","error","getRatings","init","user","getOwnRating","skip","query","productId","type","$populate","path","ref","$limit","$skip","authenticated","reviewerId","$ne","info","service","find","concat","total","_renderFeatures","featuresList","temp","filter","item","includes","list","height","width","icon","position","top","transform","features","mapStateToProps","state","mapDispatchToProps","create"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Row, Col, Table, Card, Button, Checkbox, Tabs, Select, message, Empty, Icon, Form } from 'antd';\nimport _ from 'lodash';\nimport client from '../../feathers'\nimport { connect } from 'react-redux';\nimport { notEmptyLength, removeNullFromArray } from '../../common-function';\nimport { fetchFeaturesList, updateCheckedFeaturesDate } from '../../redux/actions/productsList-actions';\nimport moment from 'moment';\nimport axios from 'axios';\nimport { withRouter } from 'next/router';\nimport { loading } from '../../redux/actions/app-actions';\n\nconst { TabPane } = Tabs;\nconst { Option } = Select;\nconst reviewContainerRef = React.createRef();\n\nconst RATINGPAGESIZE = 4;\n\nconst columns = [\n    {\n        title: 'Category',\n        dataIndex: 'category',\n        key: 'category',\n        render: (text, row) => {\n            if (row.field == 'skip') {\n                return {\n                    children: <span><strong>{text}</strong></span>,\n                    props: {\n                        colSpan: 3,\n                    },\n                };\n            } else {\n                return {\n                    children: <span>{text}</span>,\n                };\n            }\n        },\n    },\n    {\n        title: 'Field',\n        dataIndex: 'field',\n        key: 'field',\n        render: (text, row) => {\n            if (text == 'skip') {\n                return {\n                    props: {\n                        colSpan: 0,\n                    },\n                };\n            } else {\n                return {\n                    children: <span>{text}</span>,\n                };\n            }\n        },\n    },\n    {\n        title: 'Value',\n        dataIndex: 'value',\n        key: 'value',\n        render: (text, row) => {\n            if (text == 'skip') {\n                return {\n                    props: {\n                        colSpan: 0,\n                    },\n                };\n            } else {\n                return {\n                    children: <span>{text}</span>,\n                };\n            }\n        },\n    },\n];\n\nconst KeyFeatures = (props) => {\n    const [id, setId] = useState('')\n    const [companyId, setCompanyId] = useState(null)\n    const [productDetails, setProductDetails] = useState({})\n    const [carSpecs, setCarSpecs] = useState([])\n    const [expandedRow, setExpandedRow] = useState([])\n    const [ratings, setRatings] = useState([])\n    const [ratingPage, setRatingPage] = useState(1)\n    const [ratingTotal, setRatingTotal] = useState(0)\n    const [ownRating, setOwnRating] = useState([])\n\n    useEffect(() => {\n        if (props.productDetails._id != id) {\n            setId(props.productDetails._id)\n            setProductDetails(props.productDetails)\n            setCompanyId(props.productDetails.companys._id)\n\n            let uniqSpec = _.uniqBy(props.productDetails.carspecsAll.specification, 'category')\n            let cloneUniqSpec = _.cloneDeep(uniqSpec)\n            uniqSpec.map((v, i) => {\n                cloneUniqSpec[i].key = i\n                cloneUniqSpec[i].children = []\n                cloneUniqSpec[i].field = 'skip'\n                cloneUniqSpec[i].value = 'skip'\n                props.productDetails.carspecsAll.specification.map((v1, i1) => {\n                    if (v1.category == v.category) {\n                        cloneUniqSpec[i].children.push({ key: i + '' + i1, field: v1.field, value: v1.value })\n                    }\n                })\n            })\n \n            setCarSpecs(cloneUniqSpec)\n        }\n    })\n\n    useEffect(() => {\n\n        if (!props.productsList.checkedFeaturesDate || moment(props.productsList.checkedFeaturesDate).isBefore(moment(), 'day')) {\n            // props.loading(true);\n            axios.get(`${client.io.io.uri}getFeatureList`).then(res => {\n                props.loading(false);\n                props.fetchFeaturesList(res.data.data);\n                props.updateCheckedFeaturesDate(moment());\n            }).catch(err => {\n            props.loading(false);\n            message.error(err.message)\n            });\n        }\n    }, []);\n\n    useEffect(() => {\n        getRatings(0);\n    }, [productDetails])\n\n\n    useEffect(() => {\n\n        getRatings((ratingPage - 1) * RATINGPAGESIZE);\n    }, [ratingPage])\n\n\n    useEffect(() => {\n        init();\n    }, [productDetails, props.user])\n\n\n\n    function init() {\n        setRatingPage(1);\n        setRatingTotal(0);\n        getRatings(0);\n        getOwnRating();\n    }\n\n    function getRatings(skip) {\n        if (productDetails._id) {\n\n            let query = {\n                productId: productDetails._id,\n                type : 'product',\n                $populate: [\n                    {\n                        path: 'companyId',\n                        ref: 'companys'\n                    },\n                    {\n                        path: 'reviewerId',\n                        ref: 'users'\n                    }\n                ],\n                $limit: RATINGPAGESIZE,\n                $skip: skip,\n            }\n\n            if (props.user.authenticated) {\n                query.reviewerId = {\n                    $ne: props.user.info.user._id,\n                }\n\n                query[\"hideBy.userId\"] = {\n                    $ne: props.user.info.user._id,\n                }\n            }\n            // props.loading(true);\n            client.service('rating').find({\n                query\n            }).then((res) => {\n                props.loading(false);\n                if (notEmptyLength(res.data)) {\n                    let data = ratings.concat(res.data);\n                    setRatingTotal(res.total);\n                    setRatings(data);\n                }\n            })\n                .catch((err) => {\n                    props.loading(false);\n                    message.error(err.message);\n                })\n        } else {\n            setRatings([]);\n        }\n    }\n\n\n\n    function getOwnRating() {\n        if (productDetails._id && props.user.authenticated) {\n\n            // props.loading(true);\n            client.service('rating').find({\n                query: {\n                    productId: productDetails._id,\n                    reviewerId: props.user.info.user._id,\n                    $populate: [\n                        {\n                            path: 'companyId',\n                            ref: 'companys'\n                        },\n                        {\n                            path: 'reviewerId',\n                            ref: 'users'\n                        }\n                    ],\n                    $limit: 1,\n                }\n\n            }).then((res) => {\n                props.loading(false);\n                if (notEmptyLength(res.data)) {\n                    setOwnRating(res.data);\n                } else {\n                    setOwnRating([]);\n                }\n            })\n                .catch((err) => {\n                    props.loading(false);\n                    message.error(err.message);\n                })\n        } else {\n            setOwnRating([]);\n        }\n    }\n\n    const _renderFeatures = (data) => {\n        if (notEmptyLength(props.productsList.featuresList) && notEmptyLength(data)) {\n            let temp = _.filter(props.productsList.featuresList, function (item) {\n                return _.includes(data, item.value);\n            })\n            if (notEmptyLength(temp)) {\n\n                let list = temp.map(function (item) {\n                    return (\n                        <Col span={12}>\n                            <div className=\"flex-justify-start flex-items-align-center padding-x-sm fill-parent \">\n                            {/* <div className=\"round-border wrapBorderRed\" style={{width:'50px', height:'50px'}}> */}\n                                <span className=\"margin-x-sm relative-wrapper\" style={{ height: \"30px\", width: '30px' }}>\n                                    <img src={item.icon ? item.icon : null} className=\"fill-parent absolute-center\" />\n                                </span>\n                            {/* </div> */}\n                                <span className=\"padding-sm headline flex-justify-center flex-items-align-center text-truncate-threeline\">\n                                    {item.text ? item.text : null}\n                                </span>\n                            </div>\n                        </Col>\n                    );\n                })\n\n                return (\n                    <Row type=\"flex\" align=\"middle\" gutter={[10, 10]}>\n                        {list}\n                    </Row>\n                )\n            }else{\n                return <Empty\n                style={{ position: 'relative', top: '50%', transform: 'translateY(-50%)' }}\n                image=\"/empty.png\"\n                imageStyle={{\n                    height: 60,\n                }\n                }\n                description={\n                    <span>\n                        No Result\n            </span>\n                }\n            >\n            </Empty>\n            }\n\n\n        } else {\n\n            return <Empty\n                style={{ position: 'relative', top: '50%', transform: 'translateY(-50%)' }}\n                image=\"/empty.png\"\n                imageStyle={{\n                    height: 60,\n                }\n                }\n                description={\n                    <span>\n                        No Result\n            </span>\n                }\n            >\n            </Empty>\n        }\n    }\n\n    return (\n        <div>\n            {_renderFeatures(productDetails.features)}\n        </div >\n    );\n}\n\nconst mapStateToProps = state => ({\n    user: state.user,\n    productsList: state.productsList,\n});\n\nconst mapDispatchToProps = {\n    loading:loading,\n    fetchFeaturesList: fetchFeaturesList,\n    updateCheckedFeaturesDate: updateCheckedFeaturesDate,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Form.create()(withRouter(KeyFeatures)));"]},"metadata":{},"sourceType":"module"}