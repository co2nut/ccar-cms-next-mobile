{"ast":null,"code":"var __jsx = React.createElement;\nimport React, { useEffect, useState } from 'react';\nimport { Row, Col, Table, Card, Button, Checkbox, Tabs, Select, message, Empty, Icon, Form } from 'antd';\nimport _ from 'lodash';\nimport client from '../../feathers';\nimport { connect } from 'react-redux';\nimport { notEmptyLength, removeNullFromArray } from '../../common-function';\nimport { fetchFeaturesList, updateCheckedFeaturesDate } from '../../redux/actions/productsList-actions';\nimport moment from 'moment';\nimport axios from 'axios';\nimport { withRouter } from 'next/router';\nimport { loading } from '../../redux/actions/app-actions';\nconst {\n  TabPane\n} = Tabs;\nconst {\n  Option\n} = Select;\nconst reviewContainerRef = React.createRef();\nconst RATINGPAGESIZE = 4;\nconst columns = [{\n  title: 'Category',\n  dataIndex: 'category',\n  key: 'category',\n  render: (text, row) => {\n    if (row.field == 'skip') {\n      return {\n        children: __jsx(\"span\", null, __jsx(\"strong\", null, text)),\n        props: {\n          colSpan: 3\n        }\n      };\n    } else {\n      return {\n        children: __jsx(\"span\", null, text)\n      };\n    }\n  }\n}, {\n  title: 'Field',\n  dataIndex: 'field',\n  key: 'field',\n  render: (text, row) => {\n    if (text == 'skip') {\n      return {\n        props: {\n          colSpan: 0\n        }\n      };\n    } else {\n      return {\n        children: __jsx(\"span\", null, text)\n      };\n    }\n  }\n}, {\n  title: 'Value',\n  dataIndex: 'value',\n  key: 'value',\n  render: (text, row) => {\n    if (text == 'skip') {\n      return {\n        props: {\n          colSpan: 0\n        }\n      };\n    } else {\n      return {\n        children: __jsx(\"span\", null, text)\n      };\n    }\n  }\n}];\n\nconst KeyFeatures = props => {\n  const {\n    0: id,\n    1: setId\n  } = useState('');\n  const {\n    0: companyId,\n    1: setCompanyId\n  } = useState(null);\n  const {\n    0: productDetails,\n    1: setProductDetails\n  } = useState({});\n  const {\n    0: carSpecs,\n    1: setCarSpecs\n  } = useState([]);\n  const {\n    0: expandedRow,\n    1: setExpandedRow\n  } = useState([]);\n  const {\n    0: ratings,\n    1: setRatings\n  } = useState([]);\n  const {\n    0: ratingPage,\n    1: setRatingPage\n  } = useState(1);\n  const {\n    0: ratingTotal,\n    1: setRatingTotal\n  } = useState(0);\n  const {\n    0: ownRating,\n    1: setOwnRating\n  } = useState([]);\n  useEffect(() => {\n    if (props.productDetails._id != id) {\n      setId(props.productDetails._id);\n      setProductDetails(props.productDetails);\n      setCompanyId(props.productDetails.companys._id);\n\n      let uniqSpec = _.uniqBy(props.productDetails.carspecsAll.specification, 'category');\n\n      let cloneUniqSpec = _.cloneDeep(uniqSpec);\n\n      uniqSpec.map((v, i) => {\n        cloneUniqSpec[i].key = i;\n        cloneUniqSpec[i].children = [];\n        cloneUniqSpec[i].field = 'skip';\n        cloneUniqSpec[i].value = 'skip';\n        props.productDetails.carspecsAll.specification.map((v1, i1) => {\n          if (v1.category == v.category) {\n            cloneUniqSpec[i].children.push({\n              key: i + '' + i1,\n              field: v1.field,\n              value: v1.value\n            });\n          }\n        });\n      });\n      setCarSpecs(cloneUniqSpec);\n    }\n  });\n  useEffect(() => {\n    if (!props.productsList.checkedFeaturesDate || moment(props.productsList.checkedFeaturesDate).isBefore(moment(), 'day')) {\n      // props.loading(true);\n      axios.get(`${client.io.io.uri}getFeatureList`).then(res => {\n        props.loading(false);\n        props.fetchFeaturesList(res.data.data);\n        props.updateCheckedFeaturesDate(moment());\n      }).catch(err => {\n        props.loading(false);\n        message.error(err.message);\n      });\n    }\n  }, []);\n  useEffect(() => {\n    getRatings(0);\n  }, [productDetails]);\n  useEffect(() => {\n    getRatings((ratingPage - 1) * RATINGPAGESIZE);\n  }, [ratingPage]);\n  useEffect(() => {\n    init();\n  }, [productDetails, props.user]);\n\n  function init() {\n    setRatingPage(1);\n    setRatingTotal(0);\n    getRatings(0);\n    getOwnRating();\n  }\n\n  function getRatings(skip) {\n    if (productDetails._id) {\n      let query = {\n        productId: productDetails._id,\n        type: 'product',\n        $populate: [{\n          path: 'companyId',\n          ref: 'companys'\n        }, {\n          path: 'reviewerId',\n          ref: 'users'\n        }],\n        $limit: RATINGPAGESIZE,\n        $skip: skip\n      };\n\n      if (props.user.authenticated) {\n        query.reviewerId = {\n          $ne: props.user.info.user._id\n        };\n        query[\"hideBy.userId\"] = {\n          $ne: props.user.info.user._id\n        };\n      } // props.loading(true);\n\n\n      client.service('rating').find({\n        query\n      }).then(res => {\n        props.loading(false);\n\n        if (notEmptyLength(res.data)) {\n          let data = ratings.concat(res.data);\n          setRatingTotal(res.total);\n          setRatings(data);\n        }\n      }).catch(err => {\n        props.loading(false);\n        message.error(err.message);\n      });\n    } else {\n      setRatings([]);\n    }\n  }\n\n  function getOwnRating() {\n    if (productDetails._id && props.user.authenticated) {\n      // props.loading(true);\n      client.service('rating').find({\n        query: {\n          productId: productDetails._id,\n          reviewerId: props.user.info.user._id,\n          $populate: [{\n            path: 'companyId',\n            ref: 'companys'\n          }, {\n            path: 'reviewerId',\n            ref: 'users'\n          }],\n          $limit: 1\n        }\n      }).then(res => {\n        props.loading(false);\n\n        if (notEmptyLength(res.data)) {\n          setOwnRating(res.data);\n        } else {\n          setOwnRating([]);\n        }\n      }).catch(err => {\n        props.loading(false);\n        message.error(err.message);\n      });\n    } else {\n      setOwnRating([]);\n    }\n  }\n\n  const _renderFeatures = data => {\n    if (notEmptyLength(props.productsList.featuresList) && notEmptyLength(data)) {\n      let temp = _.filter(props.productsList.featuresList, function (item) {\n        return _.includes(data, item.value);\n      });\n\n      if (notEmptyLength(temp)) {\n        let list = temp.map(function (item) {\n          return __jsx(Col, {\n            span: 12\n          }, __jsx(\"div\", {\n            className: \"flex-justify-start flex-items-align-center padding-x-sm fill-parent \"\n          }, __jsx(\"span\", {\n            className: \"margin-x-sm relative-wrapper\",\n            style: {\n              height: \"30px\",\n              width: '30px'\n            }\n          }, __jsx(\"img\", {\n            src: item.icon ? item.icon : null,\n            className: \"fill-parent absolute-center\"\n          })), __jsx(\"span\", {\n            className: \"padding-sm headline flex-justify-center flex-items-align-center text-truncate-threeline\"\n          }, item.text ? item.text : null)));\n        });\n        return __jsx(Row, {\n          type: \"flex\",\n          align: \"middle\",\n          gutter: [10, 10]\n        }, list);\n      } else {\n        return __jsx(Empty, {\n          style: {\n            position: 'relative',\n            top: '50%',\n            transform: 'translateY(-50%)'\n          },\n          image: \"/empty.png\",\n          imageStyle: {\n            height: 60\n          },\n          description: __jsx(\"span\", null, \"No Result\")\n        });\n      }\n    } else {\n      return __jsx(Empty, {\n        style: {\n          position: 'relative',\n          top: '50%',\n          transform: 'translateY(-50%)'\n        },\n        image: \"/empty.png\",\n        imageStyle: {\n          height: 60\n        },\n        description: __jsx(\"span\", null, \"No Result\")\n      });\n    }\n  };\n\n  return __jsx(\"div\", null, _renderFeatures(productDetails.features));\n};\n\nconst mapStateToProps = state => ({\n  user: state.user,\n  productsList: state.productsList\n});\n\nconst mapDispatchToProps = {\n  loading: loading,\n  fetchFeaturesList: fetchFeaturesList,\n  updateCheckedFeaturesDate: updateCheckedFeaturesDate\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(Form.create()(withRouter(KeyFeatures)));","map":{"version":3,"sources":["/Users/faraheen/ccar-cms-next-mobile/components/product-list/key-features.jsx"],"names":["React","useEffect","useState","Row","Col","Table","Card","Button","Checkbox","Tabs","Select","message","Empty","Icon","Form","_","client","connect","notEmptyLength","removeNullFromArray","fetchFeaturesList","updateCheckedFeaturesDate","moment","axios","withRouter","loading","TabPane","Option","reviewContainerRef","createRef","RATINGPAGESIZE","columns","title","dataIndex","key","render","text","row","field","children","props","colSpan","KeyFeatures","id","setId","companyId","setCompanyId","productDetails","setProductDetails","carSpecs","setCarSpecs","expandedRow","setExpandedRow","ratings","setRatings","ratingPage","setRatingPage","ratingTotal","setRatingTotal","ownRating","setOwnRating","_id","companys","uniqSpec","uniqBy","carspecsAll","specification","cloneUniqSpec","cloneDeep","map","v","i","value","v1","i1","category","push","productsList","checkedFeaturesDate","isBefore","get","io","uri","then","res","data","catch","err","error","getRatings","init","user","getOwnRating","skip","query","productId","type","$populate","path","ref","$limit","$skip","authenticated","reviewerId","$ne","info","service","find","concat","total","_renderFeatures","featuresList","temp","filter","item","includes","list","height","width","icon","position","top","transform","features","mapStateToProps","state","mapDispatchToProps","create"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Row, Col, Table, Card, Button, Checkbox, Tabs, Select, message, Empty, Icon, Form } from 'antd';\nimport _ from 'lodash';\nimport client from '../../feathers'\nimport { connect } from 'react-redux';\nimport { notEmptyLength, removeNullFromArray } from '../../common-function';\nimport { fetchFeaturesList, updateCheckedFeaturesDate } from '../../redux/actions/productsList-actions';\nimport moment from 'moment';\nimport axios from 'axios';\nimport { withRouter } from 'next/router';\nimport { loading } from '../../redux/actions/app-actions';\n\nconst { TabPane } = Tabs;\nconst { Option } = Select;\nconst reviewContainerRef = React.createRef();\n\nconst RATINGPAGESIZE = 4;\n\nconst columns = [\n    {\n        title: 'Category',\n        dataIndex: 'category',\n        key: 'category',\n        render: (text, row) => {\n            if (row.field == 'skip') {\n                return {\n                    children: <span><strong>{text}</strong></span>,\n                    props: {\n                        colSpan: 3,\n                    },\n                };\n            } else {\n                return {\n                    children: <span>{text}</span>,\n                };\n            }\n        },\n    },\n    {\n        title: 'Field',\n        dataIndex: 'field',\n        key: 'field',\n        render: (text, row) => {\n            if (text == 'skip') {\n                return {\n                    props: {\n                        colSpan: 0,\n                    },\n                };\n            } else {\n                return {\n                    children: <span>{text}</span>,\n                };\n            }\n        },\n    },\n    {\n        title: 'Value',\n        dataIndex: 'value',\n        key: 'value',\n        render: (text, row) => {\n            if (text == 'skip') {\n                return {\n                    props: {\n                        colSpan: 0,\n                    },\n                };\n            } else {\n                return {\n                    children: <span>{text}</span>,\n                };\n            }\n        },\n    },\n];\n\nconst KeyFeatures = (props) => {\n    const [id, setId] = useState('')\n    const [companyId, setCompanyId] = useState(null)\n    const [productDetails, setProductDetails] = useState({})\n    const [carSpecs, setCarSpecs] = useState([])\n    const [expandedRow, setExpandedRow] = useState([])\n    const [ratings, setRatings] = useState([])\n    const [ratingPage, setRatingPage] = useState(1)\n    const [ratingTotal, setRatingTotal] = useState(0)\n    const [ownRating, setOwnRating] = useState([])\n\n    useEffect(() => {\n        if (props.productDetails._id != id) {\n            setId(props.productDetails._id)\n            setProductDetails(props.productDetails)\n            setCompanyId(props.productDetails.companys._id)\n\n            let uniqSpec = _.uniqBy(props.productDetails.carspecsAll.specification, 'category')\n            let cloneUniqSpec = _.cloneDeep(uniqSpec)\n            uniqSpec.map((v, i) => {\n                cloneUniqSpec[i].key = i\n                cloneUniqSpec[i].children = []\n                cloneUniqSpec[i].field = 'skip'\n                cloneUniqSpec[i].value = 'skip'\n                props.productDetails.carspecsAll.specification.map((v1, i1) => {\n                    if (v1.category == v.category) {\n                        cloneUniqSpec[i].children.push({ key: i + '' + i1, field: v1.field, value: v1.value })\n                    }\n                })\n            })\n \n            setCarSpecs(cloneUniqSpec)\n        }\n    })\n\n    useEffect(() => {\n\n        if (!props.productsList.checkedFeaturesDate || moment(props.productsList.checkedFeaturesDate).isBefore(moment(), 'day')) {\n            // props.loading(true);\n            axios.get(`${client.io.io.uri}getFeatureList`).then(res => {\n                props.loading(false);\n                props.fetchFeaturesList(res.data.data);\n                props.updateCheckedFeaturesDate(moment());\n            }).catch(err => {\n            props.loading(false);\n            message.error(err.message)\n            });\n        }\n    }, []);\n\n    useEffect(() => {\n        getRatings(0);\n    }, [productDetails])\n\n\n    useEffect(() => {\n\n        getRatings((ratingPage - 1) * RATINGPAGESIZE);\n    }, [ratingPage])\n\n\n    useEffect(() => {\n        init();\n    }, [productDetails, props.user])\n\n\n\n    function init() {\n        setRatingPage(1);\n        setRatingTotal(0);\n        getRatings(0);\n        getOwnRating();\n    }\n\n    function getRatings(skip) {\n        if (productDetails._id) {\n\n            let query = {\n                productId: productDetails._id,\n                type : 'product',\n                $populate: [\n                    {\n                        path: 'companyId',\n                        ref: 'companys'\n                    },\n                    {\n                        path: 'reviewerId',\n                        ref: 'users'\n                    }\n                ],\n                $limit: RATINGPAGESIZE,\n                $skip: skip,\n            }\n\n            if (props.user.authenticated) {\n                query.reviewerId = {\n                    $ne: props.user.info.user._id,\n                }\n\n                query[\"hideBy.userId\"] = {\n                    $ne: props.user.info.user._id,\n                }\n            }\n            // props.loading(true);\n            client.service('rating').find({\n                query\n            }).then((res) => {\n                props.loading(false);\n                if (notEmptyLength(res.data)) {\n                    let data = ratings.concat(res.data);\n                    setRatingTotal(res.total);\n                    setRatings(data);\n                }\n            })\n                .catch((err) => {\n                    props.loading(false);\n                    message.error(err.message);\n                })\n        } else {\n            setRatings([]);\n        }\n    }\n\n\n\n    function getOwnRating() {\n        if (productDetails._id && props.user.authenticated) {\n\n            // props.loading(true);\n            client.service('rating').find({\n                query: {\n                    productId: productDetails._id,\n                    reviewerId: props.user.info.user._id,\n                    $populate: [\n                        {\n                            path: 'companyId',\n                            ref: 'companys'\n                        },\n                        {\n                            path: 'reviewerId',\n                            ref: 'users'\n                        }\n                    ],\n                    $limit: 1,\n                }\n\n            }).then((res) => {\n                props.loading(false);\n                if (notEmptyLength(res.data)) {\n                    setOwnRating(res.data);\n                } else {\n                    setOwnRating([]);\n                }\n            })\n                .catch((err) => {\n                    props.loading(false);\n                    message.error(err.message);\n                })\n        } else {\n            setOwnRating([]);\n        }\n    }\n\n    const _renderFeatures = (data) => {\n        if (notEmptyLength(props.productsList.featuresList) && notEmptyLength(data)) {\n            let temp = _.filter(props.productsList.featuresList, function (item) {\n                return _.includes(data, item.value);\n            })\n            if (notEmptyLength(temp)) {\n\n                let list = temp.map(function (item) {\n                    return (\n                        <Col span={12}>\n                            <div className=\"flex-justify-start flex-items-align-center padding-x-sm fill-parent \">\n                            {/* <div className=\"round-border wrapBorderRed\" style={{width:'50px', height:'50px'}}> */}\n                                <span className=\"margin-x-sm relative-wrapper\" style={{ height: \"30px\", width: '30px' }}>\n                                    <img src={item.icon ? item.icon : null} className=\"fill-parent absolute-center\" />\n                                </span>\n                            {/* </div> */}\n                                <span className=\"padding-sm headline flex-justify-center flex-items-align-center text-truncate-threeline\">\n                                    {item.text ? item.text : null}\n                                </span>\n                            </div>\n                        </Col>\n                    );\n                })\n\n                return (\n                    <Row type=\"flex\" align=\"middle\" gutter={[10, 10]}>\n                        {list}\n                    </Row>\n                )\n            }else{\n                return <Empty\n                style={{ position: 'relative', top: '50%', transform: 'translateY(-50%)' }}\n                image=\"/empty.png\"\n                imageStyle={{\n                    height: 60,\n                }\n                }\n                description={\n                    <span>\n                        No Result\n            </span>\n                }\n            >\n            </Empty>\n            }\n\n\n        } else {\n\n            return <Empty\n                style={{ position: 'relative', top: '50%', transform: 'translateY(-50%)' }}\n                image=\"/empty.png\"\n                imageStyle={{\n                    height: 60,\n                }\n                }\n                description={\n                    <span>\n                        No Result\n            </span>\n                }\n            >\n            </Empty>\n        }\n    }\n\n    return (\n        <div>\n            {_renderFeatures(productDetails.features)}\n        </div >\n    );\n}\n\nconst mapStateToProps = state => ({\n    user: state.user,\n    productsList: state.productsList,\n});\n\nconst mapDispatchToProps = {\n    loading:loading,\n    fetchFeaturesList: fetchFeaturesList,\n    updateCheckedFeaturesDate: updateCheckedFeaturesDate,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Form.create()(withRouter(KeyFeatures)));"]},"metadata":{},"sourceType":"module"}