{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { Avatar, Button, Col, Form, Icon, Input, message, Modal, Rate, Row, Select, Tooltip, Upload } from 'antd';\nimport axios from 'axios';\nimport FormData from 'form-data';\nimport _ from 'lodash';\nimport { withRouter } from 'next/router';\nimport QueueAnim from 'rc-queue-anim';\nimport React, { useEffect, useState } from 'react';\nimport Highlighter from 'react-highlight-words';\nimport ScrollContainer from 'react-indiana-drag-scroll';\nimport ReactPlayer from 'react-player';\nimport { connect } from 'react-redux';\nimport { v4 as uuidv4 } from 'uuid';\nimport { isValidNumber, notEmptyLength } from '../../common-function';\nimport client from '../../feathers';\nimport { getStateIcon, StateList } from '../../params/stateList';\nimport { loading, loginMode } from '../../redux/actions/app-actions';\nconst {\n  TextArea\n} = Input;\n\nvar moment = require('moment');\n\nconst FORM_CONTAINER_SIZE = 500;\nconst IMAGELIMIT = 7;\nconst VIDEOLIMIT = 1;\n\nconst WriteReviewButton = props => {\n  const {\n    0: visible,\n    1: setVisible\n  } = useState(false);\n  const {\n    0: title,\n    1: setTitle\n  } = useState(\"Add Post\");\n  const {\n    0: run,\n    1: setRun\n  } = useState(true);\n  const {\n    0: timeoutFunction,\n    1: setTimeoutFunction\n  } = useState();\n  const {\n    0: previewType,\n    1: setPreviewType\n  } = useState('image');\n  const {\n    0: previewVisible,\n    1: setPreviewVisible\n  } = useState(false);\n  const {\n    0: previewImage,\n    1: setPreviewImage\n  } = useState({});\n  const {\n    0: previewVideo,\n    1: setPreviewVideo\n  } = useState({});\n  const {\n    getFieldDecorator,\n    getFieldsError,\n    getFieldError,\n    isFieldTouched,\n    isFieldValidating\n  } = props.form;\n  const {\n    0: view,\n    1: setView\n  } = useState('add');\n  const {\n    0: reviewForm,\n    1: setReviewForm\n  } = useState({\n    rating: null,\n    title: null,\n    comment: null,\n    type: null,\n    productId: null,\n    userId: null,\n    reviewerId: null,\n    companyId: null,\n    carspecId: null,\n    images: [],\n    videos: [],\n    state: null\n  });\n  const {\n    0: filteredState,\n    1: setFilteredState\n  } = useState([]);\n  const {\n    0: searchStateWords,\n    1: setSearchStateWords\n  } = useState([]);\n  const {\n    0: origImages,\n    1: setOrigImages\n  } = useState([]);\n  const {\n    0: origVideos,\n    1: setOrigVideos\n  } = useState([]);\n  const {\n    0: writer,\n    1: setWriter\n  } = useState({});\n  const {\n    0: mode,\n    1: setMode\n  } = useState('add');\n  const {\n    0: buttonLoading,\n    1: setButtonLoading\n  } = useState(false); // Only show error after a field is touched.\n\n  const ratingError = (isFieldTouched('rating') || !isFieldValidating('rating')) && getFieldError('rating');\n  const commentError = (isFieldTouched('comment') || !isFieldValidating('comment')) && getFieldError('comment');\n  const titleError = (isFieldTouched('title') || !isFieldValidating('title')) && getFieldError('title');\n  const selectionError = (isFieldTouched('selection') || !isFieldValidating('selection')) && getFieldError('selection');\n  useEffect(() => {\n    if (props.mode) {\n      if (props.mode == 'edit') {\n        setMode('edit');\n      } else {\n        setMode('add');\n      }\n    }\n  }, [props.mode]);\n  useEffect(() => {\n    props.form.setFieldsValue(reviewForm);\n\n    switch (view) {\n      case 'edit':\n        setTitle('Edit Post');\n        break;\n\n      case 'add':\n        setTitle('Add Post');\n        break;\n\n      case 'state':\n        setTitle(__jsx(React.Fragment, null, __jsx(\"span\", {\n          className: \"margin-right-sm \"\n        }, __jsx(\"a\", {\n          onClick: () => {\n            setView(props.mode == \"edit\" ? \"edit\" : \"add\");\n          },\n          className: \"black\"\n        }, __jsx(Icon, {\n          type: \"left\"\n        }))), __jsx(\"span\", {\n          className: \"margin-x-sm\"\n        }, \"Select State\")));\n        filterState(null);\n        break;\n\n      default:\n        setTitle('Add Post');\n        break;\n    }\n  }, [view]);\n  useEffect(() => {\n    if (props.mode == 'edit') {\n      setReviewForm(_objectSpread(_objectSpread({}, reviewForm), {}, {\n        _id: props.data._id,\n        rating: props.data.rating ? props.data.rating : null,\n        title: props.data.title ? props.data.title : null,\n        comment: props.data.comment ? props.data.comment : null,\n        state: props.data.state ? props.data.state : null,\n        type: props.data.type ? props.data.type : null,\n        userId: props.data.userId ? props.data.userId : null,\n        reviewerId: props.data.reviewerId ? props.data.reviewerId : null,\n        companyId: props.data.companyId ? props.data.companyId : null,\n        productId: props.data.productId ? props.data.productId : null,\n        carspecId: props.data.carspecId ? props.data.carspecId : null,\n        createdAt: props.data.createdAt ? props.data.createdAt : null,\n        images: props.data.images ? props.data.images : [],\n        videos: props.data.videos ? props.data.videos : []\n      }));\n      setOrigImages(props.data.images ? props.data.images : []);\n      setOrigVideos(props.data.videos ? props.data.videos : []);\n    } else {\n      setReviewForm(_objectSpread(_objectSpread({}, reviewForm), {}, {\n        rating: null,\n        comment: null,\n        title: null,\n        state: null,\n        type: props.data.type ? props.data.type : null,\n        userId: props.data.userId ? props.data.userId : null,\n        reviewerId: props.data.reviewerId ? props.data.reviewerId : null,\n        companyId: props.data.companyId ? props.data.companyId : null,\n        productId: props.data.productId ? props.data.productId : null,\n        carspecId: props.data.carspecId ? props.data.carspecId : null,\n        images: props.data.images ? props.data.images : [],\n        videos: props.data.videos ? props.data.videos : []\n      }));\n      setOrigImages([]);\n      setOrigVideos([]);\n    }\n  }, [props.data]);\n  useEffect(() => {\n    let form = _.cloneDeep(reviewForm);\n\n    form.selection = reviewForm[reviewForm.type + 'Id'];\n\n    if (visible && props.data.reviewerId) {\n      props.form.setFieldsValue({\n        selection: form.selection\n      });\n    }\n  }, [reviewForm]);\n  useEffect(() => {\n    if (run) {\n      setRun(false); //only run every 2 seconds\n\n      setTimeout(() => {\n        setRun(true);\n      }, 2000);\n\n      if (visible && !props.data.reviewerId) {\n        props.loginMode(true);\n        handleError({\n          message: 'Please login to write review'\n        });\n      }\n\n      if (mode == 'add') {\n        if (visible && !props.data[props.data.type + 'Id'] && !notEmptyLength(props.selection)) {\n          handleError({\n            message: 'Item not Found'\n          });\n        }\n      }\n    }\n  });\n  useEffect(() => {\n    setView(mode == 'edit' ? 'edit' : 'add');\n  }, [mode]);\n  useEffect(() => {\n    if (reviewForm.reviewerId) {\n      props.loading(true);\n      client.authenticate().then(res => {\n        props.loading(false);\n        client.service('users').get(reviewForm.reviewerId).then(res => {\n          if (res) {\n            setWriter(res);\n          } else {\n            setWriter({});\n          }\n        });\n      }).catch(err => {\n        props.loading(false);\n        setButtonLoading(false);\n        handleError({\n          message: 'Error on getting user.'\n        });\n      });\n    } else {\n      setWriter({});\n    }\n  }, [reviewForm.reviewerId]);\n\n  function handleCancel() {\n    setPreviewVisible(false);\n  }\n\n  function getBase64(file) {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.readAsDataURL(file);\n\n      reader.onload = () => resolve(reader.result);\n\n      reader.onerror = error => reject(error);\n    });\n  }\n\n  async function handlePreview(file, type) {\n    if (type == 'video') {\n      setPreviewType('video');\n      setPreviewVisible(true);\n      setPreviewVideo({\n        url: file.url,\n        name: file.name\n      });\n    } else {\n      setPreviewType('image');\n      setPreviewVisible(true);\n      setPreviewImage({\n        url: file.url,\n        name: file.name\n      });\n    }\n  }\n\n  function handleDelete(file, type) {\n    if (!file || !file._id) {\n      //handle Error\n      message.error(type == 'video' ? \"Video not found.\" : 'Image not found.');\n    } else {\n      if (type == 'video') {\n        let data = _.filter(reviewForm.videos, function (item) {\n          return item._id != file._id;\n        });\n\n        if (notEmptyLength(data)) {\n          setReviewForm(_objectSpread(_objectSpread({}, reviewForm), {}, {\n            videos: data\n          }));\n        } else {\n          setReviewForm(_objectSpread(_objectSpread({}, reviewForm), {}, {\n            videos: []\n          }));\n        }\n      } else {\n        let data = _.filter(reviewForm.images, function (item) {\n          return item._id != file._id;\n        });\n\n        if (notEmptyLength(data)) {\n          setReviewForm(_objectSpread(_objectSpread({}, reviewForm), {}, {\n            images: data\n          }));\n        } else {\n          setReviewForm(_objectSpread(_objectSpread({}, reviewForm), {}, {\n            images: []\n          }));\n        }\n      }\n    }\n  }\n\n  function handleSuccess(success) {\n    setVisible(false);\n\n    if (props.handleSuccess) {\n      props.handleSuccess(success);\n    }\n  }\n\n  function handleError(error) {\n    setVisible(false);\n\n    if (props.handleError) {\n      props.handleError(error);\n    }\n  }\n\n  function timeout(func, time) {\n    if (!isValidNumber(time)) {\n      time = 500;\n    }\n\n    clearTimeout(timeoutFunction);\n    setTimeoutFunction(setTimeout(() => {\n      return func;\n    }, parseInt(time)));\n  }\n\n  function filterState(v) {\n    if (v) {\n      let regex = new RegExp(`^.*${v}.*$`, 'i');\n      setFilteredState(StateList.filter(function (state) {\n        return regex.test(state.value);\n      }));\n      setSearchStateWords([v]);\n    } else {\n      setSearchStateWords([]);\n      setFilteredState(StateList);\n    }\n  }\n\n  function reset() {\n    setView(mode == \"edit\" ? \"edit\" : \"add\");\n    props.form.resetFields();\n    setReviewForm(_objectSpread(_objectSpread({}, reviewForm), {}, {\n      images: origImages,\n      videos: origVideos,\n      state: props.data.state ? props.data.state : null\n    }));\n    setButtonLoading(false);\n  }\n\n  function reviewModalVisible() {\n    if (props.data.reviewerId) {\n      setVisible(true);\n    } else {\n      props.loginMode(true);\n      handleError({\n        message: 'Please login to write review'\n      });\n    }\n  }\n\n  function onChangeImage(fileList) {\n    if (notEmptyLength(fileList)) {\n      if (fileList.length > IMAGELIMIT) {\n        fileList = fileList.slice(0, IMAGELIMIT);\n      }\n\n      let data = fileList.map(function (file) {\n        if (file.originFileObj) {\n          getBase64(file.originFileObj).then(res => {\n            file.url = res;\n          });\n          file._id = file.uid;\n        }\n\n        return file;\n      });\n      data = _.union(data, reviewForm.images);\n      setReviewForm(_objectSpread(_objectSpread({}, reviewForm), {}, {\n        images: data\n      }));\n    }\n  }\n\n  function onChangeVideo(fileList) {\n    if (notEmptyLength(fileList)) {\n      if (fileList.length > VIDEOLIMIT) {\n        fileList = fileList.slice(0, VIDEOLIMIT);\n      }\n\n      let data = fileList.map(function (file) {\n        if (file.originFileObj) {\n          getBase64(file.originFileObj).then(res => {\n            file.url = res;\n          });\n          file._id = file.uid;\n        }\n\n        return file;\n      });\n      data = _.union(data, reviewForm.videos);\n      setReviewForm(_objectSpread(_objectSpread({}, reviewForm), {}, {\n        videos: data\n      }));\n    }\n  }\n\n  function hasErrors(fieldsError) {\n    return Object.keys(fieldsError).some(field => fieldsError[field]);\n  }\n\n  function handleSubmit(e) {\n    e.preventDefault();\n    setButtonLoading(true);\n    props.form.validateFields((err, values) => {\n      if (!err) {\n        let insertImages = [];\n        let removeImages = [];\n        let insertVideos = [];\n        let removeVideos = [];\n\n        let finalData = _.cloneDeep(reviewForm);\n\n        let images = _.cloneDeep(reviewForm.images);\n\n        let videos = _.cloneDeep(reviewForm.videos);\n\n        let promises = []; //get new upload images\n\n        if (notEmptyLength(images)) {\n          insertImages = insertImages.concat(images.filter(function (image) {\n            return _.has(image, \"originFileObj\");\n          }));\n\n          if (insertImages.length > 0) {\n            let formData = new FormData();\n\n            for (let i = 0; i < insertImages.length; i++) {\n              var fileName = uuidv4() + \"-\" + insertImages[i].name.split('.').join(\"-\") + \"-\" + new Date().getTime();\n              formData.append('images', insertImages[i].originFileObj, fileName);\n            } //Upload Image\n\n\n            promises.push(axios.post(`${client.io.io.uri}upload-images-array`, formData, {\n              headers: {\n                'Authorization': client.settings.storage.storage.storage['feathers-jwt'],\n                'Content-Type': 'multipart/form-data'\n              }\n            }));\n          }\n        } //get new upload videos\n\n\n        if (notEmptyLength(videos)) {\n          insertVideos = insertVideos.concat(videos.filter(function (video) {\n            return _.has(video, \"originFileObj\");\n          }));\n\n          if (insertVideos.length > 0) {\n            let formData = new FormData();\n\n            for (let i = 0; i < insertVideos.length; i++) {\n              var fileName = uuidv4() + \"-\" + insertVideos[i].name.split('.').join(\"-\") + \"-\" + new Date().getTime();\n              formData.append('videos', insertVideos[i].originFileObj, fileName);\n            } //Upload Image\n\n\n            promises.push(axios.post(`${client.io.io.uri}upload-videos-array`, formData, {\n              headers: {\n                'Authorization': client.settings.storage.storage.storage['feathers-jwt'],\n                'Content-Type': 'multipart/form-data'\n              }\n            }));\n          }\n        } //get removed images\n\n\n        if (mode == 'edit') {\n          let diffIds = _.map(_.differenceBy(origImages, images, '_id'), \"_id\");\n\n          removeImages = removeImages.concat(_.filter(origImages, function (image) {\n            return _.includes(diffIds, image._id);\n          }));\n          diffIds = _.map(_.differenceBy(origVideos, videos, '_id'), \"_id\");\n          removeVideos = removeVideos.concat(_.filter(origVideos, function (video) {\n            return _.includes(diffIds, video._id);\n          }));\n        }\n\n        props.loading(true); //Upload new images to server first\n\n        Promise.all(promises).then(responses => {\n          props.loading(false);\n\n          _.forEach(responses, function (res) {\n            if (res.config.url == `${client.io.io.uri}upload-videos-array`) {\n              if (notEmptyLength(res.data.result)) {\n                //Replace new upload videos with url\n                videos = videos.filter(function (video) {\n                  return !_.has(video, \"originFileObj\");\n                });\n                videos = videos.concat(res.data.result);\n                finalData.videos = videos;\n              }\n            } else {\n              if (notEmptyLength(res.data.result)) {\n                //Replace new upload images with url\n                images = images.filter(function (image) {\n                  return !_.has(image, \"originFileObj\");\n                });\n                images = images.concat(res.data.result);\n                finalData.images = images;\n              }\n            }\n          });\n\n          promises = [];\n          promises.push(client.authenticate());\n\n          if (mode == 'add') {\n            promises.push(client.service('rating').create(finalData));\n          } else {\n            promises.push(client.service('rating').patch(finalData._id, finalData));\n          } //Write in rating model\n\n\n          if (finalData[finalData.type + \"Id\"] != null) {\n            props.loading(true);\n            Promise.all(promises).then(([auth, reviewRes]) => {\n              props.loading(false);\n              message.success(mode == \"edit\" ? 'Edit Successful' : 'Create Successful');\n              handleSuccess(reviewRes);\n              setButtonLoading(false);\n              setOrigImages(reviewRes.images);\n              setOrigVideos(reviewRes.videos); //Remove useless images\n\n              if (notEmptyLength(removeImages)) {\n                axios.post(`${client.io.io.uri}deleteImageS3`, {\n                  params: {\n                    imageUrl: removeImages\n                  },\n                  headers: {\n                    'Content-Type': 'text/xml; charset=utf-8',\n                    'Content-Length': 'length'\n                  }\n                }).then(res => {});\n              } //Remove useless videos\n\n\n              if (notEmptyLength(removeVideos)) {\n                axios.post(`${client.io.io.uri}deleteVideoS3`, {\n                  params: {\n                    videoUrl: removeVideos\n                  },\n                  headers: {\n                    'Content-Type': 'text/xml; charset=utf-8',\n                    'Content-Length': 'length'\n                  }\n                });\n              }\n            });\n          }\n        }).catch(err => {\n          props.loading(false);\n          setButtonLoading(false);\n          console.log('err');\n          console.log(err);\n          message.error(err.message);\n        });\n      } else {\n        props.loading(false);\n        setButtonLoading(false);\n\n        _.map(err, function (err) {\n          return message.error(err.errors[0].message);\n        });\n      }\n    });\n  }\n\n  ;\n\n  const _renderImageCard = data => {\n    if (notEmptyLength(data)) {\n      return data.map(function (item) {\n        return __jsx(\"span\", {\n          className: \"d-inline-block thin-border margin-right-xs margin-bottom-xs background-white flex-items-no-shrink\",\n          style: {\n            width: '70px',\n            height: '70px'\n          }\n        }, __jsx(\"div\", {\n          className: \"relative-wrapper fill-parent\"\n        }, __jsx(\"div\", {\n          className: \"absolute-center\"\n        }, __jsx(\"img\", {\n          src: item.url,\n          className: \"fill-parent\"\n        })), __jsx(\"div\", {\n          className: \"absolute-center background-grey-darken-4 stack-element-opacity-50 flex-items-align-center flex-justify-center\"\n        }, __jsx(\"a\", {\n          onClick: e => {\n            handlePreview(item, 'image');\n          }\n        }, __jsx(Icon, {\n          type: \"eye\",\n          className: \"white margin-x-xs\",\n          style: {\n            fontSize: '20px'\n          }\n        })), __jsx(\"a\", {\n          onClick: e => {\n            handleDelete(item, 'image');\n          }\n        }, __jsx(Icon, {\n          type: \"delete\",\n          className: \"white margin-x-xs\",\n          style: {\n            fontSize: '20px'\n          }\n        })))));\n      });\n    } else {\n      return null;\n    }\n  };\n\n  const _renderVideoCard = data => {\n    if (notEmptyLength(data)) {\n      return data.map(function (item) {\n        return __jsx(\"span\", {\n          className: \"d-inline-block thin-border margin-right-xs margin-bottom-xs background-white flex-items-no-shrink\",\n          style: {\n            width: '70px',\n            height: '70px'\n          }\n        }, __jsx(\"div\", {\n          className: \"relative-wrapper fill-parent\"\n        }, __jsx(\"div\", {\n          className: \"absolute-center\"\n        }, __jsx(ReactPlayer, {\n          width: \"100%\",\n          height: \"100%\",\n          url: item.url\n        })), __jsx(\"div\", {\n          className: \"absolute-center background-grey-darken-4 stack-element-opacity-50 flex-items-align-center flex-justify-center\"\n        }, __jsx(\"a\", {\n          onClick: e => {\n            handlePreview(item, 'video');\n          }\n        }, __jsx(Icon, {\n          type: \"eye\",\n          className: \"white margin-x-xs\",\n          style: {\n            fontSize: '20px'\n          }\n        })), __jsx(\"a\", {\n          onClick: e => {\n            handleDelete(item, 'video');\n          }\n        }, __jsx(Icon, {\n          type: \"delete\",\n          className: \"white margin-x-xs\",\n          style: {\n            fontSize: '20px'\n          }\n        })))));\n      });\n    } else {\n      return null;\n    }\n  };\n\n  const _renderSelection = (data, text) => {\n    if (notEmptyLength(data)) {\n      let idType = `${reviewForm.type}Id`;\n      return __jsx(React.Fragment, null, __jsx(\"div\", {\n        className: \"headline  \"\n      }, text != null ? text : 'Please select item to review'), __jsx(Form.Item, {\n        required: false,\n        validateStatus: selectionError ? 'error' : '',\n        help: selectionError || '',\n        style: {\n          margin: 0\n        }\n      }, getFieldDecorator('selection', {\n        rules: [{\n          required: true,\n          message: 'Please pick 1 item to review!'\n        }],\n        initialValue: props.data[idType]\n      })(__jsx(Select, {\n        onChange: v => {\n          let stateObj = _.cloneDeep(reviewForm);\n\n          stateObj[idType] = v;\n          setReviewForm(stateObj);\n        }\n      }, data.map(function (item) {\n        return __jsx(Select.Option, {\n          key: item._id,\n          value: item._id\n        }, item.name);\n      })))));\n    } else {\n      return null;\n    }\n  };\n\n  const _renderForm = () => {\n    return __jsx(\"div\", {\n      key: \"form\"\n    }, __jsx(Form, {\n      onSubmit: handleSubmit\n    }, __jsx(\"div\", {\n      style: {\n        height: FORM_CONTAINER_SIZE * 0.15 + 'px'\n      },\n      className: \"scroll-y-wrapper padding-x-sm \"\n    }, __jsx(Form.Item, {\n      style: {\n        margin: 0\n      }\n    }, __jsx(Row, {\n      type: \"flex\",\n      align: \"top\"\n    }, __jsx(Col, {\n      span: 12\n    }, __jsx(\"div\", {\n      className: \"flex-items-align-start\"\n    }, __jsx(\"span\", {\n      className: \"d-inline-block margin-right-sm\"\n    }, __jsx(Avatar, {\n      size: 50,\n      src: writer.avatar ? writer.avatar : null,\n      icon: writer.avatar ? null : 'user'\n    })), __jsx(\"span\", {\n      className: \"d-inline-block flex-items-align-center\"\n    }, __jsx(\"span\", {\n      className: \"d-inline-block\"\n    }, writer.firstName ? writer.firstName : null, \" \", writer.lastName ? writer.lastName : null), reviewForm.state ? __jsx(\"span\", {\n      className: \"blue d-inline-block margin-right-sm flex-items-align-center padding-left-xs\"\n    }, \" \", reviewForm.state) : null))), __jsx(Col, {\n      span: 12\n    }, __jsx(\"div\", {\n      className: \"review2\"\n    }, __jsx(\"p\", null, reviewForm.createdAt ? moment(reviewForm.createdAt).format('D MMMM Y') : moment().format('D MMMM Y'))))))), __jsx(\"div\", {\n      style: {\n        height: FORM_CONTAINER_SIZE * 0.75 + 'px'\n      },\n      className: \"scroll-y-wrapper padding-x-sm\"\n    }, notEmptyLength(props.selection) ? _renderSelection(props.selection, props.selectionText) : null, _.isPlainObject(_.get(props.data, 'carspecId')) && !_.isEmpty(_.get(props.data, 'carspecId')) ? __jsx(\"div\", {\n      className: \"headline font-weight-bold\"\n    }, _.trim(`${_.get(props.data, 'carspecId.make') || ''} ${_.get(props.data, 'carspecId.model') || ''} ${_.get(props.data, 'carspecId.variant') || ''}`)) : null, __jsx(\"div\", {\n      className: \"headline  \"\n    }, \"How awesome this?\"), __jsx(Form.Item, {\n      required: false,\n      validateStatus: ratingError ? 'error' : '',\n      help: ratingError || '',\n      style: {\n        margin: 0\n      }\n    }, getFieldDecorator('rating', {\n      rules: [{\n        required: true,\n        message: 'Please rate this store!'\n      }],\n      initialValue: !props.data || !props.data.rating ? null : props.data.rating\n    })(__jsx(Rate, {\n      allowHalf: true,\n      onChange: v => {\n        setReviewForm(_objectSpread(_objectSpread({}, reviewForm), {}, {\n          rating: v\n        }));\n      }\n    }))), __jsx(Form.Item, {\n      required: false,\n      validateStatus: titleError ? 'error' : '',\n      help: titleError || '',\n      style: {\n        margin: 0\n      }\n    }, getFieldDecorator('title', {\n      initialValue: props.data ? props.data.title : null\n    })(__jsx(Input, {\n      placeholder: \"Title\",\n      maxLength: 300,\n      onChange: e => {\n        setReviewForm(_objectSpread(_objectSpread({}, reviewForm), {}, {\n          title: e.target.value\n        }));\n      }\n    }))), __jsx(Form.Item, {\n      required: false,\n      validateStatus: commentError ? 'error' : '',\n      help: commentError || '',\n      style: {\n        margin: 0\n      }\n    }, getFieldDecorator('comment', {\n      initialValue: props.data ? props.data.comment : null\n    })(__jsx(TextArea, {\n      rows: 4,\n      maxLength: 1000,\n      placeholder: \"Write your review....\",\n      onChange: e => {\n        setReviewForm(_objectSpread(_objectSpread({}, reviewForm), {}, {\n          comment: e.target.value\n        }));\n      }\n    }))), __jsx(Form.Item, {\n      style: {\n        margin: 0\n      }\n    }, __jsx(ScrollContainer, {\n      style: {\n        height: '70px',\n        width: \"100%\"\n      },\n      className: \"d-flex margin-y-sm\",\n      vertical: false\n    }, _renderVideoCard(reviewForm.videos), _renderImageCard(reviewForm.images))), __jsx(\"div\", {\n      className: \"margin-y-sm\"\n    }, __jsx(Form.Item, {\n      style: {\n        margin: 0\n      }\n    }, __jsx(Row, {\n      className: \"thin-border round-border padding-sm\",\n      gutter: [10, 20]\n    }, __jsx(Col, {\n      xs: 24,\n      sm: 24,\n      md: 12,\n      lg: 12,\n      xl: 12\n    }, __jsx(\"div\", {\n      className: \"fill-parent  headline   text-overflow-break\"\n    }, \" Add to your post\")), __jsx(Col, {\n      xs: 24,\n      sm: 24,\n      md: 12,\n      lg: 12,\n      xl: 12\n    }, __jsx(\"div\", {\n      className: \"fill-parent flex-justify-end flex-items-align-center flex-align-center text-overflow-break\"\n    }, __jsx(Upload, {\n      accept: \"image/*\",\n      onChange: ({\n        fileList\n      }) => {\n        onChangeImage(fileList);\n      },\n      multiple: true,\n      fileList: reviewForm.images,\n      showUploadList: false,\n      beforeUpload: file => false,\n      disabled: notEmptyLength(reviewForm.images) ? reviewForm.images.length >= IMAGELIMIT : false\n    }, __jsx(Tooltip, {\n      placement: \"top\",\n      title: `Maximum ${IMAGELIMIT} images upload`\n    }, __jsx(\"img\", {\n      src: \"/assets/add-post/image.png\",\n      style: {\n        width: '25px',\n        height: '25px'\n      },\n      className: `margin-x-sm margin-bottom-sm ${reviewForm.images.length >= IMAGELIMIT ? 'cursor-not-allowed' : 'cursor-pointer'}`\n    }))))))))), __jsx(\"div\", {\n      style: {\n        height: FORM_CONTAINER_SIZE * 0.1 + 'px'\n      },\n      className: \"flex-items-align-center\"\n    }, __jsx(Button, {\n      htmlType: \"submit\",\n      loading: buttonLoading,\n      type: \"primary\",\n      style: {\n        color: 'white',\n        width: '100%'\n      }\n    }, mode == 'add' ? \"Add Post\" : \"Edit Post\"))));\n  };\n\n  const _renderState = () => {\n    return __jsx(\"div\", {\n      key: \"state\"\n    }, __jsx(Row, {\n      gutter: [0, 10]\n    }, __jsx(Col, {\n      xs: 24,\n      sm: 24,\n      md: 24,\n      lg: 24,\n      xl: 24\n    }, __jsx(\"div\", {\n      className: \"fill-parent\"\n    }, __jsx(Input, {\n      placeholder: \"Where are you?\",\n      onChange: e => {\n        filterState(e.target.value);\n      }\n    }))), __jsx(Col, {\n      xs: 24,\n      sm: 24,\n      md: 24,\n      lg: 24,\n      xl: 24\n    }, __jsx(\"div\", {\n      style: {\n        height: FORM_CONTAINER_SIZE * 0.85 + 'px'\n      },\n      className: \"scroll-y-wrapper \"\n    }, filteredState.map(function (state) {\n      return __jsx(\"div\", {\n        className: `flex-justify-start flex-items-align-center margin-y-md hover-background-yellow-lighten-3 cursor-pointer ${_.toLower(reviewForm.state) == _.toLower(state.value) ? 'background-yellow-lighten-2' : ''}`,\n        onClick: e => {\n          setReviewForm(_objectSpread(_objectSpread({}, reviewForm), {}, {\n            state: state.value\n          }));\n          setView(mode == 'edit' ? 'edit' : 'add');\n        }\n      }, __jsx(\"span\", {\n        className: \"d-inline-block relative-wrapper margin-x-md\",\n        style: {\n          width: '30px',\n          height: '20px'\n        }\n      }, __jsx(\"img\", {\n        src: getStateIcon(state.value),\n        className: \"fill-parent absolute-center\"\n      })), __jsx(\"span\", {\n        className: \"d-inline-block\"\n      }, __jsx(Highlighter, {\n        highlightStyle: {\n          color: '#ffc069',\n          padding: 0\n        },\n        textToHighlight: state.value,\n        autoEscape: true,\n        className: \"subtitle1\",\n        searchWords: searchStateWords\n      })));\n    })))));\n  };\n\n  const _renderView = data => {\n    switch (data) {\n      case 'state':\n        return _renderState();\n\n      case 'edit':\n        return _renderForm();\n\n      case 'add':\n        return _renderForm();\n\n      default:\n        return null;\n        break;\n    }\n  };\n\n  return __jsx(\"span\", {\n    className: props.className ? props.className : null,\n    style: props.style ? props.style : null\n  }, __jsx(Modal, {\n    visible: visible,\n    title: props.title && (view == 'add' || view == 'edit') ? props.title : title,\n    maskClosable: true,\n    centered: true,\n    closable: true,\n    footer: null,\n    onCancel: e => {\n      setVisible(false);\n    },\n    afterClose: () => {\n      reset();\n    }\n  }, __jsx(\"div\", {\n    style: {\n      height: FORM_CONTAINER_SIZE + 'px'\n    },\n    className: \"scroll-y-wrapper\"\n  }, __jsx(QueueAnim, {\n    type: \"bottom\"\n  }, view == 'add' || view == 'edit' ? _renderForm() : _renderState()))), __jsx(Modal, {\n    visible: previewVisible,\n    footer: null,\n    onCancel: handleCancel,\n    centered: true,\n    closable: true,\n    title: previewType == 'image' ? previewImage.name : previewVideo.name,\n    width: 400\n  }, previewType == 'video' ? __jsx(ReactPlayer, {\n    width: \"100%\",\n    height: \"200px\",\n    controls: true,\n    url: previewVideo.url,\n    config: {\n      file: {\n        forceVideo: true\n      }\n    }\n  }) : __jsx(\"img\", {\n    alt: \"example\",\n    style: {\n      width: '100%'\n    },\n    src: previewImage.url\n  })), __jsx(\"a\", {\n    onClick: props.readOnly ? null : reviewModalVisible\n  }, props.button ? props.button() : __jsx(Button, {\n    style: {\n      color: '#F57F17'\n    }\n  }, __jsx(Avatar, {\n    src: '/assets/add-post/create-post.png',\n    shape: \"square\",\n    size: \"small\"\n  }))));\n};\n\nconst mapStateToProps = state => ({\n  app: state.app,\n  user: state.user\n});\n\nconst mapDispatchToProps = {\n  loginMode: loginMode,\n  loading: loading\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(Form.create()(withRouter(WriteReviewButton)));","map":{"version":3,"sources":["/Users/faraheen/ccar-cms-next-mobile/components/rating/WriteReviewButton.jsx"],"names":["Avatar","Button","Col","Form","Icon","Input","message","Modal","Rate","Row","Select","Tooltip","Upload","axios","FormData","_","withRouter","QueueAnim","React","useEffect","useState","Highlighter","ScrollContainer","ReactPlayer","connect","v4","uuidv4","isValidNumber","notEmptyLength","client","getStateIcon","StateList","loading","loginMode","TextArea","moment","require","FORM_CONTAINER_SIZE","IMAGELIMIT","VIDEOLIMIT","WriteReviewButton","props","visible","setVisible","title","setTitle","run","setRun","timeoutFunction","setTimeoutFunction","previewType","setPreviewType","previewVisible","setPreviewVisible","previewImage","setPreviewImage","previewVideo","setPreviewVideo","getFieldDecorator","getFieldsError","getFieldError","isFieldTouched","isFieldValidating","form","view","setView","reviewForm","setReviewForm","rating","comment","type","productId","userId","reviewerId","companyId","carspecId","images","videos","state","filteredState","setFilteredState","searchStateWords","setSearchStateWords","origImages","setOrigImages","origVideos","setOrigVideos","writer","setWriter","mode","setMode","buttonLoading","setButtonLoading","ratingError","commentError","titleError","selectionError","setFieldsValue","filterState","_id","data","createdAt","cloneDeep","selection","setTimeout","handleError","authenticate","then","res","service","get","catch","err","handleCancel","getBase64","file","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","result","onerror","error","handlePreview","url","name","handleDelete","filter","item","handleSuccess","success","timeout","func","time","clearTimeout","parseInt","v","regex","RegExp","test","value","reset","resetFields","reviewModalVisible","onChangeImage","fileList","length","slice","map","originFileObj","uid","union","onChangeVideo","hasErrors","fieldsError","Object","keys","some","field","handleSubmit","e","preventDefault","validateFields","values","insertImages","removeImages","insertVideos","removeVideos","finalData","promises","concat","image","has","formData","i","fileName","split","join","Date","getTime","append","push","post","io","uri","headers","settings","storage","video","diffIds","differenceBy","includes","all","responses","forEach","config","create","patch","auth","reviewRes","params","imageUrl","videoUrl","console","log","errors","_renderImageCard","width","height","fontSize","_renderVideoCard","_renderSelection","text","idType","margin","rules","required","initialValue","stateObj","_renderForm","avatar","firstName","lastName","format","selectionText","isPlainObject","isEmpty","trim","target","color","_renderState","toLower","padding","_renderView","className","style","forceVideo","readOnly","button","mapStateToProps","app","user","mapDispatchToProps"],"mappings":"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","sourcesContent":["import { Avatar, Button, Col, Form, Icon, Input, message, Modal, Rate, Row, Select, Tooltip, Upload } from 'antd';\nimport axios from 'axios';\nimport FormData from 'form-data';\nimport _ from 'lodash';\nimport { withRouter } from 'next/router';\nimport QueueAnim from 'rc-queue-anim';\nimport React, { useEffect, useState } from 'react';\nimport Highlighter from 'react-highlight-words';\nimport ScrollContainer from 'react-indiana-drag-scroll';\nimport ReactPlayer from 'react-player';\nimport { connect } from 'react-redux';\nimport { v4 as uuidv4 } from 'uuid';\nimport { isValidNumber, notEmptyLength } from '../../common-function';\nimport client from '../../feathers';\nimport { getStateIcon, StateList } from '../../params/stateList';\nimport { loading, loginMode } from '../../redux/actions/app-actions';\n\n\nconst { TextArea } = Input;\nvar moment = require('moment');\n\nconst FORM_CONTAINER_SIZE = 500;\nconst IMAGELIMIT = 7;\nconst VIDEOLIMIT = 1;\n\n\nconst WriteReviewButton = (props) => {\n\n\n    const [visible, setVisible] = useState(false);\n    const [title, setTitle] = useState(\"Add Post\");\n    const [run, setRun] = useState(true);\n    const [timeoutFunction, setTimeoutFunction] = useState();\n    const [previewType, setPreviewType] = useState('image');\n    const [previewVisible, setPreviewVisible] = useState(false);\n    const [previewImage, setPreviewImage] = useState({});\n    const [previewVideo, setPreviewVideo] = useState({});\n\n    const { getFieldDecorator, getFieldsError, getFieldError, isFieldTouched, isFieldValidating } = props.form;\n\n    const [view, setView] = useState('add');\n    const [reviewForm, setReviewForm] = useState({\n        rating: null,\n        title: null,\n        comment: null,\n        type: null,\n        productId: null,\n        userId: null,\n        reviewerId: null,\n        companyId: null,\n        carspecId: null,\n        images: [],\n        videos: [],\n        state: null,\n    });\n\n\n    const [filteredState, setFilteredState] = useState([]);\n    const [searchStateWords, setSearchStateWords] = useState([])\n    const [origImages, setOrigImages] = useState([]);\n    const [origVideos, setOrigVideos] = useState([]);\n    const [writer, setWriter] = useState({});\n    const [mode, setMode] = useState('add');\n    const [buttonLoading, setButtonLoading] = useState(false);\n    // Only show error after a field is touched.\n    const ratingError = (isFieldTouched('rating') || !isFieldValidating('rating')) && getFieldError('rating');\n    const commentError = (isFieldTouched('comment') || !isFieldValidating('comment')) && getFieldError('comment');\n    const titleError = (isFieldTouched('title') || !isFieldValidating('title')) && getFieldError('title');\n    const selectionError = (isFieldTouched('selection') || !isFieldValidating('selection')) && getFieldError('selection');\n\n\n\n\n    useEffect(() => {\n        if (props.mode) {\n            if (props.mode == 'edit') {\n                setMode('edit');\n            } else {\n                setMode('add');\n            }\n        }\n\n    }, [props.mode])\n\n    useEffect(() => {\n\n        props.form.setFieldsValue(reviewForm);\n        switch (view) {\n            case 'edit':\n                setTitle('Edit Post')\n                break;\n            case 'add':\n                setTitle('Add Post')\n                break;\n            case 'state':\n                setTitle(\n                    <React.Fragment>\n                        <span className=\"margin-right-sm \">\n                            <a onClick={() => {\n                                setView(props.mode == \"edit\" ? \"edit\" : \"add\")\n                            }} className=\"black\">\n                                <Icon type=\"left\" />\n                            </a>\n                        </span>\n                        <span className=\"margin-x-sm\">\n                            Select State\n                     </span>\n                    </React.Fragment>\n                )\n                filterState(null);\n                break;\n            default:\n                setTitle('Add Post')\n                break;\n        }\n    }, [view])\n    useEffect(() => {\n\n        if (props.mode == 'edit') {\n            setReviewForm(\n                {\n                    ...reviewForm,\n                    _id: props.data._id,\n                    rating: props.data.rating ? props.data.rating : null,\n                    title: props.data.title ? props.data.title : null,\n                    comment: props.data.comment ? props.data.comment : null,\n                    state: props.data.state ? props.data.state : null,\n                    type: props.data.type ? props.data.type : null,\n                    userId: props.data.userId ? props.data.userId : null,\n                    reviewerId: props.data.reviewerId ? props.data.reviewerId : null,\n                    companyId: props.data.companyId ? props.data.companyId : null,\n                    productId: props.data.productId ? props.data.productId : null,\n                    carspecId: props.data.carspecId ? props.data.carspecId : null,\n                    createdAt: props.data.createdAt ? props.data.createdAt : null,\n                    images: props.data.images ? props.data.images : [],\n                    videos: props.data.videos ? props.data.videos : [],\n                }\n            )\n            setOrigImages(props.data.images ? props.data.images : []);\n            setOrigVideos(props.data.videos ? props.data.videos : []);\n        } else {\n            setReviewForm(\n                {\n                    ...reviewForm,\n                    rating: null,\n                    comment: null,\n                    title: null,\n                    state: null,\n                    type: props.data.type ? props.data.type : null,\n                    userId: props.data.userId ? props.data.userId : null,\n                    reviewerId: props.data.reviewerId ? props.data.reviewerId : null,\n                    companyId: props.data.companyId ? props.data.companyId : null,\n                    productId: props.data.productId ? props.data.productId : null,\n                    carspecId: props.data.carspecId ? props.data.carspecId : null,\n                    images: props.data.images ? props.data.images : [],\n                    videos: props.data.videos ? props.data.videos : [],\n                }\n            )\n            setOrigImages([]);\n            setOrigVideos([]);\n        }\n    }, [props.data])\n\n    useEffect(() => {\n\n        let form = _.cloneDeep(reviewForm);\n        form.selection = reviewForm[reviewForm.type + 'Id'];\n        if (visible && props.data.reviewerId) {\n            props.form.setFieldsValue({ selection: form.selection });\n        }\n\n    }, [reviewForm])\n\n    useEffect(() => {\n\n\n        if (run) {\n            setRun(false);\n            //only run every 2 seconds\n            setTimeout(() => {\n                setRun(true);\n            }, 2000);\n\n\n            if (visible && !props.data.reviewerId) {\n                props.loginMode(true);\n                handleError({ message: 'Please login to write review' });\n            }\n\n            if (mode == 'add') {\n                if (visible && (!props.data[props.data.type + 'Id'] && !notEmptyLength(props.selection))) {\n                    handleError({ message: 'Item not Found' });\n                }\n            }\n        }\n    })\n\n\n    useEffect(() => {\n        setView(mode == 'edit' ? 'edit' : 'add');\n    }, [mode])\n\n\n    useEffect(() => {\n        if (reviewForm.reviewerId) {\n            props.loading(true);\n            client.authenticate()\n                .then((res) => {\n                    props.loading(false);\n                    client.service('users').get(reviewForm.reviewerId).then((res) => {\n                        if (res) {\n                            setWriter(res);\n                        } else {\n                            setWriter({});\n                        }\n                    })\n                })\n                .catch((err) => {\n                    props.loading(false);\n                    setButtonLoading(false);\n                    handleError({ message: 'Error on getting user.' });\n                })\n        } else {\n            setWriter({});\n        }\n    }, [reviewForm.reviewerId])\n\n\n    function handleCancel() {\n        setPreviewVisible(false);\n    }\n\n\n    function getBase64(file) {\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            reader.readAsDataURL(file);\n            reader.onload = () => resolve(reader.result);\n            reader.onerror = error => reject(error);\n        });\n    }\n\n    async function handlePreview(file, type) {\n\n        if (type == 'video') {\n            setPreviewType('video');\n            setPreviewVisible(true)\n            setPreviewVideo(\n                {\n                    url: file.url,\n                    name: file.name\n                })\n        } else {\n            setPreviewType('image');\n            setPreviewVisible(true)\n            setPreviewImage(\n                {\n                    url: file.url,\n                    name: file.name\n                })\n        }\n    }\n\n    function handleDelete(file, type) {\n\n        if (!file || !file._id) {\n            //handle Error\n            message.error(type == 'video' ? \"Video not found.\" : 'Image not found.')\n        } else {\n            if (type == 'video') {\n\n                let data = _.filter(reviewForm.videos, function (item) {\n                    return item._id != file._id;\n                });\n                if (notEmptyLength(data)) {\n                    setReviewForm({ ...reviewForm, videos: data });\n                } else {\n                    setReviewForm({ ...reviewForm, videos: [] })\n                }\n            } else {\n\n                let data = _.filter(reviewForm.images, function (item) {\n                    return item._id != file._id;\n                });\n                if (notEmptyLength(data)) {\n                    setReviewForm({ ...reviewForm, images: data });\n                } else {\n                    setReviewForm({ ...reviewForm, images: [] })\n                }\n            }\n        }\n    }\n\n    function handleSuccess(success) {\n        setVisible(false);\n        if (props.handleSuccess) {\n            props.handleSuccess(success);\n        }\n    }\n\n\n    function handleError(error) {\n        setVisible(false);\n        if (props.handleError) {\n            props.handleError(error);\n        }\n    }\n    function timeout(func, time) {\n        if (!isValidNumber(time)) {\n            time = 500;\n        }\n        clearTimeout(timeoutFunction);\n        setTimeoutFunction(setTimeout(() => {\n            return func\n        }, parseInt(time)))\n    }\n\n    function filterState(v) {\n        if (v) {\n            let regex = new RegExp(`^.*${v}.*$`, 'i')\n            setFilteredState(StateList.filter(function (state) {\n                return regex.test(state.value);\n            }))\n            setSearchStateWords([v]);\n        } else {\n            setSearchStateWords([]);\n            setFilteredState(StateList);\n        }\n    }\n\n    function reset() {\n        setView(mode == \"edit\" ? \"edit\" : \"add\");\n        props.form.resetFields();\n        setReviewForm({ ...reviewForm, images: origImages, videos: origVideos, state: props.data.state ? props.data.state : null, });\n        setButtonLoading(false);\n    }\n\n    function reviewModalVisible() {\n        if (props.data.reviewerId) {\n            setVisible(true)\n        }\n        else {\n            props.loginMode(true);\n            handleError({ message: 'Please login to write review' });\n        }\n\n    }\n\n    function onChangeImage(fileList) {\n\n        if (notEmptyLength(fileList)) {\n            if (fileList.length > IMAGELIMIT) {\n                fileList = fileList.slice(0, IMAGELIMIT);\n            }\n\n            let data = fileList.map(function (file) {\n                if (file.originFileObj) {\n                    getBase64(file.originFileObj).then(res => {\n                        file.url = res\n                    })\n\n                    file._id = file.uid;\n                }\n                return file;\n            })\n            data = _.union(data, reviewForm.images)\n            setReviewForm({ ...reviewForm, images: data });\n        }\n\n\n    }\n\n    function onChangeVideo(fileList) {\n\n\n        if (notEmptyLength(fileList)) {\n            if (fileList.length > VIDEOLIMIT) {\n                fileList = fileList.slice(0, VIDEOLIMIT);\n            }\n            let data = fileList.map(function (file) {\n                if (file.originFileObj) {\n                    getBase64(file.originFileObj).then(res => {\n                        file.url = res\n                    })\n\n                    file._id = file.uid;\n                }\n                return file;\n            })\n\n            data = _.union(data, reviewForm.videos)\n            setReviewForm({ ...reviewForm, videos: data });\n        }\n    }\n\n    function hasErrors(fieldsError) {\n        return Object.keys(fieldsError).some(field => fieldsError[field]);\n    }\n\n    function handleSubmit(e) {\n        e.preventDefault();\n        setButtonLoading(true);\n        props.form.validateFields((err, values) => {\n            if (!err) {\n                let insertImages = [];\n                let removeImages = [];\n                let insertVideos = [];\n                let removeVideos = [];\n                let finalData = _.cloneDeep(reviewForm);\n                let images = _.cloneDeep(reviewForm.images);\n                let videos = _.cloneDeep(reviewForm.videos);\n                let promises = [];\n\n                //get new upload images\n                if (notEmptyLength(images)) {\n\n                    insertImages = insertImages.concat(images.filter(function (image) {\n                        return _.has(image, \"originFileObj\")\n                    }));\n\n                    if (insertImages.length > 0) {\n                        let formData = new FormData();\n                        for (let i = 0; i < insertImages.length; i++) {\n                            var fileName = uuidv4() + \"-\" + insertImages[i].name.split('.').join(\"-\") + \"-\" + new Date().getTime();\n\n                            formData.append('images', insertImages[i].originFileObj, fileName);\n                        }\n\n                        //Upload Image\n                        promises.push(\n                            axios.post(`${client.io.io.uri}upload-images-array`,\n                                formData\n                                , {\n                                    headers: {\n                                        'Authorization': client.settings.storage.storage.storage['feathers-jwt'],\n                                        'Content-Type': 'multipart/form-data',\n                                    }\n                                }\n                            )\n                        )\n                    }\n                }\n\n                //get new upload videos\n                if (notEmptyLength(videos)) {\n\n                    insertVideos = insertVideos.concat(videos.filter(function (video) {\n                        return _.has(video, \"originFileObj\")\n                    }));\n\n\n                    if (insertVideos.length > 0) {\n                        let formData = new FormData();\n                        for (let i = 0; i < insertVideos.length; i++) {\n                            var fileName = uuidv4() + \"-\" + insertVideos[i].name.split('.').join(\"-\") + \"-\" + new Date().getTime();\n\n                            formData.append('videos', insertVideos[i].originFileObj, fileName);\n                        }\n\n                        //Upload Image\n                        promises.push(\n                            axios.post(`${client.io.io.uri}upload-videos-array`,\n                                formData\n                                , {\n                                    headers: {\n                                        'Authorization': client.settings.storage.storage.storage['feathers-jwt'],\n                                        'Content-Type': 'multipart/form-data',\n                                    }\n                                }\n                            )\n                        )\n                    }\n                }\n\n                //get removed images\n                if (mode == 'edit') {\n\n                    let diffIds = _.map(_.differenceBy(origImages, images, '_id'), \"_id\");\n                    removeImages = removeImages.concat(_.filter(origImages, function (image) {\n                        return _.includes(diffIds, image._id);\n                    }))\n\n                    diffIds = _.map(_.differenceBy(origVideos, videos, '_id'), \"_id\");\n                    removeVideos = removeVideos.concat(_.filter(origVideos, function (video) {\n                        return _.includes(diffIds, video._id);\n                    }))\n                }\n\n                props.loading(true);\n                //Upload new images to server first\n                Promise.all(promises).then((responses) => {\n                    props.loading(false);\n\n                    _.forEach(responses, function (res) {\n                        if (res.config.url == `${client.io.io.uri}upload-videos-array`) {\n                            if (notEmptyLength(res.data.result)) {\n\n                                //Replace new upload videos with url\n                                videos = videos.filter(function (video) {\n                                    return !_.has(video, \"originFileObj\")\n                                });\n\n                                videos = videos.concat(res.data.result);\n                                finalData.videos = videos;\n                            }\n\n                        } else {\n                            if (notEmptyLength(res.data.result)) {\n\n\n                                //Replace new upload images with url\n                                images = images.filter(function (image) {\n                                    return !_.has(image, \"originFileObj\")\n                                });\n\n                                images = images.concat(res.data.result);\n                                finalData.images = images\n                            }\n                        }\n                    })\n\n\n\n                    promises = [];\n                    promises.push(client.authenticate());\n                    if (mode == 'add') {\n                        promises.push(client.service('rating').create(finalData))\n                    } else {\n                        promises.push(client.service('rating').patch(finalData._id, finalData))\n                    }\n\n                    //Write in rating model\n                    if (finalData[finalData.type + \"Id\"] != null) {\n                        props.loading(true);\n                        Promise.all(promises).then(([auth, reviewRes]) => {\n                            props.loading(false);\n                            message.success(mode == \"edit\" ? 'Edit Successful' : 'Create Successful');\n                            handleSuccess(reviewRes);\n                            setButtonLoading(false);\n                            setOrigImages(reviewRes.images);\n                            setOrigVideos(reviewRes.videos);\n\n\n                            //Remove useless images\n                            if (notEmptyLength(removeImages)) {\n                                axios.post(`${client.io.io.uri}deleteImageS3`,\n                                    {\n                                        params: {\n                                            imageUrl: removeImages\n                                        },\n                                        headers: {\n                                            'Content-Type': 'text/xml; charset=utf-8',\n                                            'Content-Length': 'length'\n                                        }\n                                    }\n                                ).then(res => {\n                                })\n                            }\n                            //Remove useless videos\n                            if (notEmptyLength(removeVideos)) {\n                                axios.post(`${client.io.io.uri}deleteVideoS3`,\n                                    {\n                                        params: {\n                                            videoUrl: removeVideos\n                                        },\n                                        headers: {\n                                            'Content-Type': 'text/xml; charset=utf-8',\n                                            'Content-Length': 'length'\n                                        }\n                                    }\n                                )\n                            }\n\n                        })\n                    }\n\n                }).catch(err => {\n                    props.loading(false);\n                    setButtonLoading(false)\n                    console.log('err');\n                    console.log(err);\n                    message.error(err.message)\n                });\n\n\n            } else {\n                props.loading(false);\n                setButtonLoading(false);\n                _.map(err, function (err) {\n                    return message.error(err.errors[0].message)\n                })\n\n            }\n        });\n    };\n\n    const _renderImageCard = (data) => {\n        if (notEmptyLength(data)) {\n            return (\n                data.map(function (item) {\n                    return <span\n                        className={\"d-inline-block thin-border margin-right-xs margin-bottom-xs background-white flex-items-no-shrink\"}\n                        style={{ width: '70px', height: '70px' }}\n                    >\n                        <div className=\"relative-wrapper fill-parent\">\n                            <div className=\"absolute-center\" >\n                                <img src={item.url} className=\"fill-parent\" ></img>\n                            </div>\n                            <div className=\"absolute-center background-grey-darken-4 stack-element-opacity-50 flex-items-align-center flex-justify-center\">\n                                <a onClick={(e) => { handlePreview(item, 'image') }}>\n                                    <Icon type=\"eye\" className=\"white margin-x-xs\" style={{ fontSize: '20px' }} />\n                                </a>\n                                <a onClick={(e) => { handleDelete(item, 'image') }}>\n                                    <Icon type=\"delete\" className=\"white margin-x-xs\" style={{ fontSize: '20px' }} />\n                                </a>\n                            </div>\n                        </div>\n                    </span>\n                })\n            )\n\n        } else {\n            return null;\n        }\n    }\n\n    const _renderVideoCard = (data) => {\n        if (notEmptyLength(data)) {\n            return (\n                data.map(function (item) {\n                    return <span\n                        className={\"d-inline-block thin-border margin-right-xs margin-bottom-xs background-white flex-items-no-shrink\"}\n                        style={{ width: '70px', height: '70px' }}\n                    >\n                        <div className=\"relative-wrapper fill-parent\">\n                            <div className=\"absolute-center\" >\n                                <ReactPlayer width='100%' height=\"100%\" url={item.url} />\n                            </div>\n                            <div className=\"absolute-center background-grey-darken-4 stack-element-opacity-50 flex-items-align-center flex-justify-center\">\n                                <a onClick={(e) => { handlePreview(item, 'video') }}>\n                                    <Icon type=\"eye\" className=\"white margin-x-xs\" style={{ fontSize: '20px' }} />\n                                </a>\n                                <a onClick={(e) => { handleDelete(item, 'video') }}>\n                                    <Icon type=\"delete\" className=\"white margin-x-xs\" style={{ fontSize: '20px' }} />\n                                </a>\n                            </div>\n                        </div>\n                    </span>\n                })\n            )\n\n        } else {\n            return null;\n        }\n    }\n\n    const _renderSelection = (data, text) => {\n\n        if (notEmptyLength(data)) {\n\n            let idType = `${reviewForm.type}Id`;\n            return (\n                <React.Fragment>\n                    <div className=\"headline  \" >\n                        {text != null ? text : 'Please select item to review'}\n                    </div>\n\n                    <Form.Item required={false} validateStatus={selectionError ? 'error' : ''} help={selectionError || ''} style={{ margin: 0 }}>\n                        {getFieldDecorator('selection', {\n                            rules: [{ required: true, message: 'Please pick 1 item to review!' }],\n                            initialValue: props.data[idType],\n                        })(\n                            <Select onChange={(v) => {\n                                let stateObj = _.cloneDeep(reviewForm);\n                                stateObj[idType] = v;\n                                setReviewForm(stateObj)\n                            }}\n                            >\n                                {\n                                    data.map(function (item) {\n                                        return (\n                                            <Select.Option key={item._id} value={item._id}>\n                                                {item.name}\n                                            </Select.Option>\n                                        )\n                                    })\n                                }\n                            </Select>\n                        )}\n                    </Form.Item>\n                </React.Fragment>\n            );\n        } else {\n            return null;\n        }\n    }\n\n\n    const _renderForm = () => {\n\n        return (\n            <div key=\"form\">\n\n                <Form onSubmit={handleSubmit} >\n\n                    <div style={{ height: FORM_CONTAINER_SIZE * 0.15 + 'px' }} className=\"scroll-y-wrapper padding-x-sm \">\n                        <Form.Item style={{ margin: 0 }}>\n                            <Row type=\"flex\" align=\"top\">\n                                <Col span={12}>\n                                    <div className='flex-items-align-start'>\n                                        <span className='d-inline-block margin-right-sm' >\n                                            <Avatar size={50} src={writer.avatar ? writer.avatar : null} icon={writer.avatar ? null : 'user'} ></Avatar>\n                                        </span>\n                                        <span className='d-inline-block flex-items-align-center' >\n                                            <span className='d-inline-block'>{writer.firstName ? writer.firstName : null} {writer.lastName ? writer.lastName : null}</span>\n                                            {\n                                                reviewForm.state ?\n                                                    <span className='blue d-inline-block margin-right-sm flex-items-align-center padding-left-xs'> {reviewForm.state}</span>\n                                                    :\n                                                    null\n                                            }\n                                        </span>\n                                    </div>\n                                </Col>\n                                <Col span={12}>\n                                    <div className=\"review2\">\n                                        <p>{reviewForm.createdAt ? moment(reviewForm.createdAt).format('D MMMM Y') : moment().format('D MMMM Y')}</p>\n                                    </div>\n                                </Col>\n                            </Row>\n                        </Form.Item>\n                    </div>\n                    <div style={{ height: FORM_CONTAINER_SIZE * 0.75 + 'px' }} className=\"scroll-y-wrapper padding-x-sm\">\n\n                        {\n                            notEmptyLength(props.selection) ?\n                                _renderSelection(props.selection, props.selectionText)\n                                :\n                                null\n                        }\n                        {\n                            _.isPlainObject(_.get(props.data, 'carspecId')) && !_.isEmpty(_.get(props.data, 'carspecId')) ?\n                                <div className=\"headline font-weight-bold\">\n                                    {_.trim(`${_.get(props.data, 'carspecId.make') || ''} ${_.get(props.data, 'carspecId.model') || ''} ${_.get(props.data, 'carspecId.variant') || ''}`)}\n                                </div>\n                                :\n                                null\n                        }\n                        <div className=\"headline  \">\n                            How awesome this?\n                        </div>\n                        <Form.Item required={false} validateStatus={ratingError ? 'error' : ''} help={ratingError || ''} style={{ margin: 0 }}>\n                            {getFieldDecorator('rating', {\n                                rules: [{ required: true, message: 'Please rate this store!' }],\n                                initialValue: !props.data || !props.data.rating ? null : props.data.rating,\n                            })(\n                                <Rate allowHalf\n                                    onChange={(v) => { setReviewForm({ ...reviewForm, rating: v }) }}\n                                />\n                            )}\n                        </Form.Item>\n\n                        <Form.Item required={false} validateStatus={titleError ? 'error' : ''} help={titleError || ''} style={{ margin: 0 }}>\n                            {getFieldDecorator('title', {\n                                initialValue: props.data ? props.data.title : null,\n                            })(\n                                <Input\n                                    placeholder=\"Title\"\n                                    maxLength={300}\n                                    onChange={(e) => { setReviewForm({ ...reviewForm, title: e.target.value }) }} />\n                            )}\n                        </Form.Item>\n                        <Form.Item required={false} validateStatus={commentError ? 'error' : ''} help={commentError || ''} style={{ margin: 0 }}>\n                            {getFieldDecorator('comment', {\n                                initialValue: props.data ? props.data.comment : null,\n                            })(\n                                <TextArea rows={4}\n                                    maxLength={1000}\n                                    placeholder=\"Write your review....\"\n                                    onChange={(e) => { setReviewForm({ ...reviewForm, comment: e.target.value }) }} />\n                            )}\n                        </Form.Item>\n\n\n                        <Form.Item style={{ margin: 0 }} >\n\n                            <ScrollContainer style={{ height: '70px', width: \"100%\" }} className=\"d-flex margin-y-sm\" vertical={false}>\n                                {_renderVideoCard(reviewForm.videos)}\n                                {_renderImageCard(reviewForm.images)}\n\n                            </ScrollContainer>\n                        </Form.Item>\n\n                        <div className=\"margin-y-sm\">\n                            <Form.Item style={{ margin: 0 }}>\n                                <Row className=\"thin-border round-border padding-sm\" gutter={[10, 20]}>\n                                    <Col xs={24} sm={24} md={12} lg={12} xl={12}>\n                                        <div className=\"fill-parent  headline   text-overflow-break\"> Add to your post</div>\n                                    </Col>\n                                    <Col xs={24} sm={24} md={12} lg={12} xl={12}>\n                                        <div className=\"fill-parent flex-justify-end flex-items-align-center flex-align-center text-overflow-break\">\n\n                                            <Upload\n                                                accept=\"image/*\"\n                                                onChange={({ fileList }) => {\n                                                    onChangeImage(fileList)\n                                                }}\n                                                multiple={true}\n                                                fileList={reviewForm.images}\n                                                showUploadList={false}\n                                                beforeUpload={file => false}\n                                                disabled={notEmptyLength(reviewForm.images) ? reviewForm.images.length >= IMAGELIMIT : false}\n                                            >\n                                                <Tooltip placement=\"top\" title={`Maximum ${IMAGELIMIT} images upload`}>\n                                                    <img src=\"/assets/add-post/image.png\" style={{ width: '25px', height: '25px' }} className={`margin-x-sm margin-bottom-sm ${reviewForm.images.length >= IMAGELIMIT ? 'cursor-not-allowed' : 'cursor-pointer'}`} />\n                                                </Tooltip>\n                                            </Upload>\n                                            {/* <a onClick={(e) => { setView('state') }}>\n                                                <img src=\"/assets/add-post/location.png\" style={{ width: '25px', height: '25px' }} className=\"margin-x-sm margin-bottom-sm\" />\n                                            </a> */}\n                                            {/* <a>\n                                                <img src=\"/assets/add-post/add-people.png\" style={{ width: '25px', height: '25px' }} className=\"margin-x-sm margin-bottom-sm\" />\n                                            </a> */}\n                                            {/* <a>\n                                                <Upload\n                                                    accept=\"video/*\"\n                                                    onChange={({ fileList }) => {\n                                                        onChangeVideo(fileList)\n                                                    }}\n                                                    fileList={reviewForm.videos}\n                                                    showUploadList={false}\n                                                    beforeUpload={file => false}\n                                                    disabled={notEmptyLength(reviewForm.videos) ? reviewForm.videos.length >= VIDEOLIMIT : false}\n                                                >\n                                                    <Tooltip placement=\"top\" title={`Maximum ${VIDEOLIMIT} videos upload`}>\n                                                        <img src=\"/assets/add-post/Video.png\" style={{ width: '25px', height: '25px' }} className=\"margin-x-sm margin-bottom-sm\" />\n                                                    </Tooltip>\n                                                </Upload>\n                                            </a> */}\n                                        </div>\n                                    </Col>\n                                </Row>\n                            </Form.Item>\n                        </div>\n                    </div>\n                    <div style={{ height: FORM_CONTAINER_SIZE * 0.1 + 'px' }} className=\"flex-items-align-center\">\n                        <Button htmlType=\"submit\" loading={buttonLoading} type=\"primary\" style={{ color: 'white', width: '100%' }}>\n                            {mode == 'add' ? \"Add Post\" : \"Edit Post\"}\n                        </Button>\n                    </div>\n                </Form>\n            </div >\n        )\n    }\n\n    const _renderState = () => {\n        return (\n            <div key=\"state\">\n                <Row gutter={[0, 10]} >\n                    <Col xs={24} sm={24} md={24} lg={24} xl={24}>\n                        <div className='fill-parent'>\n                            <Input placeholder=\"Where are you?\" onChange={(e) => { filterState(e.target.value) }}></Input>\n                        </div>\n                    </Col>\n                    <Col xs={24} sm={24} md={24} lg={24} xl={24}>\n                        <div style={{ height: FORM_CONTAINER_SIZE * 0.85 + 'px' }} className='scroll-y-wrapper '>\n                            {\n                                filteredState.map(function (state) {\n                                    return (\n                                        <div className={`flex-justify-start flex-items-align-center margin-y-md hover-background-yellow-lighten-3 cursor-pointer ${_.toLower(reviewForm.state) == _.toLower(state.value) ? 'background-yellow-lighten-2' : ''}`} onClick={(e) => { setReviewForm({ ...reviewForm, state: state.value }); setView(mode == 'edit' ? 'edit' : 'add') }}>\n                                            <span className='d-inline-block relative-wrapper margin-x-md' style={{ width: '30px', height: '20px' }} >\n                                                <img src={getStateIcon(state.value)} className=\"fill-parent absolute-center\"></img>\n                                            </span>\n                                            <span className='d-inline-block' >\n                                                <Highlighter\n                                                    highlightStyle={{ color: '#ffc069', padding: 0 }}\n                                                    textToHighlight={state.value}\n                                                    autoEscape={true}\n                                                    className=\"subtitle1\"\n                                                    searchWords={searchStateWords} />\n                                            </span>\n                                        </div>\n                                    )\n                                })\n                            }\n                        </div>\n                    </Col>\n\n                </Row>\n            </div>\n        )\n    }\n    const _renderView = (data) => {\n        switch (data) {\n            case 'state':\n                return _renderState();\n            case 'edit':\n                return _renderForm();\n            case 'add':\n                return _renderForm();\n            default:\n                return null;\n                break;\n        }\n    }\n\n\n    return (\n\n        <span className={props.className ? props.className : null} style={props.style ? props.style : null}>\n            <Modal\n                visible={visible}\n                title={props.title && (view == 'add' || view == 'edit') ? props.title : title}\n                maskClosable={true}\n                centered={true}\n                closable={true}\n                footer={null}\n                onCancel={(e) => { setVisible(false); }}\n                afterClose={() => {\n                    reset();\n                }}\n            >\n                <div style={{ height: FORM_CONTAINER_SIZE + 'px' }} className=\"scroll-y-wrapper\" >\n                    <QueueAnim type=\"bottom\">\n                        {\n                            view == 'add' || view == 'edit' ?\n                                _renderForm()\n                                :\n                                _renderState()\n                        }\n                    </QueueAnim>\n                </div>\n            </Modal>\n\n            <Modal visible={previewVisible} footer={null} onCancel={handleCancel} centered={true} closable={true} title={previewType == 'image' ? previewImage.name : previewVideo.name} width={400}>\n                {\n                    previewType == 'video' ?\n                        <ReactPlayer width='100%' height=\"200px\" controls url={previewVideo.url} config={{\n                            file: {\n                                forceVideo: true,\n                            }\n                        }} />\n                        :\n                        <img alt=\"example\" style={{ width: '100%' }} src={previewImage.url} />\n                }\n            </Modal>\n            <a onClick={props.readOnly ? null : reviewModalVisible}>\n\n                {\n                    props.button ?\n                        props.button()\n                        :\n                        <Button style={{ color: '#F57F17' }}><Avatar src={'/assets/add-post/create-post.png'} shape=\"square\" size=\"small\" /></Button>\n                }\n            </a>\n\n        </span>\n    );\n}\n\n\nconst mapStateToProps = state => ({\n    app: state.app,\n    user: state.user,\n});\n\nconst mapDispatchToProps = {\n    loginMode: loginMode,\n    loading: loading,\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(Form.create()(withRouter(WriteReviewButton)));"]},"metadata":{},"sourceType":"module"}