{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { Avatar, Col, Empty, Row, Tabs, Tooltip } from 'antd';\nimport axios from \"axios\";\nimport _ from 'lodash';\nimport moment from \"moment\";\nimport React, { useEffect, useState } from 'react';\nimport { connect } from 'react-redux';\nimport YouTube from 'react-youtube';\nimport { formatDate, notEmptyLength, arrayLengthCount } from '../../common-function';\nimport client from '../../feathers';\nimport { Form } from '@ant-design/compatible';\nimport { withRouter } from 'next/dist/client/router';\nimport Scrollbars from 'react-custom-scrollbars';\nimport Loading from '../general/Loading';\nimport { allIcon } from '../../icon';\nconst opts = {\n  height: '390',\n  width: '640',\n  playerVars: {\n    // https://developers.google.com/youtube/player_parameters\n    autoplay: 0\n  }\n};\nconst VIDEOSIZE = 6;\nconst AUTHORSIZE = 10;\n\nconst SocialVideoTabs = props => {\n  const {\n    0: activeKey,\n    1: setActiveKey\n  } = useState(null);\n  const {\n    0: videolist,\n    1: setVideolist\n  } = useState([]);\n  const {\n    0: videoLoading,\n    1: setVideoLoading\n  } = useState(false);\n  const {\n    0: authorList,\n    1: setAuthorList\n  } = useState([]);\n  const {\n    0: authorLoading,\n    1: setAuthorLoading\n  } = useState(false);\n  const {\n    0: selectedAuthor,\n    1: setSelectedAuthor\n  } = useState(null);\n  const {\n    0: filterGroup,\n    1: setFilterGroup\n  } = useState({\n    authorId: null,\n    language: null\n  });\n  useEffect(() => {\n    getAuthorList();\n  }, []);\n  useEffect(() => {\n    getVideolist();\n  }, [filterGroup, authorList]);\n\n  function getAuthorList() {\n    let match = {\n      publisher: 'youtube'\n    };\n\n    if (props.isNewCar) {\n      match.carYear = moment().format('YYYY');\n\n      if (notEmptyLength(props.data)) {\n        let data = _.compact([_.toLower(props.data.model)]);\n\n        if (notEmptyLength(data)) {\n          match.keywords = {\n            $in: data\n          };\n        }\n      }\n    }\n\n    setAuthorLoading(true);\n    axios.get(`${client.io.io.uri}getAuthorList`, {\n      params: {\n        limit: AUTHORSIZE,\n        $match: match\n      }\n    }).then(res => {\n      //Wait for render done just unloading\n      setTimeout(() => {\n        setAuthorLoading(false);\n      }, 500);\n\n      if (notEmptyLength(res.data.data)) {\n        setAuthorList(res.data.data);\n      } else {\n        setAuthorList([]);\n      }\n    }).catch(err => {\n      setAuthorLoading(false); // message.error(err.message)\n    });\n  }\n\n  function getVideolist(key) {\n    let query = {\n      $sort: {\n        publishedAt: -1\n      },\n      $limit: VIDEOSIZE,\n      $populate: ['authorId'],\n      publisher: 'youtube'\n    };\n\n    if (props.isNewCar) {\n      query.carYear = moment().format('YYYY');\n\n      if (notEmptyLength(props.data)) {\n        let temp = _.compact([props.data.model]);\n\n        if (notEmptyLength(temp)) {\n          temp = _.map(temp, function (item) {\n            return _.toLower(item);\n          });\n          query.keywords = {\n            $in: temp\n          };\n        }\n      }\n    }\n\n    if (filterGroup.authorId != null && filterGroup.authorId != \"\") {\n      query.authorId = filterGroup.authorId;\n    } else {\n      delete query['authorId'];\n    }\n\n    if (filterGroup.language != null && filterGroup.language != \"\" && filterGroup.language != \"all\") {\n      query.language = filterGroup.language;\n      setActiveKey(filterGroup.language);\n    } else {\n      delete query['language'];\n\n      if (languageCount() > 1) {\n        setActiveKey(null);\n      } else {\n        let langs = [];\n\n        _.forEach(authorList, function (item) {\n          langs = _.union(langs, item.language);\n        });\n\n        setActiveKey(notEmptyLength(langs) ? langs[0] : null);\n      }\n    }\n\n    if (query.language) {\n      if (query.language === 'all') {\n        delete query.language;\n      }\n    }\n\n    setVideoLoading(true);\n    client.service('news').find({\n      query: query\n    }).then(res => {\n      //Wait for render done just unloading\n      setTimeout(() => {\n        setVideoLoading(false);\n      }, 500);\n\n      if (res.data.length > 0) {\n        setVideolist(res.data);\n      } else {\n        setVideolist([]);\n      }\n    }).catch(err => {\n      setVideoLoading(false); // message.error(err.message)\n    });\n  }\n\n  function isSelectedAuthor(author, selectedAuthor) {\n    if (author == null && selectedAuthor == null) {\n      return true;\n    } else if (notEmptyLength(author) && notEmptyLength(selectedAuthor)) {\n      return author._id == selectedAuthor._id;\n    } else {\n      return false;\n    }\n  }\n\n  function languageExisted(lang) {\n    if (lang != null) {\n      if (notEmptyLength(selectedAuthor)) {\n        return _.includes(selectedAuthor.language, lang);\n      } else {\n        let langs = [];\n\n        _.forEach(authorList, function (item) {\n          langs = _.union(langs, item.language);\n        });\n\n        return _.includes(langs, lang);\n      }\n    } else {\n      return false;\n    }\n  }\n\n  function languageCount(author) {\n    let langs = [];\n\n    if (notEmptyLength(author)) {\n      return notEmptyLength(author.language) ? author.language.length : 0;\n    } else {\n      _.forEach(authorList, function (item) {\n        langs = _.union(langs, item.language);\n      });\n    }\n\n    return langs.length;\n  }\n\n  const _renderAuthorList = data => {\n    if (notEmptyLength(data)) {\n      let allIconHtml = __jsx(\"div\", {\n        key: \"authorList\",\n        className: !isSelectedAuthor(null, selectedAuthor) ? \"padding-md flex-justify-center flex-items-align-center\" : \"padding-md flex-justify-center flex-items-align-center border-selected-yellow thin-border\"\n      }, __jsx(Tooltip, {\n        title: \"All\",\n        placement: \"right\"\n      }, __jsx(\"a\", {\n        onClick: () => {\n          setFilterGroup(_objectSpread(_objectSpread({}, filterGroup), {}, {\n            authorId: null,\n            language: null\n          }));\n          setSelectedAuthor(null);\n        }\n      }, __jsx(\"span\", {\n        className: \"d-inline-block avatar background-grey-lighten-2 overflow-hidden relative-wrapper\",\n        style: {\n          width: 50,\n          height: 50\n        }\n      }, __jsx(\"img\", {\n        src: allIcon,\n        className: \"width-50 height-50 absolute-center\"\n      })))));\n\n      let list = data.map(function (item, i) {\n        return __jsx(\"div\", {\n          key: 'authorList' + i,\n          className: !isSelectedAuthor(item, selectedAuthor) ? \"padding-md flex-justify-center flex-items-align-center\" : \"padding-md flex-justify-center flex-items-align-center border-selected-yellow thin-border\"\n        }, __jsx(Tooltip, {\n          title: item.name ? item.name : null,\n          placement: \"right\"\n        }, __jsx(\"a\", {\n          onClick: () => {\n            setFilterGroup(_objectSpread(_objectSpread({}, filterGroup), {}, {\n              authorId: item._id,\n              language: languageCount(item) > 1 ? null : item.language[0]\n            }));\n            setSelectedAuthor(item);\n          }\n        }, __jsx(Avatar, {\n          size: 50,\n          src: item.thumbnailUrl ? item.thumbnailUrl : null,\n          icon: item.thumbnailUrl ? null : 'user'\n        }))));\n      });\n      list.unshift(allIconHtml);\n      return __jsx(Loading, {\n        spinning: authorLoading\n      }, list);\n    } else {\n      return null;\n    }\n  };\n\n  const _renderVideoList = (data, language) => {\n    if (notEmptyLength(data)) {\n      return __jsx(Row, {\n        gutter: [10, 10]\n      }, __jsx(\"div\", {\n        key: language,\n        className: \"d-flex scroller-type\",\n        style: {\n          overflow: 'scroll'\n        }\n      }, data.map(function (item, i) {\n        return __jsx(Col, {\n          key: item._id,\n          xs: 18,\n          sm: 18,\n          md: 18,\n          lg: 18,\n          xl: 18\n        }, __jsx(\"div\", {\n          className: \"wrap box-shadow-thin round-border\",\n          style: {\n            height: '250px',\n            width: '100%'\n          }\n        }, __jsx(\"div\", {\n          className: \"video\"\n        }, __jsx(YouTube, {\n          videoId: item.youtubeId,\n          opts: opts\n        })), __jsx(\"div\", {\n          className: \"flex-items-align-start\"\n        }, __jsx(\"span\", null, __jsx(\"div\", {\n          className: \"icon\"\n        }, __jsx(\"img\", {\n          src: item.channelThumbnailUrl\n        }))), __jsx(\"span\", null, __jsx(\"div\", {\n          className: \"title\"\n        }, __jsx(\"div\", {\n          className: \"text-truncate-twoline margin-bottom-sm font-weight-bold\"\n        }, item.title), __jsx(\"span\", {\n          style: {\n            fontSize: '12px'\n          }\n        }, item.authorId ? item.authorId.name : null, \" | \", formatDate(item.publishedAt, \"DD-MM-YYYY\")))))));\n      })));\n    } else {\n      return null;\n    }\n  };\n\n  return __jsx(React.Fragment, null, __jsx(\"div\", {\n    className: \"padding-x-xs\",\n    style: {\n      touchAction: 'pan-y'\n    }\n  }, _renderVideoList(videolist)));\n};\n\nconst mapStateToProps = state => ({\n  app: state.app,\n  newCars: state.newCars\n});\n\nconst mapDispatchToProps = {};\nexport default connect(mapStateToProps, mapDispatchToProps)(Form.create()(withRouter(SocialVideoTabs)));","map":{"version":3,"sources":["/Users/faraheen/ccar-cms-next-mobile/components/news/social-video-tabs.jsx"],"names":["Avatar","Col","Empty","Row","Tabs","Tooltip","axios","_","moment","React","useEffect","useState","connect","YouTube","formatDate","notEmptyLength","arrayLengthCount","client","Form","withRouter","Scrollbars","Loading","allIcon","opts","height","width","playerVars","autoplay","VIDEOSIZE","AUTHORSIZE","SocialVideoTabs","props","activeKey","setActiveKey","videolist","setVideolist","videoLoading","setVideoLoading","authorList","setAuthorList","authorLoading","setAuthorLoading","selectedAuthor","setSelectedAuthor","filterGroup","setFilterGroup","authorId","language","getAuthorList","getVideolist","match","publisher","isNewCar","carYear","format","data","compact","toLower","model","keywords","$in","get","io","uri","params","limit","$match","then","res","setTimeout","catch","err","key","query","$sort","publishedAt","$limit","$populate","temp","map","item","languageCount","langs","forEach","union","service","find","length","isSelectedAuthor","author","_id","languageExisted","lang","includes","_renderAuthorList","allIconHtml","list","i","name","thumbnailUrl","unshift","_renderVideoList","overflow","youtubeId","channelThumbnailUrl","title","fontSize","touchAction","mapStateToProps","state","app","newCars","mapDispatchToProps","create"],"mappings":"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","sourcesContent":["import { Avatar, Col, Empty, Row, Tabs, Tooltip } from 'antd';\nimport axios from \"axios\";\nimport _ from 'lodash';\nimport moment from \"moment\";\nimport React, { useEffect, useState } from 'react';\nimport { connect } from 'react-redux';\nimport YouTube from 'react-youtube';\nimport { formatDate, notEmptyLength, arrayLengthCount } from '../../common-function';\nimport client from '../../feathers';\nimport { Form } from '@ant-design/compatible';\nimport { withRouter } from 'next/dist/client/router';\nimport Scrollbars from 'react-custom-scrollbars';\nimport Loading from '../general/Loading';\nimport { allIcon } from '../../icon';\n\n\n\nconst opts = {\n    height: '390',\n    width: '640',\n    playerVars: {\n        // https://developers.google.com/youtube/player_parameters\n        autoplay: 0,\n    },\n};\nconst VIDEOSIZE = 6;\nconst AUTHORSIZE = 10;\nconst SocialVideoTabs = (props) => {\n\n\n    const [activeKey, setActiveKey] = useState(null);\n    const [videolist, setVideolist] = useState([]);\n    const [videoLoading, setVideoLoading] = useState(false);\n    const [authorList, setAuthorList] = useState([]);\n    const [authorLoading, setAuthorLoading] = useState(false);\n    const [selectedAuthor, setSelectedAuthor] = useState(null);\n    const [filterGroup, setFilterGroup] = useState({\n        authorId: null,\n        language: null,\n    });\n\n\n    useEffect(() => {\n        getAuthorList();\n    }, [])\n\n    useEffect(() => {\n        getVideolist();\n    }, [filterGroup, authorList])\n\n    function getAuthorList() {\n\n        let match = {\n            publisher: 'youtube',\n        };\n\n        if (props.isNewCar) {\n            match.carYear = moment().format('YYYY');\n            if (notEmptyLength(props.data)) {\n                let data = _.compact([_.toLower(props.data.model)]);\n                if (notEmptyLength(data)) {\n                    match.keywords = {\n                        $in: data,\n                    }\n                }\n            }\n        }\n\n        setAuthorLoading(true);\n        axios.get(`${client.io.io.uri}getAuthorList`,\n            {\n                params: {\n                    limit: AUTHORSIZE,\n                    $match: match,\n                }\n            }).then((res) => {\n                //Wait for render done just unloading\n                setTimeout(() => {\n                    setAuthorLoading(false);\n                }, 500);\n                if (notEmptyLength(res.data.data)) {\n                    setAuthorList(res.data.data);\n                } else {\n                    setAuthorList([]);\n                }\n            }).catch(err => {\n                setAuthorLoading(false);\n                // message.error(err.message)\n            });\n    }\n\n    function getVideolist(key) {\n        let query = {\n            $sort: {\n                publishedAt: -1\n            },\n            $limit: VIDEOSIZE,\n            $populate: ['authorId'],\n            publisher: 'youtube'\n        }\n\n        if (props.isNewCar) {\n            query.carYear = moment().format('YYYY');\n            if (notEmptyLength(props.data)) {\n                let temp = _.compact([props.data.model]);\n                if (notEmptyLength(temp)) {\n                    temp = _.map(temp, function (item) {\n                        return _.toLower(item);\n                    })\n                    query.keywords = {\n                        $in: temp,\n                    }\n                }\n            }\n        }\n\n        if (filterGroup.authorId != null && filterGroup.authorId != \"\") {\n            query.authorId = filterGroup.authorId;\n        } else {\n            delete query['authorId'];\n        }\n\n        if (filterGroup.language != null && filterGroup.language != \"\" && filterGroup.language != \"all\") {\n            query.language = filterGroup.language;\n            setActiveKey(filterGroup.language);\n        } else {\n            delete query['language'];\n            if (languageCount() > 1) {\n                setActiveKey(null);\n            } else {\n                let langs = [];\n                _.forEach(authorList, function (item) {\n                    langs = _.union(langs, item.language);\n                })\n                setActiveKey(notEmptyLength(langs) ? langs[0] : null);\n            }\n        }\n\n        if (query.language) {\n            if (query.language === 'all') {\n                delete query.language\n            }\n        }\n\n\n        setVideoLoading(true);\n        client.service('news').find({\n            query: query,\n        }).then((res) => {\n            //Wait for render done just unloading\n            setTimeout(() => {\n                setVideoLoading(false);\n            }, 500);\n            if (res.data.length > 0) {\n                setVideolist(res.data);\n            } else {\n                setVideolist([]);\n            }\n        }).catch(err => {\n            setVideoLoading(false);\n            // message.error(err.message)\n        });\n\n    }\n\n    function isSelectedAuthor(author, selectedAuthor) {\n        if (author == null && selectedAuthor == null) {\n            return true;\n        } else if (notEmptyLength(author) && notEmptyLength(selectedAuthor)) {\n            return author._id == selectedAuthor._id;\n        } else {\n            return false;\n        }\n    }\n\n\n    function languageExisted(lang) {\n        if (lang != null) {\n            if (notEmptyLength(selectedAuthor)) {\n                return _.includes(selectedAuthor.language, lang)\n            } else {\n                let langs = [];\n                _.forEach(authorList, function (item) {\n                    langs = _.union(langs, item.language);\n                })\n\n                return _.includes(langs, lang)\n            }\n        } else {\n            return false;\n        }\n    }\n\n    function languageCount(author) {\n        let langs = [];\n        if (notEmptyLength(author)) {\n            return notEmptyLength(author.language) ? author.language.length : 0;\n        } else {\n            _.forEach(authorList, function (item) {\n                langs = _.union(langs, item.language);\n            })\n        }\n        return langs.length;\n    }\n\n\n    const _renderAuthorList = (data) => {\n\n        if (notEmptyLength(data)) {\n            let allIconHtml = (\n                <div key='authorList' className={!isSelectedAuthor(null, selectedAuthor) ? \"padding-md flex-justify-center flex-items-align-center\" : \"padding-md flex-justify-center flex-items-align-center border-selected-yellow thin-border\"} >\n                    <Tooltip title=\"All\" placement=\"right\">\n                        <a onClick={() => { setFilterGroup({ ...filterGroup, authorId: null, language: null }); setSelectedAuthor(null); }}>\n                            <span className='d-inline-block avatar background-grey-lighten-2 overflow-hidden relative-wrapper' style={{ width : 50, height : 50 }} >\n                              <img src={allIcon} className=\"width-50 height-50 absolute-center\" />\n                            </span>\n                        </a>\n                    </Tooltip>\n                </div>\n            );\n\n            let list = data.map(function (item, i) {\n                return (\n                    <div key={'authorList' + i} className={!isSelectedAuthor(item, selectedAuthor) ? \"padding-md flex-justify-center flex-items-align-center\" : \"padding-md flex-justify-center flex-items-align-center border-selected-yellow thin-border\"} >\n                        <Tooltip title={item.name ? item.name : null} placement=\"right\">\n                            <a onClick={() => { setFilterGroup({ ...filterGroup, authorId: item._id, language: languageCount(item) > 1 ? null : item.language[0] }); setSelectedAuthor(item); }}>\n                                <Avatar size={50} src={item.thumbnailUrl ? item.thumbnailUrl : null} icon={item.thumbnailUrl ? null : 'user'} />\n                            </a>\n                        </Tooltip>\n                    </div>\n                );\n\n            });\n\n            list.unshift(allIconHtml);\n            return (\n                <Loading spinning={authorLoading}>\n                    {list}\n                </Loading>\n            );\n        } else {\n            return null;\n        }\n\n    }\n\n    const _renderVideoList = (data, language) => {\n        if (notEmptyLength(data)) {\n            return (\n                    <Row gutter={[10, 10]}>\n                        <div key={language} className=\"d-flex scroller-type\" style={{overflow:'scroll' }}>\n                        {data.map(function (item, i) {\n                            return (\n                                <Col key={item._id} xs={18} sm={18} md={18} lg={18} xl={18}>\n                                    <div className=\"wrap box-shadow-thin round-border\" style={{height: '250px', width:'100%'}}>\n                                        <div className=\"video\">\n                                            <YouTube videoId={item.youtubeId} opts={opts} />\n                                            {/* <iframe controls autoplay src=\"https://www.youtube.com/watch?v=gV7YudrTmQ4\" style={{width: \"100%\"}} > */}\n                                            {/* </iframe> */}\n                                        </div>\n\n                                        <div className=\"flex-items-align-start\">\n                                            <span>\n                                                <div className=\"icon\">\n                                                    <img src={item.channelThumbnailUrl} />\n                                                </div>\n                                            </span>\n                                            <span>\n                                                <div className=\"title\">\n                                                    <div className=\"text-truncate-twoline margin-bottom-sm font-weight-bold\">\n                                                        {item.title}\n                                                    </div>\n                                                    <span style={{fontSize:'12px'}}>\n                                                            {item.authorId ? item.authorId.name : null} | {formatDate(item.publishedAt, \"DD-MM-YYYY\")}\n                                                    </span>\n                                                    {/* <div className=\"text-truncate\">\n                                                        {item.authorId ? item.authorId.name : null}\n                                                    </div>\n                                                    <div className=\"text-truncate\">\n                                                        {formatDate(item.publishedAt, \"DD-MM-YYYY\")}\n                                                    </div> */}\n                                                </div>\n\n                                            </span>\n                                        </div>\n                                    </div>\n                                </Col>\n                            )\n                        })\n                        }\n                        </div>\n                    </Row>\n            )\n        } else {\n            return null;\n        }\n    }\n    return (\n        <React.Fragment>\n            <div className=\"padding-x-xs\" style={{touchAction:'pan-y'}}>\n                {_renderVideoList(videolist)}\n            </div>\n        </React.Fragment>\n    );\n}\n\n\nconst mapStateToProps = state => ({\n    app: state.app,\n    newCars: state.newCars,\n});\n\nconst mapDispatchToProps = {\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(Form.create()(withRouter(SocialVideoTabs)));"]},"metadata":{},"sourceType":"module"}