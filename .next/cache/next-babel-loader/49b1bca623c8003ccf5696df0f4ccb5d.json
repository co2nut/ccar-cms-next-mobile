{"ast":null,"code":"var _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport { Button, Card, Col, Empty, Form, message, Row, Select, Tabs } from 'antd';\nimport axios from 'axios';\nimport _ from 'lodash';\nimport moment from 'moment';\nimport { withRouter } from 'next/router';\nimport React, { useEffect, useState } from 'react';\nimport { connect } from 'react-redux';\nimport { notEmptyLength } from '../../common-function';\nimport client from '../../feathers';\nimport { loading } from '../../redux/actions/app-actions';\nimport { fetchFeaturesList, updateCheckedFeaturesDate } from '../../redux/actions/productsList-actions';\nimport CarspecsCompareTable from '../compare/CarspecsCompareTable';\nimport { isIOS, isMobile } from 'react-device-detect';\nimport OverallRating from '../rating/OverallRating';\nimport RatingProgress from '../rating/RatingProgress';\nimport WriteReviewButton from '../rating/WriteReviewButton';\nimport ReviewList2 from '../rating/ReviewList2';\nvar TabPane = Tabs.TabPane;\nvar Option = Select.Option;\nvar reviewContainerRef = React.createRef();\nvar RATINGPAGESIZE = 4;\nvar columns = [{\n  title: 'Category',\n  dataIndex: 'category',\n  key: 'category',\n  render: function render(text, row) {\n    if (row.field == 'skip') {\n      return {\n        children: __jsx(\"span\", null, __jsx(\"strong\", null, text)),\n        props: {\n          colSpan: 3\n        }\n      };\n    } else {\n      return {\n        children: __jsx(\"span\", null, text)\n      };\n    }\n  }\n}, {\n  title: 'Field',\n  dataIndex: 'field',\n  key: 'field',\n  render: function render(text, row) {\n    if (text == 'skip') {\n      return {\n        props: {\n          colSpan: 0\n        }\n      };\n    } else {\n      return {\n        children: __jsx(\"span\", null, text)\n      };\n    }\n  }\n}, {\n  title: 'Value',\n  dataIndex: 'value',\n  key: 'value',\n  render: function render(text, row) {\n    if (text == 'skip') {\n      return {\n        props: {\n          colSpan: 0\n        }\n      };\n    } else {\n      return {\n        children: __jsx(\"span\", null, text)\n      };\n    }\n  }\n}];\n\nvar Description = function Description(props) {\n  _s();\n\n  var _useState = useState(''),\n      id = _useState[0],\n      setId = _useState[1];\n\n  var _useState2 = useState(null),\n      companyId = _useState2[0],\n      setCompanyId = _useState2[1];\n\n  var _useState3 = useState({}),\n      productDetails = _useState3[0],\n      setProductDetails = _useState3[1];\n\n  var _useState4 = useState([]),\n      carSpecs = _useState4[0],\n      setCarSpecs = _useState4[1];\n\n  var _useState5 = useState([]),\n      expandedRow = _useState5[0],\n      setExpandedRow = _useState5[1];\n\n  var _useState6 = useState([]),\n      ratings = _useState6[0],\n      setRatings = _useState6[1];\n\n  var _useState7 = useState(1),\n      ratingPage = _useState7[0],\n      setRatingPage = _useState7[1];\n\n  var _useState8 = useState(0),\n      ratingTotal = _useState8[0],\n      setRatingTotal = _useState8[1];\n\n  var _useState9 = useState([]),\n      ownRating = _useState9[0],\n      setOwnRating = _useState9[1];\n\n  var _useState10 = useState(false),\n      displayContact = _useState10[0],\n      setDisplayContact = _useState10[1];\n\n  var _useState11 = useState([]),\n      carspecIds = _useState11[0],\n      setCarspecIds = _useState11[1];\n\n  var _useState12 = useState(0),\n      count = _useState12[0],\n      setCount = _useState12[1];\n\n  useEffect(function () {\n    if (props.productDetails._id != id) {\n      setId(props.productDetails._id);\n      setProductDetails(props.productDetails);\n      setCompanyId(props.productDetails.companys._id);\n\n      var uniqSpec = _.uniqBy(props.productDetails.carspecsAll.specification, 'category');\n\n      var cloneUniqSpec = _.cloneDeep(uniqSpec);\n\n      uniqSpec.map(function (v, i) {\n        cloneUniqSpec[i].key = i;\n        cloneUniqSpec[i].children = [];\n        cloneUniqSpec[i].field = 'skip';\n        cloneUniqSpec[i].value = 'skip';\n        props.productDetails.carspecsAll.specification.map(function (v1, i1) {\n          if (v1.category == v.category) {\n            cloneUniqSpec[i].children.push({\n              key: i + '' + i1,\n              field: v1.field,\n              value: v1.value\n            });\n          }\n        });\n      });\n      setCarSpecs(cloneUniqSpec);\n    }\n  });\n  useEffect(function () {\n    if (!props.productsList.checkedFeaturesDate || moment(props.productsList.checkedFeaturesDate).isBefore(moment(), 'day')) {\n      props.loading(true);\n      axios.get(\"\".concat(client.io.io.uri, \"getFeatureList\")).then(function (res) {\n        props.loading(false);\n        props.fetchFeaturesList(res.data.data);\n        props.updateCheckedFeaturesDate(moment());\n      })[\"catch\"](function (err) {\n        props.loading(false);\n        message.error(err.message);\n      });\n    }\n  }, []);\n  useEffect(function () {\n    getRatings((ratingPage - 1) * RATINGPAGESIZE);\n  }, [ratingPage]);\n  useEffect(function () {\n    init();\n    setCarspecIds(_.compact([_.get(productDetails, 'carspecsAll._id')]));\n  }, [productDetails, props.user]); // useEffect(() => {\n  //     setCount(count + 1);\n  //     if (count < 10) {\n  //         console.log(props.user);\n  //         props.loading(!props.app.loading)\n  //     }\n  // }, [props.user])\n\n  function init() {\n    if (ratingPage == 1) {\n      getRatings(0);\n    } else {\n      setRatingPage(1);\n    }\n\n    setRatingTotal(0);\n    getOwnRating();\n  }\n\n  function getRatings(skip) {\n    if (_.get(productDetails, ['carspecsId', '_id'])) {\n      var query = {\n        carspecId: _.get(productDetails, ['carspecsId', '_id']),\n        type: 'carspec',\n        $populate: [{\n          path: 'carspecId',\n          ref: 'carspecs'\n        }, {\n          path: 'reviewerId',\n          ref: 'users'\n        }],\n        $limit: RATINGPAGESIZE,\n        $skip: skip\n      };\n\n      if (props.user.authenticated) {\n        query.reviewerId = {\n          $ne: props.user.info.user._id\n        };\n        query[\"hideBy.userId\"] = {\n          $ne: props.user.info.user._id\n        };\n      }\n\n      props.loading(true);\n      client.service('rating').find({\n        query: query\n      }).then(function (res) {\n        props.loading(false);\n\n        if (notEmptyLength(res.data)) {\n          var data = ratings.concat(res.data);\n          setRatingTotal(res.total);\n          setRatings(data);\n        }\n      })[\"catch\"](function (err) {\n        props.loading(false);\n        message.error(err.message);\n      });\n    } else {\n      setRatings([]);\n    }\n  }\n\n  function getOwnRating() {\n    if (_.get(productDetails, ['carspecsId', '_id']) && props.user.authenticated) {\n      props.loading(true);\n      client.service('rating').find({\n        query: {\n          type: 'carspec',\n          carspecId: _.get(productDetails, ['carspecsId', '_id']),\n          reviewerId: props.user.info.user._id,\n          $populate: [{\n            path: 'carspecId',\n            ref: 'carspecs'\n          }, {\n            path: 'reviewerId',\n            ref: 'users'\n          }],\n          $limit: 1\n        }\n      }).then(function (res) {\n        props.loading(false);\n\n        if (notEmptyLength(res.data)) {\n          setOwnRating(res.data);\n        } else {\n          setOwnRating([]);\n        }\n      })[\"catch\"](function (err) {\n        props.loading(false);\n        message.error(err.message);\n      });\n    } else {\n      setOwnRating([]);\n    }\n  }\n\n  var callback = function callback(key) {}; // function getFeatureText(data) {\n  //     switch (data) {\n  //         case \"abs\":\n  //             return 'ABS';\n  //         case \"adjustablesteeringwheel\":\n  //             return 'Adjustable Steering Wheel';\n  //         case \"airbags\":\n  //             return \"Air bags\"\n  //         case \"alarm\":\n  //             return \"Alarm\"\n  //         case \"blindspotmonitor\":\n  //             return \"Blind spot monitor\"\n  //         case \"bodykits\":\n  //             return \"Body Kits\"\n  //         case \"brakeassist\":\n  //             return \"Brake Assist\"\n  //         case \"bucketseat\":\n  //             return \"Bucket Seat\"\n  //         case \"cdplayer\":\n  //             return \"Cd Player\"\n  //         case \"centrallocks\":\n  //             return \"Central Locks\"\n  //         case \"centraltouchscreen\":\n  //             return \"Central touchscreen\"\n  //         case \"childsafetylock\":\n  //             return \"Child safety lock\"\n  //         case \"cruisecontrol\":\n  //             return \"Cruise Control\"\n  //         case \"daytimerunninglights\":\n  //             return \"Daytime running lights\"\n  //         case \"driveradjustablelumbar\":\n  //             return \"Driver adjustable lumbar\"\n  //         case \"drivervanityminor\":\n  //             return \"Driver Vanity minor\"\n  //         case \"electricseat\":\n  //             return \"Electric Seat\"\n  //         case \"foglamps\":\n  //             return \"Fog Lamps\"\n  //         case \"frontwheeldrive\":\n  //             return \"Front Wheel Drive\"\n  //         case \"gpsnavigation\":\n  //             return \"GPS Navigation\"\n  //         case \"heatedfrontseat\":\n  //             return \"Heated Front Seat\"\n  //         case \"keylessstart\":\n  //             return \"Keyless Start\"\n  //         case \"lanedeparturewarning\":\n  //             return \"Lane departure warning\"\n  //         case \"leatherseats\":\n  //             return \"Leather Seats\"\n  //         case \"manufacturerwarranty\":\n  //             return \"Manufacturer Warranty\"\n  //         case \"mp3players\":\n  //             return \"MP3 Players\"\n  //         case \"multifunctionsteering\":\n  //             return \"Multi Function Steering\"\n  //         case \"paddleshift\":\n  //             return \"Paddle Shift\"\n  //         case \"parkingsensor\":\n  //             return \"Parking Sensor\"\n  //         case \"passangerilluminatedvisormirror\":\n  //             return \"Passanger Illuminated visor mirror\"\n  //         case \"powersteering\":\n  //             return \"Power Steering\"\n  //         case \"powerwindow\":\n  //             return \"Power Window\"\n  //         case \"reardefrost\":\n  //             return \"Rear Defrost\"\n  //         case \"reservecamera\":\n  //             return \"Reserve Camera\"\n  //         case \"sportrims\":\n  //             return \"Sport rims\"\n  //         case \"stabilitycontrol\":\n  //             return \"Stability Control\"\n  //         case \"steeringwheelaudio\":\n  //             return \"Steering Wheel Audio\"\n  //         case \"sunroof/moonroof\":\n  //             return \"Sunroof / Moonroof\"\n  //         case \"telematics\":\n  //             return \"Telematics\"\n  //         case \"tripcomputer\":\n  //             return \"Trip Computer\"\n  //         case \"usb\":\n  //             return \"USB\"\n  //         case \"wheellock\":\n  //             return \"Wheel lock\"\n  //         case \"windowtint\":\n  //             return \"Window Tint\"\n  //         case \"wipes\":\n  //             return \"Wipes\"\n  //         default:\n  //             return null;\n  //     }\n  // }\n\n\n  function expandAllRow() {\n    if (notEmptyLength(carSpecs)) {\n      var keys = _.map(carSpecs, 'key');\n\n      if (notEmptyLength(keys)) {\n        setExpandedRow(keys);\n      }\n    } else {\n      setExpandedRow([]);\n    }\n  }\n\n  function shrinkAllRow() {\n    setExpandedRow([]);\n  }\n\n  var _renderFeatures = function _renderFeatures(data) {\n    if (notEmptyLength(props.productsList.featuresList) && notEmptyLength(data)) {\n      var temp = _.filter(props.productsList.featuresList, function (item) {\n        return _.includes(data, item.value);\n      });\n\n      if (notEmptyLength(temp)) {\n        var list = temp.map(function (item) {\n          return __jsx(Col, {\n            span: 8\n          }, __jsx(\"div\", {\n            className: \"flex-justify-start flex-items-align-center padding-x-sm fill-parent \"\n          }, __jsx(\"span\", {\n            className: \"margin-x-sm relative-wrapper\",\n            style: {\n              height: \"30px\",\n              width: '30px'\n            }\n          }, __jsx(\"img\", {\n            src: item.icon ? item.icon : null,\n            className: \"fill-parent absolute-center\"\n          })), __jsx(\"span\", {\n            className: \"padding-sm headline flex-justify-center flex-items-align-center text-truncate-threeline\"\n          }, item.text ? item.text : null)));\n        });\n        return __jsx(\"div\", {\n          style: {\n            minHeight: 500\n          }\n        }, __jsx(Row, {\n          type: \"flex\",\n          align: \"middle\",\n          gutter: [10, 10]\n        }, list));\n      } else {\n        return __jsx(Empty, {\n          style: {\n            position: 'relative',\n            top: '50%',\n            transform: 'translateY(-50%)'\n          },\n          image: \"/empty.png\",\n          imageStyle: {\n            height: 60\n          },\n          description: __jsx(\"span\", null, \"No Result\")\n        });\n      }\n    } else {\n      return __jsx(Empty, {\n        style: {\n          position: 'relative',\n          top: '50%',\n          transform: 'translateY(-50%)'\n        },\n        image: \"/empty.png\",\n        imageStyle: {\n          height: 60\n        },\n        description: __jsx(\"span\", null, \"No Result\")\n      });\n    }\n  };\n\n  var _renderExpandButton = function _renderExpandButton() {\n    return __jsx(React.Fragment, null, __jsx(Button, {\n      icon: \"arrows-alt\",\n      onClick: expandAllRow,\n      className: \"background-ccar-yellow margin-x-sm\"\n    }, \"Expand All\"), __jsx(Button, {\n      icon: \"shrink\",\n      onClick: shrinkAllRow,\n      className: \"margin-x-sm\"\n    }, \"Shrink All\"));\n  };\n\n  function changeProductDetails(data, type) {\n    if (_.isEmpty(data) === true) {\n      return;\n    }\n\n    var dataString = _.cloneDeep(data);\n\n    var phoneFormat = /((601)|(01))[0-46-9]*[0-9]{7,10}/gim;\n    var phoneFormat2 = /([601]|[01]|)[0-46-9]-*[0-9]{7,10}/g;\n    dataString = dataString.split('\\n');\n    dataString = dataString.map(function (v) {\n      var v2 = v;\n      v = v.replace(/\\s/g, '');\n      v = v.replace(/\\+/g, '');\n      v = v.replace(/-/g, '');\n      var n = v.match(phoneFormat);\n      var s = v.split(phoneFormat2);\n      var x = '';\n\n      if (_.isEmpty(n) === true) {\n        return __jsx(\"p\", {\n          style: {\n            marginBottom: '0em'\n          }\n        }, v2);\n      }\n\n      s = _.without(s, '6');\n      s = _.without(s, '0');\n      s = _.without(s, '');\n      x = s.map(function (v, i) {\n        if (n[i]) {\n          if (type === 'callContact') {\n            if (n[i].charAt(0) !== '6') {\n              n[i] = '6' + n[i];\n            }\n\n            if (isMobile) {\n              v = __jsx(React.Fragment, null, __jsx(React.Fragment, null, v), \" \", __jsx(\"a\", {\n                className: \"contactShow\",\n                target: '_blank',\n                href: \"tel:\" + n[i]\n              }, n[i]));\n            } else {\n              var username = '';\n\n              try {\n                username = productDetails.createdBy.namePrefix + ' ' + productDetails.createdBy.fullName;\n              } catch (err) {\n                username = '';\n              }\n\n              v = __jsx(React.Fragment, null, __jsx(React.Fragment, null, v), \" \", __jsx(\"a\", {\n                className: \"contactShow\",\n                target: '_blank',\n                href: \"https://web.whatsapp.com/send?phone=\" + n[i].replace('+', '') + \"&text=Hi \" + username + \", I am interested in your car ad on ccar.my and I would like to know more about \" + productDetails.title + \" (RM \" + productDetails.price.toFixed(2) + \"). Thank you. https://share.ccar.my/viewCar/\" + productDetails._id\n              }, n[i]));\n            }\n          } else {\n            v = __jsx(React.Fragment, null, __jsx(React.Fragment, null, v), \" \", __jsx(\"span\", {\n              className: \"contactHide\",\n              onClick: function onClick() {\n                setDisplayContact(true);\n              }\n            }, \"(Click to View Contact No.)\"));\n          }\n        }\n\n        return v;\n      });\n      return __jsx(\"p\", {\n        style: {\n          marginBottom: '0em'\n        }\n      }, x);\n    });\n    return dataString;\n  }\n\n  return __jsx(\"div\", null, __jsx(Card, {\n    size: \"small\"\n  }, __jsx(\"p\", {\n    style: {\n      whiteSpace: 'pre-wrap'\n    }\n  }, displayContact ? changeProductDetails(productDetails.description, 'callContact') : changeProductDetails(productDetails.description))));\n};\n\n_s(Description, \"mH+Q2WpKmdqg5Ct2yxulaMvkeOs=\");\n\n_c = Description;\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    user: state.user,\n    app: state.app,\n    productsList: state.productsList\n  };\n};\n\nvar mapDispatchToProps = {\n  loading: loading,\n  fetchFeaturesList: fetchFeaturesList,\n  updateCheckedFeaturesDate: updateCheckedFeaturesDate\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(Form.create()(withRouter(Description)));\n\nvar _c;\n\n$RefreshReg$(_c, \"Description\");","map":{"version":3,"sources":["/Users/faraheen/ccar-cms-next-mobile/components/product-list/Description.jsx"],"names":["Button","Card","Col","Empty","Form","message","Row","Select","Tabs","axios","_","moment","withRouter","React","useEffect","useState","connect","notEmptyLength","client","loading","fetchFeaturesList","updateCheckedFeaturesDate","CarspecsCompareTable","isIOS","isMobile","OverallRating","RatingProgress","WriteReviewButton","ReviewList2","TabPane","Option","reviewContainerRef","createRef","RATINGPAGESIZE","columns","title","dataIndex","key","render","text","row","field","children","props","colSpan","Description","id","setId","companyId","setCompanyId","productDetails","setProductDetails","carSpecs","setCarSpecs","expandedRow","setExpandedRow","ratings","setRatings","ratingPage","setRatingPage","ratingTotal","setRatingTotal","ownRating","setOwnRating","displayContact","setDisplayContact","carspecIds","setCarspecIds","count","setCount","_id","companys","uniqSpec","uniqBy","carspecsAll","specification","cloneUniqSpec","cloneDeep","map","v","i","value","v1","i1","category","push","productsList","checkedFeaturesDate","isBefore","get","io","uri","then","res","data","err","error","getRatings","init","compact","user","getOwnRating","skip","query","carspecId","type","$populate","path","ref","$limit","$skip","authenticated","reviewerId","$ne","info","service","find","concat","total","callback","expandAllRow","keys","shrinkAllRow","_renderFeatures","featuresList","temp","filter","item","includes","list","height","width","icon","minHeight","position","top","transform","_renderExpandButton","changeProductDetails","isEmpty","dataString","phoneFormat","phoneFormat2","split","v2","replace","n","match","s","x","marginBottom","without","charAt","username","createdBy","namePrefix","fullName","price","toFixed","whiteSpace","description","mapStateToProps","state","app","mapDispatchToProps","create"],"mappings":"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ADV;AAEIC,YAAAA,GAAG,EAAE;AAFT,WALO,CAJR;AAcHC,UAAAA,MAAM,EAAE;AAdL;AADmB,OAA9B,EAkBGjB,IAlBH,CAkBQ,UAACC,GAAD,EAAS;AACblD,QAAAA,KAAK,CAACxB,OAAN,CAAc,KAAd;;AACA,YAAIF,cAAc,CAAC4E,GAAG,CAACC,IAAL,CAAlB,EAA8B;AAC1B/B,UAAAA,YAAY,CAAC8B,GAAG,CAACC,IAAL,CAAZ;AACH,SAFD,MAEO;AACH/B,UAAAA,YAAY,CAAC,EAAD,CAAZ;AACH;AACJ,OAzBD,WA0BW,UAACgC,GAAD,EAAS;AACZpD,QAAAA,KAAK,CAACxB,OAAN,CAAc,KAAd;AACAd,QAAAA,OAAO,CAAC2F,KAAR,CAAcD,GAAG,CAAC1F,OAAlB;AACH,OA7BL;AA8BH,KAjCD,MAiCO;AACH0D,MAAAA,YAAY,CAAC,EAAD,CAAZ;AACH;AACJ;;AAED,MAAMwD,QAAQ,GAAG,SAAXA,QAAW,CAAClF,GAAD,EAAS,CACzB,CADD,CAjL2B,CAoL3B;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA,WAASmF,YAAT,GAAwB;AACpB,QAAIvG,cAAc,CAACmC,QAAD,CAAlB,EAA8B;AAC1B,UAAIqE,IAAI,GAAG/G,CAAC,CAACoE,GAAF,CAAM1B,QAAN,EAAgB,KAAhB,CAAX;;AACA,UAAInC,c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","sourcesContent":["import { Button, Card, Col, Empty, Form, message, Row, Select, Tabs } from 'antd';\nimport axios from 'axios';\nimport _ from 'lodash';\nimport moment from 'moment';\nimport { withRouter } from 'next/router';\nimport React, { useEffect, useState } from 'react';\nimport { connect } from 'react-redux';\nimport { notEmptyLength } from '../../common-function';\nimport client from '../../feathers';\nimport { loading } from '../../redux/actions/app-actions';\nimport { fetchFeaturesList, updateCheckedFeaturesDate } from '../../redux/actions/productsList-actions';\nimport CarspecsCompareTable from '../compare/CarspecsCompareTable';\nimport { isIOS, isMobile } from 'react-device-detect'\nimport OverallRating from '../rating/OverallRating';\nimport RatingProgress from '../rating/RatingProgress';\nimport WriteReviewButton from '../rating/WriteReviewButton';\nimport ReviewList2 from '../rating/ReviewList2';\n\n\nconst { TabPane } = Tabs;\nconst { Option } = Select;\nconst reviewContainerRef = React.createRef();\n\nconst RATINGPAGESIZE = 4;\n\n\n\nconst columns = [\n    {\n        title: 'Category',\n        dataIndex: 'category',\n        key: 'category',\n        render: (text, row) => {\n            if (row.field == 'skip') {\n                return {\n                    children: <span><strong>{text}</strong></span>,\n                    props: {\n                        colSpan: 3,\n                    },\n                };\n            } else {\n                return {\n                    children: <span>{text}</span>,\n                };\n            }\n        },\n    },\n    {\n        title: 'Field',\n        dataIndex: 'field',\n        key: 'field',\n        render: (text, row) => {\n            if (text == 'skip') {\n                return {\n                    props: {\n                        colSpan: 0,\n                    },\n                };\n            } else {\n                return {\n                    children: <span>{text}</span>,\n                };\n            }\n        },\n    },\n    {\n        title: 'Value',\n        dataIndex: 'value',\n        key: 'value',\n        render: (text, row) => {\n            if (text == 'skip') {\n                return {\n                    props: {\n                        colSpan: 0,\n                    },\n                };\n            } else {\n                return {\n                    children: <span>{text}</span>,\n                };\n            }\n        },\n    },\n];\n\nconst Description = (props) => {\n    const [id, setId] = useState('')\n    const [companyId, setCompanyId] = useState(null)\n    const [productDetails, setProductDetails] = useState({})\n    const [carSpecs, setCarSpecs] = useState([])\n    const [expandedRow, setExpandedRow] = useState([])\n    const [ratings, setRatings] = useState([])\n    const [ratingPage, setRatingPage] = useState(1)\n    const [ratingTotal, setRatingTotal] = useState(0)\n    const [ownRating, setOwnRating] = useState([])\n    const [displayContact, setDisplayContact] = useState(false)\n    const [carspecIds, setCarspecIds] = useState([])\n\n    const [count, setCount] = useState(0)\n\n    useEffect(() => {\n        if (props.productDetails._id != id) {\n            setId(props.productDetails._id)\n            setProductDetails(props.productDetails)\n            setCompanyId(props.productDetails.companys._id)\n\n            let uniqSpec = _.uniqBy(props.productDetails.carspecsAll.specification, 'category')\n            let cloneUniqSpec = _.cloneDeep(uniqSpec)\n            uniqSpec.map((v, i) => {\n                cloneUniqSpec[i].key = i\n                cloneUniqSpec[i].children = []\n                cloneUniqSpec[i].field = 'skip'\n                cloneUniqSpec[i].value = 'skip'\n                props.productDetails.carspecsAll.specification.map((v1, i1) => {\n                    if (v1.category == v.category) {\n                        cloneUniqSpec[i].children.push({ key: i + '' + i1, field: v1.field, value: v1.value })\n                    }\n                })\n            })\n\n            setCarSpecs(cloneUniqSpec)\n        }\n    })\n\n    useEffect(() => {\n\n        if (!props.productsList.checkedFeaturesDate || moment(props.productsList.checkedFeaturesDate).isBefore(moment(), 'day')) {\n            props.loading(true);\n            axios.get(`${client.io.io.uri}getFeatureList`).then(res => {\n                props.loading(false);\n                props.fetchFeaturesList(res.data.data);\n                props.updateCheckedFeaturesDate(moment());\n            }).catch(err => {\n                props.loading(false);\n                message.error(err.message)\n            });\n        }\n    }, []);\n\n\n\n    useEffect(() => {\n\n        getRatings((ratingPage - 1) * RATINGPAGESIZE);\n    }, [ratingPage])\n\n\n    useEffect(() => {\n        init();\n        setCarspecIds(_.compact([_.get(productDetails , 'carspecsAll._id')]));\n    }, [productDetails, props.user])\n\n    // useEffect(() => {\n    //     setCount(count + 1);\n    //     if (count < 10) {\n    //         console.log(props.user);\n    //         props.loading(!props.app.loading)\n    //     }\n    // }, [props.user])\n\n\n\n    function init() {\n        if (ratingPage == 1) {\n            getRatings(0);\n        } else {\n            setRatingPage(1);\n        }\n        setRatingTotal(0);\n        getOwnRating();\n    }\n\n    function getRatings(skip) {\n        if (_.get(productDetails, ['carspecsId', '_id'])) {\n\n            let query = {\n                carspecId: _.get(productDetails, ['carspecsId', '_id']),\n                type: 'carspec',\n                $populate: [\n                    {\n                        path: 'carspecId',\n                        ref: 'carspecs'\n                    },\n                    {\n                        path: 'reviewerId',\n                        ref: 'users'\n                    }\n                ],\n                $limit: RATINGPAGESIZE,\n                $skip: skip,\n            }\n\n            if (props.user.authenticated) {\n                query.reviewerId = {\n                    $ne: props.user.info.user._id,\n                }\n\n                query[\"hideBy.userId\"] = {\n                    $ne: props.user.info.user._id,\n                }\n            }\n            props.loading(true);\n            client.service('rating').find({\n                query\n            }).then((res) => {\n                props.loading(false);\n                if (notEmptyLength(res.data)) {\n                    let data = ratings.concat(res.data);\n                    setRatingTotal(res.total);\n                    setRatings(data);\n                }\n            })\n                .catch((err) => {\n                    props.loading(false);\n                    message.error(err.message);\n                })\n        } else {\n            setRatings([]);\n        }\n    }\n\n\n\n    function getOwnRating() {\n        if (_.get(productDetails, ['carspecsId', '_id']) && props.user.authenticated) {\n\n            props.loading(true);\n            client.service('rating').find({\n                query: {\n                    type: 'carspec',\n                    carspecId: _.get(productDetails, ['carspecsId', '_id']),\n                    reviewerId: props.user.info.user._id,\n                    $populate: [\n                        {\n                            path: 'carspecId',\n                            ref: 'carspecs'\n                        },\n                        {\n                            path: 'reviewerId',\n                            ref: 'users'\n                        }\n                    ],\n                    $limit: 1,\n                }\n\n            }).then((res) => {\n                props.loading(false);\n                if (notEmptyLength(res.data)) {\n                    setOwnRating(res.data);\n                } else {\n                    setOwnRating([]);\n                }\n            })\n                .catch((err) => {\n                    props.loading(false);\n                    message.error(err.message);\n                })\n        } else {\n            setOwnRating([]);\n        }\n    }\n\n    const callback = (key) => {\n    }\n\n    // function getFeatureText(data) {\n\n    //     switch (data) {\n    //         case \"abs\":\n    //             return 'ABS';\n    //         case \"adjustablesteeringwheel\":\n    //             return 'Adjustable Steering Wheel';\n    //         case \"airbags\":\n    //             return \"Air bags\"\n    //         case \"alarm\":\n    //             return \"Alarm\"\n    //         case \"blindspotmonitor\":\n    //             return \"Blind spot monitor\"\n    //         case \"bodykits\":\n    //             return \"Body Kits\"\n    //         case \"brakeassist\":\n    //             return \"Brake Assist\"\n    //         case \"bucketseat\":\n    //             return \"Bucket Seat\"\n    //         case \"cdplayer\":\n    //             return \"Cd Player\"\n    //         case \"centrallocks\":\n    //             return \"Central Locks\"\n    //         case \"centraltouchscreen\":\n    //             return \"Central touchscreen\"\n    //         case \"childsafetylock\":\n    //             return \"Child safety lock\"\n    //         case \"cruisecontrol\":\n    //             return \"Cruise Control\"\n    //         case \"daytimerunninglights\":\n    //             return \"Daytime running lights\"\n    //         case \"driveradjustablelumbar\":\n    //             return \"Driver adjustable lumbar\"\n    //         case \"drivervanityminor\":\n    //             return \"Driver Vanity minor\"\n    //         case \"electricseat\":\n    //             return \"Electric Seat\"\n    //         case \"foglamps\":\n    //             return \"Fog Lamps\"\n    //         case \"frontwheeldrive\":\n    //             return \"Front Wheel Drive\"\n    //         case \"gpsnavigation\":\n    //             return \"GPS Navigation\"\n    //         case \"heatedfrontseat\":\n    //             return \"Heated Front Seat\"\n    //         case \"keylessstart\":\n    //             return \"Keyless Start\"\n    //         case \"lanedeparturewarning\":\n    //             return \"Lane departure warning\"\n    //         case \"leatherseats\":\n    //             return \"Leather Seats\"\n    //         case \"manufacturerwarranty\":\n    //             return \"Manufacturer Warranty\"\n    //         case \"mp3players\":\n    //             return \"MP3 Players\"\n    //         case \"multifunctionsteering\":\n    //             return \"Multi Function Steering\"\n    //         case \"paddleshift\":\n    //             return \"Paddle Shift\"\n    //         case \"parkingsensor\":\n    //             return \"Parking Sensor\"\n    //         case \"passangerilluminatedvisormirror\":\n    //             return \"Passanger Illuminated visor mirror\"\n    //         case \"powersteering\":\n    //             return \"Power Steering\"\n    //         case \"powerwindow\":\n    //             return \"Power Window\"\n    //         case \"reardefrost\":\n    //             return \"Rear Defrost\"\n    //         case \"reservecamera\":\n    //             return \"Reserve Camera\"\n    //         case \"sportrims\":\n    //             return \"Sport rims\"\n    //         case \"stabilitycontrol\":\n    //             return \"Stability Control\"\n    //         case \"steeringwheelaudio\":\n    //             return \"Steering Wheel Audio\"\n    //         case \"sunroof/moonroof\":\n    //             return \"Sunroof / Moonroof\"\n    //         case \"telematics\":\n    //             return \"Telematics\"\n    //         case \"tripcomputer\":\n    //             return \"Trip Computer\"\n    //         case \"usb\":\n    //             return \"USB\"\n    //         case \"wheellock\":\n    //             return \"Wheel lock\"\n    //         case \"windowtint\":\n    //             return \"Window Tint\"\n    //         case \"wipes\":\n    //             return \"Wipes\"\n    //         default:\n    //             return null;\n    //     }\n    // }\n\n    function expandAllRow() {\n        if (notEmptyLength(carSpecs)) {\n            let keys = _.map(carSpecs, 'key');\n            if (notEmptyLength(keys)) {\n                setExpandedRow(keys);\n            }\n        } else {\n            setExpandedRow([]);\n        }\n    }\n\n    function shrinkAllRow() {\n        setExpandedRow([]);\n    }\n\n    const _renderFeatures = (data) => {\n        if (notEmptyLength(props.productsList.featuresList) && notEmptyLength(data)) {\n            let temp = _.filter(props.productsList.featuresList, function (item) {\n                return _.includes(data, item.value);\n            })\n            if (notEmptyLength(temp)) {\n\n                let list = temp.map(function (item) {\n                    return (\n                        <Col span={8}>\n                            <div className=\"flex-justify-start flex-items-align-center padding-x-sm fill-parent \">\n                                {/* <div className=\"round-border wrapBorderRed\" style={{width:'50px', height:'50px'}}> */}\n                                <span className=\"margin-x-sm relative-wrapper\" style={{ height: \"30px\", width: '30px' }}>\n                                    <img src={item.icon ? item.icon : null} className=\"fill-parent absolute-center\" />\n                                </span>\n                                {/* </div> */}\n                                <span className=\"padding-sm headline flex-justify-center flex-items-align-center text-truncate-threeline\">\n                                    {item.text ? item.text : null}\n                                </span>\n                            </div>\n                        </Col>\n                    );\n                })\n\n                return (\n                    <div style={{ minHeight: 500 }}>\n                        <Row type=\"flex\" align=\"middle\" gutter={[10, 10]} >\n                            {list}\n                        </Row>\n                    </div>\n                )\n            } else {\n                return <Empty\n                    style={{ position: 'relative', top: '50%', transform: 'translateY(-50%)' }}\n                    image=\"/empty.png\"\n                    imageStyle={{\n                        height: 60,\n                    }\n                    }\n                    description={\n                        <span>\n                            No Result\n            </span>\n                    }\n                >\n                </Empty>\n            }\n\n\n        } else {\n\n            return <Empty\n                style={{ position: 'relative', top: '50%', transform: 'translateY(-50%)' }}\n                image=\"/empty.png\"\n                imageStyle={{\n                    height: 60,\n                }\n                }\n                description={\n                    <span>\n                        No Result\n            </span>\n                }\n            >\n            </Empty>\n        }\n    }\n\n    const _renderExpandButton = () => {\n        return (\n            <React.Fragment>\n\n                <Button icon=\"arrows-alt\" onClick={expandAllRow} className=\"background-ccar-yellow margin-x-sm\">\n                    Expand All\n            </Button>\n                <Button icon=\"shrink\" onClick={shrinkAllRow} className=\"margin-x-sm\">\n                    Shrink All\n            </Button>\n            </React.Fragment>\n        )\n    }\n\n    function changeProductDetails(data, type) {\n\n        if (_.isEmpty(data) === true) { return }\n        let dataString = _.cloneDeep(data)\n        let phoneFormat = /((601)|(01))[0-46-9]*[0-9]{7,10}/gim\n        let phoneFormat2 = /([601]|[01]|)[0-46-9]-*[0-9]{7,10}/g\n\n        dataString = dataString.split('\\n')\n        dataString = dataString.map(function (v) {\n\n            let v2 = v\n            v = v.replace(/\\s/g, '')\n            v = v.replace(/\\+/g, '')\n            v = v.replace(/-/g, '')\n            let n = v.match(phoneFormat);\n            let s = v.split(phoneFormat2);\n\n\n            let x = ''\n            if (_.isEmpty(n) === true) { return <p style={{ marginBottom: '0em' }}>{v2}</p> }\n\n            s = _.without(s, '6')\n            s = _.without(s, '0')\n            s = _.without(s, '')\n            x = s.map(function (v, i) {\n\n                if (n[i]) {\n                    if (type === 'callContact') {\n\n                        if (n[i].charAt(0) !== '6') {\n                            n[i] = '6' + n[i]\n                        }\n\n                        if (isMobile) {\n                            v = <><>{v}</> <a className='contactShow'\n                                target={'_blank'}\n                                href={\"tel:\" + n[i]}\n                            >{n[i]}</a></>\n                        }\n                        else {\n\n                            let username = ''\n                            try {\n                                username = productDetails.createdBy.namePrefix + ' ' + productDetails.createdBy.fullName\n                            }\n                            catch (err) { username = '' }\n\n                            v = <><>{v}</> <a className='contactShow'\n                                target={'_blank'}\n                                href={\n                                    \"https://web.whatsapp.com/send?phone=\"\n                                    + n[i].replace('+', '') + \"&text=Hi \"\n                                    + username\n                                    + \", I am interested in your car ad on ccar.my and I would like to know more about \"\n                                    + productDetails.title\n                                    + \" (RM \"\n                                    + productDetails.price.toFixed(2) + \"). Thank you. https://share.ccar.my/viewCar/\"\n                                    + productDetails._id}\n\n                            >{n[i]}</a></>\n                        }\n                    }\n                    else {\n                        v = <><>{v}</> <span className='contactHide' onClick={() => { setDisplayContact(true) }}>(Click to View Contact No.)</span></>\n                    }\n                }\n                return v\n            })\n            return <p style={{ marginBottom: '0em' }}>{x}</p>\n        })\n        return dataString\n    }\n\n    return (\n        <div>\n            <Card size=\"small\">\n                <p style={{ whiteSpace: 'pre-wrap' }}  >{displayContact ? changeProductDetails(productDetails.description, 'callContact') : changeProductDetails(productDetails.description)}</p>\n            </Card>\n        </div >\n    );\n}\n\nconst mapStateToProps = state => ({\n    user: state.user,\n    app: state.app,\n    productsList: state.productsList,\n});\n\nconst mapDispatchToProps = {\n    loading: loading,\n    fetchFeaturesList: fetchFeaturesList,\n    updateCheckedFeaturesDate: updateCheckedFeaturesDate,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Form.create()(withRouter(Description)));"]},"metadata":{},"sourceType":"module"}