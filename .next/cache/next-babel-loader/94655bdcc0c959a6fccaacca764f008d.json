{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport { Button, Col, Empty, message, Row } from 'antd';\nimport _ from 'lodash';\nimport TweenOne from 'rc-tween-one';\nimport BezierPlugin from 'rc-tween-one/lib/plugin/BezierPlugin';\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport io from 'socket.io-client';\nimport { v4 } from 'uuid';\nimport { isValidNumber, notEmptyLength, objectRemoveEmptyValue } from '../../common-function';\nimport client from '../../feathers';\nimport { updateActiveMenu } from '../../redux/actions/app-actions';\nimport { clearClientSocketIo, fetchClientSocketIo } from '../../redux/actions/live-action';\nimport { updateSocketInfo } from '../../redux/actions/socketRefresh-actions';\nimport LayoutV2 from '../general/LayoutV2';\nimport SocialVideoTabs from '../news/social-video-tabs';\nimport BroadcasterList from './broadcaster-list';\nimport { getStreamUrl } from './config';\nimport LiveBoxPreview1 from './live-box-preview-1';\nimport { withRouter } from 'next/router';\nimport Link from 'next/link';\nimport { isIOS, isMobile } from 'react-device-detect';\nimport BroadCasterListScroll from './BroadCasterListScroll';\nTweenOne.plugins.push(BezierPlugin);\nvar banner = 'hands-on-wheel.jpg';\nvar ads = '20-Car-Dealership-Promotion-Ideas.jpg';\nvar TOP_LIVE_LIMIT = 2;\nvar RECORDED_LIVE_LIMIT = 6;\nvar pc_config = {\n  iceServers: [{\n    urls: [\"stun:ss-turn2.xirsys.com\"]\n  }, {\n    username: \"K7RYJQ0iO86IzU-paa6guXxfLJ7vXWhFwfWzE3X88-LOsT0QN4vquwAUx1vsJJmqAAAAAF-yezBjY2FyMzEzMQ==\",\n    credential: \"a5e31b16-280d-11eb-89e3-0242ac140004\",\n    urls: [\"turn:ss-turn2.xirsys.com:80?transport=udp\", \"turn:ss-turn2.xirsys.com:3478?transport=udp\", \"turn:ss-turn2.xirsys.com:80?transport=tcp\", \"turn:ss-turn2.xirsys.com:3478?transport=tcp\", \"turns:ss-turn2.xirsys.com:443?transport=tcp\", \"turns:ss-turn2.xirsys.com:5349?transport=tcp\"]\n  }]\n};\n\nvar LiveIndex = /*#__PURE__*/function (_React$Component) {\n  _inherits(LiveIndex, _React$Component);\n\n  var _super = _createSuper(LiveIndex);\n\n  function LiveIndex(props) {\n    var _this;\n\n    _classCallCheck(this, LiveIndex);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"componentDidMount\", function () {\n      _this.props.updateSocketInfo(false); // this.getRecordedLives();\n\n\n      var isLoggedIn = _.isEmpty(_this.props.user.info.user); // \"https://upload.wikimedia.org/wikipedia/commons/f/f8/Odin%2C_der_G%C3%B6ttervater.jpg\"\n\n\n      _this.activeSocket = io( // client.io.io.uri,\n      getStreamUrl(client.io.io.uri), {\n        query: {\n          // 'customerName': this.props.displayName,\n          // customerDbId: this.props.userId,\n          // customerAvatar: this.props.userAvatar\n          'customerName': _this.props.user.authenticated ? \"\".concat(_this.props.user.info.user.firstName, \" \").concat(_this.props.user.info.user.lastName) : 'Ccar User',\n          customerDbId: _this.props.user.authenticated ? _this.props.user.info.user._id : v4(),\n          customerAvatar: _this.props.user.authenticated ? _.get(_this.props.user, ['info', 'user', 'avatar']) || \"https://is4-ssl.mzstatic.com/image/thumb/Purple124/v4/fe/6f/1a/fe6f1a3a-9d14-cfdf-499c-222b7b842fb2/source/512x512bb.jpg\" : \"https://is4-ssl.mzstatic.com/image/thumb/Purple124/v4/fe/6f/1a/fe6f1a3a-9d14-cfdf-499c-222b7b842fb2/source/512x512bb.jpg\"\n        }\n      });\n\n      _this.newSocketConfig(_this.activeSocket); //this o\n      // this.socketConfig();\n\n\n      window.addEventListener('beforeunload', _this.componentCleanup);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"newSocketConfig\", function (socket) {\n      socket.on(\"pushAllBroadcaster\", function (broadcasters) {\n        var broadcastersArr = Object.entries(broadcasters);\n\n        if (notEmptyLength(broadcastersArr)) {\n          //Restruct data\n          broadcastersArr = _.map(broadcastersArr, function (broadcaster) {\n            broadcaster[1].name = broadcaster[1].dealerName;\n            broadcaster[1].avatar = broadcaster[1].dealerAvatar;\n            broadcaster[1].dealerSocketId = broadcaster[0];\n            broadcaster[1].dealerVideoThumbnailUrl = \"\".concat(getStreamUrl(client.io.io.uri), \"/dealerVideoThumbnails/\").concat(broadcaster[0], \".png\");\n            return broadcaster[1];\n          });\n        } else {\n          broadcastersArr = [];\n        }\n\n        _this.setState(function () {\n          return {\n            broadcasters: broadcastersArr,\n            // broadcasters: _.slice(broadcastersArr, 0, TOP_LIVE_LIMIT),\n            filteredBroadcasters: broadcastersArr // activeBroadcasterId: broadcastersArr[0][0],\n\n          };\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"syncPeerConnections\", function () {\n      var self = _assertThisInitialized(_this);\n\n      try {\n        var peerConnections = Object.entries(_this.state.peerConnections); //Broadcasters\n\n        var newIds = _.compact(_.map(_.cloneDeep(_this.state.broadcasters), function (broadcaster) {\n          return broadcaster.dealerSocketId;\n        })); // if (notEmptyLength(this.state.popularLives)) {\n        //     let popularLiveIds = _.compact(_.map(_.cloneDeep(this.state.popularLives), function (popularLive) {\n        //         if (popularLive.liveType == 'current') {\n        //             return popularLive.dealerSocketId;\n        //         } else {\n        //             return null;\n        //         }\n        //     }));\n        //     newIds = _.union(newIds, popularLiveIds);\n        // }\n\n\n        var peerConnectionToAddIds = _.compact(_.map(newIds, function (id) {\n          return !_.some(peerConnections, function (peerConnection) {\n            return peerConnection[0] == id;\n          }) ? id : null;\n        }));\n\n        var peerConnectionToRemoveIds = _.compact(_.map(peerConnections, function (peerConnection) {\n          return !_.some(newIds, function (id) {\n            return peerConnection[0] == id;\n          }) ? peerConnection[0] : null;\n        }));\n\n        _.forEach(peerConnectionToAddIds, function (id) {\n          if (!self.state.peerConnections[id] || !self.state.peerConnections[id].pc) {\n            self.createOffer(id);\n          }\n        });\n\n        _.forEach(peerConnectionToRemoveIds, function (id) {\n          if (self.state.peerConnections[id] || self.state.peerConnections[id].pc) {\n            self.closeThePeerConnection(id);\n          }\n        }); //Find removed peerConnections\n\n      } catch (error) {\n        console.log(error);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"sendToPeer\", function (messageType, payload) {\n      _this.activeSocket.emit(messageType, {\n        senderId: _this.activeSocket.id,\n        payload: payload\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"closeThePeerConnection\", function (previousDealerSocketId) {\n      var peerConnections = _.cloneDeep(_this.state.peerConnections);\n\n      if (!!peerConnections[previousDealerSocketId]) {\n        if (!!peerConnections[previousDealerSocketId].pc) {\n          peerConnections[previousDealerSocketId].pc.close();\n\n          _this.activeSocket.emit('closeClientSocket', previousDealerSocketId);\n\n          delete peerConnections[previousDealerSocketId];\n\n          _this.setState({\n            peerConnections: peerConnections\n          });\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"setBroadcasterAnswer\", function (data) {\n      if (!data || !data.sdp || !data.dealerSocketId) {\n        return null;\n      } else {\n        var peerConnections = _this.state.peerConnections;\n\n        if (!!peerConnections[data.dealerSocketId]) {\n          if (!!peerConnections[data.dealerSocketId].pc) {\n            peerConnections[data.dealerSocketId].pc.setRemoteDescription(new RTCSessionDescription(data.sdp));\n          }\n        }\n\n        _this.setState({\n          peerConnections: peerConnections\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"setBroadcasterIceCandidate\", function (data) {\n      if (!data || !data.candidate || !data.dealerSocketId) {\n        return null;\n      } else {\n        var peerConnections = _this.state.peerConnections;\n\n        if (!!peerConnections[data.dealerSocketId]) {\n          if (!!peerConnections[data.dealerSocketId].pc) {\n            peerConnections[data.dealerSocketId].pc.addIceCandidate(new RTCIceCandidate(data.candidate));\n          }\n        }\n\n        _this.setState({\n          peerConnections: peerConnections\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"setBroadcasterStream\", function (dealerSocketId, stream) {\n      try {\n        var peerConnections = _this.state.peerConnections;\n\n        var self = _assertThisInitialized(_this);\n\n        if (!!peerConnections[dealerSocketId] && _.get(peerConnections, [dealerSocketId, 'videoRef', 'current']) && stream) {\n          peerConnections[dealerSocketId].videoRef.current.srcObject = stream;\n          peerConnections[dealerSocketId].stream = stream;\n\n          _this.setState({\n            peerConnections: peerConnections\n          });\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"createOffer\", function (dealerSocketId) {\n      if (!!dealerSocketId) {\n        var self = _assertThisInitialized(_this);\n\n        var peerConnections = _this.state.peerConnections;\n        peerConnections[dealerSocketId] = {\n          pc: new RTCPeerConnection(pc_config),\n          videoRef: React.createRef(),\n          stream: null\n        };\n\n        peerConnections[dealerSocketId].pc.ontrack = function (event) {\n          self.setBroadcasterStream(dealerSocketId, event.streams[0]);\n        };\n\n        peerConnections[dealerSocketId].pc.createOffer({\n          offerToReceiveVideo: 1,\n          //for audio\n          offerToReceiveAudio: 1\n        }).then(function (sdp) {\n          peerConnections[dealerSocketId].pc.setLocalDescription(sdp);\n          self.setState({\n            peerConnections: peerConnections\n          }, function () {\n            self.sendToPeer('clientRequestVideoWithDealerSocketId', {\n              sdp: sdp,\n              dealerSocketId: dealerSocketId\n            });\n          });\n        })[\"catch\"](function (x) {\n          console.log('offer failed');\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getRecordedLives\", function (skip) {\n      if (!isValidNumber(skip)) {\n        skip = 0;\n      } else {\n        skip = parseInt(skip);\n      }\n\n      _this.setState({\n        isLoading: true\n      });\n\n      client.service('live-stream-messages').find({\n        query: {\n          $limit: RECORDED_LIVE_LIMIT,\n          $sort: {\n            createdAt: -1\n          },\n          $skip: skip,\n          $populate: 'dealerDbId'\n        }\n      }).then(function (res) {\n        _this.setState({\n          isLoading: false\n        });\n\n        if (notEmptyLength(res.data)) {\n          _this.setState({\n            recordedLives: _this.state.recordedLives.concat(res.data),\n            recordedLiveTotal: res.total\n          });\n        } else {\n          _this.setState({\n            recordedLives: _this.state.recordedLives.concat([]),\n            recordedLiveTotal: res.total\n          });\n        }\n      })[\"catch\"](function (err) {\n        _this.setState({\n          isLoading: false\n        });\n\n        message.error(err.message);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_renderTopLives\", function () {\n      var self = _assertThisInitialized(_this);\n\n      if (notEmptyLength(_this.state.broadcasters)) {\n        return _this.state.broadcasters.map(function (broadcaster) {\n          return __jsx(React.Fragment, null, __jsx(Col, {\n            xs: 24,\n            sm: 24,\n            md: 12,\n            lg: 8,\n            xl: 8\n          }, __jsx(Link, {\n            shallow: false,\n            href: \"/live/\".concat(broadcaster.dealerSocketId)\n          }, __jsx(\"a\", null, __jsx(LiveBoxPreview1, {\n            data: broadcaster,\n            key: \"live-box-\".concat(broadcaster.dealerSocketId),\n            className: \"cursor-pointer\",\n            videoRef: _.get(self, ['state', 'peerConnections', _.get(broadcaster, ['dealerSocketId']), 'videoRef']),\n            dealerSocketId: broadcaster.dealerSocketId,\n            sharedSocket: self.activeSocket\n          })))));\n        });\n      } else {\n        return __jsx(Col, {\n          xs: 24,\n          sm: 24,\n          md: 24,\n          lg: 24,\n          xl: 24,\n          className: \"background-white\"\n        }, __jsx(Empty, null));\n      }\n    });\n\n    _this.state = {\n      peerConnections: {},\n      videoRef: {},\n      broadcasters: [],\n      filteredBroadcasters: [],\n      connectedUsers: 0,\n      searchWord: '',\n      popularLives: [],\n      recordedLives: [],\n      recordedLivePage: 1,\n      recordedLiveTotal: 0,\n      isLoading: false\n    };\n    _this.componentCleanup = _this.componentCleanup.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n\n  _createClass(LiveIndex, [{\n    key: \"UNSAFE_componentWillMount\",\n    value: function UNSAFE_componentWillMount() {\n      this.props.updateActiveMenu('4');\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      // if (!_.isEqual(prevState.broadcasters, this.state.broadcasters)) {\n      //   // this.socketConfig();\n      //   if (!!this.timeoutFunction) {\n      //     clearTimeout(this.timeoutFunction);\n      //   }\n      //   this.timeoutFunction = setTimeout(() => {\n      //     // this.syncPeerConnections();\n      //   }, 1000);\n      // }\n      // if (!_.isEqual(prevState.peerConnections, this.state.peerConnections)) {\n      //   console.log('peerConnections');\n      //   console.log(this.state.peerConnections);\n      // }\n      // if (prevState.recordedLivePage != this.state.recordedLivePage) {\n      //   this.getRecordedLives((this.state.recordedLivePage - 1) * RECORDED_LIVE_LIMIT)\n      // }\n      if (prevState.searchWord != this.state.searchWord) {\n        // let data = _.cloneDeep(this.state.broadcasters);\n        //no need to clone deep cuz filter returns a new obj\n        var data = this.state.broadcasters;\n        var self = this;\n\n        if (this.state.searchWord != null) {\n          data = _.filter(data, function (item) {\n            var regex = new RegExp(\"^\".concat(self.state.searchWord), 'i');\n            return regex.test(item.name);\n          });\n        }\n\n        this.setState({\n          filteredBroadcasters: data\n        });\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      if (isIOS && isMobile) {\n        setTimeout(function () {\n          window.location = \"https://apps.apple.com/my/app/ccar-my/id1526288072\";\n        }, 25);\n        window.location = \"ccarmy:/\" + this.props.router.asPath;\n      }\n\n      this.componentCleanup();\n      window.removeEventListener('beforeunload', this.componentCleanup); // remove the event handler for normal unmounting\n    }\n  }, {\n    key: \"componentCleanup\",\n    value: function componentCleanup() {\n      // this will hold the cleanup code\n      // whatever you want to do when the component is unmounted or page refreshes\n      var self = this; // if (_.isPlainObject(this.state.peerConnections) && notEmptyLength(this.state.peerConnections)) {\n      //   let peerConnections = Object.entries(this.state.peerConnections)\n      //   _.forEach(peerConnections, function (pc) {\n      //     self.closeThePeerConnection(pc[0]);\n      //   })\n      //   if (!!this.activeSocket) {\n      //     this.activeSocket.close();\n      //   }\n      // }\n\n      self.activeSocket && self.activeSocket.close();\n    }\n  }, {\n    key: \"socketConfig\",\n    value: function socketConfig() {\n      var _this2 = this;\n\n      this.activeSocket.removeEventListener('sendAnswerToClient');\n      this.activeSocket.on('sendAnswerToClient', function (data) {\n        _this2.setBroadcasterAnswer(data);\n      });\n      this.activeSocket.removeEventListener('sendCandidateToClient');\n      this.activeSocket.on('sendCandidateToClient', function (data) {\n        _this2.setBroadcasterIceCandidate(data);\n      });\n      this.activeSocket.removeEventListener('pushAllBroadcaster');\n      this.activeSocket.on(\"pushAllBroadcaster\", function (broadcasters) {\n        var broadcastersArr = Object.entries(broadcasters);\n\n        if (notEmptyLength(broadcastersArr)) {\n          //Restruct data\n          broadcastersArr = _.map(broadcastersArr, function (broadcaster) {\n            broadcaster[1].name = broadcaster[1].dealerName;\n            broadcaster[1].avatar = broadcaster[1].dealerAvatar;\n            broadcaster[1].dealerSocketId = broadcaster[0];\n            broadcaster[1].dealerVideoThumbnailUrl = \"\".concat(getStreamUrl(client.io.io.uri), \"/dealerVideoThumbnails/\").concat(broadcaster[0], \".png\");\n            return broadcaster[1];\n          });\n        } else {\n          broadcastersArr = [];\n        }\n\n        if (!_.isEqual(_this2.state.broadcasters, broadcastersArr)) {\n          _this2.setState(function () {\n            return {\n              // broadcasters: _.slice(broadcastersArr, 0, TOP_LIVE_LIMIT),\n              broadcasters: broadcastersArr,\n              filteredBroadcasters: broadcastersArr // activeBroadcasterId: broadcastersArr[0][0],\n\n            };\n          });\n        }\n      });\n      this.activeSocket.removeEventListener('newMessage');\n      this.activeSocket.on(\"newMessage\", function (data) {\n        if (notEmptyLength(objectRemoveEmptyValue(data))) {\n          var temp = _.map(_this2.state.broadcasters, function (broadcaster) {\n            if (broadcaster.dealerSocketId == data.dealerSocketId) {\n              broadcaster.connectedUsers = data.connectedUsers;\n            }\n\n            return broadcaster;\n          });\n\n          _this2.setState({\n            broadcasters: temp\n          });\n        }\n      });\n      this.activeSocket.removeEventListener('getAllMessages');\n      this.activeSocket.on(\"getAllMessages\", function (data) {\n        var temp = _.map(_this2.state.broadcasters, function (broadcaster) {\n          if (broadcaster.dealerSocketId == data.dealerSocketId) {\n            broadcaster = _objectSpread(_objectSpread({}, broadcaster), data);\n          }\n\n          return broadcaster;\n        });\n\n        _this2.setState({\n          broadcasters: temp\n        });\n      });\n      this.activeSocket.removeEventListener('getSpecialLives'); // this.activeSocket.on(\"getSpecialLives\", (data) => {\n      //     if (data) {\n      //         this.setState({\n      //             popularLives: _.isArray(data.popularLives) && notEmptyLength(data.popularLives) ? data.popularLives : [],\n      //         })\n      //     }\n      // });\n    }\n  }, {\n    key: \"render\",\n    value: //@implementation new socket code\n    //@end new socket code\n    function render() {\n      var self = this;\n      return __jsx(React.Fragment, null, __jsx(LayoutV2, null, __jsx(\"div\", {\n        className: \"section-version3\"\n      }, __jsx(\"div\", {\n        className: \"padding-x-sm padding-y-lg\"\n      }, __jsx(Row, {\n        gutter: [10, 30],\n        type: \"flex\",\n        align: \"stretch\"\n      }, __jsx(Col, {\n        style: {\n          padding: '0px'\n        },\n        xs: 24,\n        sm: 24,\n        md: 24,\n        lg: 24,\n        xl: 24\n      }, __jsx(\"div\", {\n        className: \"font-weight-bold padding-sm\"\n      }, \"Live Streamer\")), __jsx(Col, {\n        style: {\n          padding: '0px'\n        },\n        span: 4\n      }, __jsx(\"div\", {\n        className: \"width-100 background-white\"\n      }, __jsx(\"div\", {\n        className: \"width-100 \"\n      }, __jsx(BroadCasterListScroll, {\n        showName: false,\n        activeBroadcasters: notEmptyLength(this.state.filteredBroadcasters) ? this.state.filteredBroadcasters : [] // allowSearch\n\n      })))), __jsx(Col, {\n        xs: 20,\n        sm: 20,\n        md: 20,\n        lg: 20,\n        xl: 20\n      }, __jsx(Row, {\n        gutter: [10, 10]\n      }, _.isArray(this.state.broadcasters) && !_.isEmpty(this.state.broadcasters) ? this._renderTopLives() : __jsx(\"div\", {\n        className: \"flex-justify-center flex-items-align-center\"\n      }, __jsx(\"img\", {\n        style: {\n          width: '50%',\n          height: '50%'\n        },\n        src: \"/assets/live-stream.png\"\n      })))))))));\n    }\n  }]);\n\n  return LiveIndex;\n}(React.Component);\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    app: state.app,\n    user: state.user\n  };\n};\n\nvar mapDispatchToProps = {\n  updateSocketInfo: updateSocketInfo,\n  updateActiveMenu: updateActiveMenu,\n  fetchClientSocketIo: fetchClientSocketIo,\n  clearClientSocketIo: clearClientSocketIo\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(withRouter(LiveIndex));","map":{"version":3,"sources":["/Users/faraheen/ccar-cms-next-mobile/components/live/LiveHomePage.jsx"],"names":["Button","Col","Empty","message","Row","_","TweenOne","BezierPlugin","React","connect","io","v4","isValidNumber","notEmptyLength","objectRemoveEmptyValue","client","updateActiveMenu","clearClientSocketIo","fetchClientSocketIo","updateSocketInfo","LayoutV2","SocialVideoTabs","BroadcasterList","getStreamUrl","LiveBoxPreview1","withRouter","Link","isIOS","isMobile","BroadCasterListScroll","plugins","push","banner","ads","TOP_LIVE_LIMIT","RECORDED_LIVE_LIMIT","pc_config","iceServers","urls","username","credential","LiveIndex","props","isLoggedIn","isEmpty","user","info","activeSocket","uri","query","authenticated","firstName","lastName","customerDbId","_id","customerAvatar","get","newSocketConfig","window","addEventListener","componentCleanup","socket","on","broadcasters","broadcastersArr","Object","entries","map","broadcaster","name","dealerName","avatar","dealerAvatar","dealerSocketId","dealerVideoThumbnailUrl","setState","filteredBroadcasters","self","peerConnections","state","newIds","compact","cloneDeep","peerConnectionToAddIds","id","some","peerConnection","peerConnectionToRemoveIds","forEach","pc","createOffer","closeThePeerConnection","error","console","log","messageType","payload","emit","senderId","previousDealerSocketId","close","data","sdp","setRemoteDescription","RTCSessionDescription","candidate","addIceCandidate","RTCIceCandidate","stream","videoRef","current","srcObject","RTCPeerConnection","createRef","ontrack","event","setBroadcasterStream","streams","offerToReceiveVideo","offerToReceiveAudio","then","setLocalDescription","sendToPeer","x","skip","parseInt","isLoading","service","find","$limit","$sort","createdAt","$skip","$populate","res","recordedLives","concat","recordedLiveTotal","total","err","connectedUsers","searchWord","popularLives","recordedLivePage","bind","prevProps","prevState","filter","item","regex","RegExp","test","setTimeout","location","router","asPath","removeEventListener","setBroadcasterAnswer","setBroadcasterIceCandidate","isEqual","temp","padding","isArray","_renderTopLives","width","height","Component","mapStateToProps","app","mapDispatchToProps"],"mappings":"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","sourcesContent":["import { Button, Col, Empty, message, Row } from 'antd';\nimport _ from 'lodash';\nimport TweenOne from 'rc-tween-one';\nimport BezierPlugin from 'rc-tween-one/lib/plugin/BezierPlugin';\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport io from 'socket.io-client';\nimport { v4 } from 'uuid';\nimport { isValidNumber, notEmptyLength, objectRemoveEmptyValue } from '../../common-function';\nimport client from '../../feathers';\nimport { updateActiveMenu } from '../../redux/actions/app-actions';\nimport { clearClientSocketIo, fetchClientSocketIo } from '../../redux/actions/live-action';\nimport { updateSocketInfo } from '../../redux/actions/socketRefresh-actions';\nimport LayoutV2 from '../general/LayoutV2';\nimport SocialVideoTabs from '../news/social-video-tabs';\nimport BroadcasterList from './broadcaster-list';\nimport { getStreamUrl } from './config';\nimport LiveBoxPreview1 from './live-box-preview-1';\nimport { withRouter } from 'next/router';\nimport Link from 'next/link';\nimport { isIOS, isMobile } from 'react-device-detect'\nimport BroadCasterListScroll from './BroadCasterListScroll';\n\nTweenOne.plugins.push(BezierPlugin);\n\n\nconst banner = 'hands-on-wheel.jpg'\nconst ads = '20-Car-Dealership-Promotion-Ideas.jpg'\nconst TOP_LIVE_LIMIT = 2;\nconst RECORDED_LIVE_LIMIT = 6;\nconst pc_config = {\n  iceServers: [{\n    urls: [\"stun:ss-turn2.xirsys.com\"]\n  }, {\n    username: \"K7RYJQ0iO86IzU-paa6guXxfLJ7vXWhFwfWzE3X88-LOsT0QN4vquwAUx1vsJJmqAAAAAF-yezBjY2FyMzEzMQ==\",\n    credential: \"a5e31b16-280d-11eb-89e3-0242ac140004\",\n    urls: [\n      \"turn:ss-turn2.xirsys.com:80?transport=udp\",\n      \"turn:ss-turn2.xirsys.com:3478?transport=udp\",\n      \"turn:ss-turn2.xirsys.com:80?transport=tcp\",\n      \"turn:ss-turn2.xirsys.com:3478?transport=tcp\",\n      \"turns:ss-turn2.xirsys.com:443?transport=tcp\",\n      \"turns:ss-turn2.xirsys.com:5349?transport=tcp\"\n    ]\n  }]\n}\n\n\n\nclass LiveIndex extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      peerConnections: {},\n      videoRef: {},\n      broadcasters: [],\n      filteredBroadcasters: [],\n      connectedUsers: 0,\n      searchWord: '',\n      popularLives: [],\n      recordedLives: [],\n      recordedLivePage: 1,\n      recordedLiveTotal: 0,\n      isLoading: false,\n    }\n\n    this.componentCleanup = this.componentCleanup.bind(this);\n  }\n\n  componentDidMount = () => {\n    this.props.updateSocketInfo(false);\n    // this.getRecordedLives();\n    const isLoggedIn = _.isEmpty(this.props.user.info.user);\n\n    // \"https://upload.wikimedia.org/wikipedia/commons/f/f8/Odin%2C_der_G%C3%B6ttervater.jpg\"\n    this.activeSocket = io(\n      // client.io.io.uri,\n      getStreamUrl(client.io.io.uri),\n      {\n        query: {\n          // 'customerName': this.props.displayName,\n          // customerDbId: this.props.userId,\n          // customerAvatar: this.props.userAvatar\n          'customerName': this.props.user.authenticated ? `${this.props.user.info.user.firstName} ${this.props.user.info.user.lastName}` : 'Ccar User',\n          customerDbId: this.props.user.authenticated ? this.props.user.info.user._id : v4(),\n          customerAvatar: this.props.user.authenticated ? _.get(this.props.user, ['info', 'user', 'avatar']) || \"https://is4-ssl.mzstatic.com/image/thumb/Purple124/v4/fe/6f/1a/fe6f1a3a-9d14-cfdf-499c-222b7b842fb2/source/512x512bb.jpg\" : \"https://is4-ssl.mzstatic.com/image/thumb/Purple124/v4/fe/6f/1a/fe6f1a3a-9d14-cfdf-499c-222b7b842fb2/source/512x512bb.jpg\"\n        }\n      }\n    );\n    this.newSocketConfig(this.activeSocket);\n    //this o\n    // this.socketConfig();\n    window.addEventListener('beforeunload', this.componentCleanup);\n  }\n\n  UNSAFE_componentWillMount() {\n    this.props.updateActiveMenu('4');\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n\n\n    // if (!_.isEqual(prevState.broadcasters, this.state.broadcasters)) {\n\n    //   // this.socketConfig();\n    //   if (!!this.timeoutFunction) {\n    //     clearTimeout(this.timeoutFunction);\n    //   }\n    //   this.timeoutFunction = setTimeout(() => {\n    //     // this.syncPeerConnections();\n    //   }, 1000);\n\n    // }\n\n\n    // if (!_.isEqual(prevState.peerConnections, this.state.peerConnections)) {\n    //   console.log('peerConnections');\n    //   console.log(this.state.peerConnections);\n    // }\n\n    // if (prevState.recordedLivePage != this.state.recordedLivePage) {\n    //   this.getRecordedLives((this.state.recordedLivePage - 1) * RECORDED_LIVE_LIMIT)\n    // }\n\n    if (prevState.searchWord != this.state.searchWord) {\n      // let data = _.cloneDeep(this.state.broadcasters);\n      //no need to clone deep cuz filter returns a new obj\n      let data = this.state.broadcasters;\n      let self = this;\n      if (this.state.searchWord != null) {\n        data = _.filter(data, function (item) {\n          let regex = new RegExp(`^${self.state.searchWord}`, 'i');\n          return regex.test(item.name);\n        })\n      }\n\n      this.setState({\n        filteredBroadcasters: data,\n      })\n    }\n\n  }\n\n  componentWillUnmount() {\n\n    if (isIOS && isMobile) {\n      setTimeout(function () { window.location = `https://apps.apple.com/my/app/ccar-my/id1526288072`; }, 25);\n      window.location = \"ccarmy:/\" + this.props.router.asPath    }\n\n    this.componentCleanup();\n    window.removeEventListener('beforeunload', this.componentCleanup); // remove the event handler for normal unmounting\n  }\n\n\n  componentCleanup() {\n    // this will hold the cleanup code\n    // whatever you want to do when the component is unmounted or page refreshes\n\n    let self = this;\n    // if (_.isPlainObject(this.state.peerConnections) && notEmptyLength(this.state.peerConnections)) {\n    //   let peerConnections = Object.entries(this.state.peerConnections)\n    //   _.forEach(peerConnections, function (pc) {\n    //     self.closeThePeerConnection(pc[0]);\n    //   })\n    //   if (!!this.activeSocket) {\n    //     this.activeSocket.close();\n    //   }\n    // }\n    self.activeSocket && self.activeSocket.close();\n\n  }\n\n  newSocketConfig = (socket) => {\n    socket.on(\"pushAllBroadcaster\", (broadcasters) => {\n\n      let broadcastersArr = Object.entries(broadcasters);\n\n\n      if (notEmptyLength(broadcastersArr)) {\n        //Restruct data\n        broadcastersArr = _.map(broadcastersArr, function (broadcaster) {\n          broadcaster[1].name = broadcaster[1].dealerName;\n          broadcaster[1].avatar = broadcaster[1].dealerAvatar;\n          broadcaster[1].dealerSocketId = broadcaster[0];\n          broadcaster[1].dealerVideoThumbnailUrl = `${getStreamUrl(client.io.io.uri)}/dealerVideoThumbnails/${broadcaster[0]}.png`\n          return broadcaster[1];\n        })\n      } else {\n        broadcastersArr = [];\n      }\n\n      this.setState(() => {\n        return {\n          broadcasters: broadcastersArr,\n          // broadcasters: _.slice(broadcastersArr, 0, TOP_LIVE_LIMIT),\n          filteredBroadcasters: broadcastersArr,\n          // activeBroadcasterId: broadcastersArr[0][0],\n        }\n      })\n\n    })\n  }\n\n\n  socketConfig() {\n\n    this.activeSocket.removeEventListener('sendAnswerToClient')\n    this.activeSocket.on('sendAnswerToClient', (data) => {\n      this.setBroadcasterAnswer(data);\n    })\n\n\n    this.activeSocket.removeEventListener('sendCandidateToClient')\n    this.activeSocket.on('sendCandidateToClient', (data) => {\n      this.setBroadcasterIceCandidate(data);\n    })\n\n\n    this.activeSocket.removeEventListener('pushAllBroadcaster')\n    this.activeSocket.on(\"pushAllBroadcaster\", (broadcasters) => {\n\n      let broadcastersArr = Object.entries(broadcasters);\n\n\n      if (notEmptyLength(broadcastersArr)) {\n        //Restruct data\n        broadcastersArr = _.map(broadcastersArr, function (broadcaster) {\n          broadcaster[1].name = broadcaster[1].dealerName;\n          broadcaster[1].avatar = broadcaster[1].dealerAvatar;\n          broadcaster[1].dealerSocketId = broadcaster[0];\n          broadcaster[1].dealerVideoThumbnailUrl = `${getStreamUrl(client.io.io.uri)}/dealerVideoThumbnails/${broadcaster[0]}.png`\n          return broadcaster[1];\n        })\n      } else {\n        broadcastersArr = [];\n      }\n\n      if (!_.isEqual(this.state.broadcasters, broadcastersArr)) {\n        this.setState(() => {\n          return {\n            // broadcasters: _.slice(broadcastersArr, 0, TOP_LIVE_LIMIT),\n            broadcasters: broadcastersArr,\n            filteredBroadcasters: broadcastersArr,\n            // activeBroadcasterId: broadcastersArr[0][0],\n          }\n        })\n      }\n    })\n\n\n    this.activeSocket.removeEventListener('newMessage')\n    this.activeSocket.on(\"newMessage\", (data) => {\n\n      if (notEmptyLength(objectRemoveEmptyValue(data))) {\n        let temp = _.map(this.state.broadcasters, function (broadcaster) {\n          if (broadcaster.dealerSocketId == data.dealerSocketId) {\n            broadcaster.connectedUsers = data.connectedUsers;\n          }\n          return broadcaster;\n        })\n        this.setState({\n          broadcasters: temp,\n        })\n      }\n    })\n\n\n    this.activeSocket.removeEventListener('getAllMessages')\n    this.activeSocket.on(\"getAllMessages\", (data) => {\n      let temp = _.map(this.state.broadcasters, function (broadcaster) {\n        if (broadcaster.dealerSocketId == data.dealerSocketId) {\n          broadcaster = { ...broadcaster, ...data };\n        }\n        return broadcaster;\n      })\n      this.setState({\n        broadcasters: temp,\n      })\n    })\n\n\n    this.activeSocket.removeEventListener('getSpecialLives')\n    // this.activeSocket.on(\"getSpecialLives\", (data) => {\n    //     if (data) {\n    //         this.setState({\n    //             popularLives: _.isArray(data.popularLives) && notEmptyLength(data.popularLives) ? data.popularLives : [],\n    //         })\n    //     }\n    // });\n\n\n  }\n\n  syncPeerConnections = () => {\n    let self = this;\n    try {\n\n      let peerConnections = Object.entries(this.state.peerConnections);\n      //Broadcasters\n      let newIds = _.compact(_.map(_.cloneDeep(this.state.broadcasters), function (broadcaster) {\n        return broadcaster.dealerSocketId;\n      }));\n\n\n      // if (notEmptyLength(this.state.popularLives)) {\n      //     let popularLiveIds = _.compact(_.map(_.cloneDeep(this.state.popularLives), function (popularLive) {\n      //         if (popularLive.liveType == 'current') {\n      //             return popularLive.dealerSocketId;\n      //         } else {\n      //             return null;\n      //         }\n      //     }));\n\n      //     newIds = _.union(newIds, popularLiveIds);\n      // }\n\n\n      let peerConnectionToAddIds = _.compact(_.map(newIds, function (id) {\n        return !_.some(peerConnections, function (peerConnection) {\n          return peerConnection[0] == id;\n        }) ? id : null\n      }))\n\n      let peerConnectionToRemoveIds = _.compact(_.map(peerConnections, function (peerConnection) {\n        return !_.some(newIds, function (id) {\n          return peerConnection[0] == id;\n        }) ? peerConnection[0] : null\n      }))\n\n      _.forEach(peerConnectionToAddIds, function (id) {\n\n        if (!self.state.peerConnections[id] || !self.state.peerConnections[id].pc) {\n          self.createOffer(id);\n        }\n      })\n\n      _.forEach(peerConnectionToRemoveIds, function (id) {\n        if (self.state.peerConnections[id] || self.state.peerConnections[id].pc) {\n          self.closeThePeerConnection(id);\n        }\n      })\n\n\n      //Find removed peerConnections\n\n    } catch (error) {\n      console.log(error);\n    }\n  }\n\n  //cleared\n  sendToPeer = (messageType, payload) => {\n    this.activeSocket.emit(messageType, {\n      senderId: this.activeSocket.id,\n      payload\n    })\n  }\n\n  //cleared\n  closeThePeerConnection = (previousDealerSocketId) => {\n\n\n    let peerConnections = _.cloneDeep(this.state.peerConnections);\n    if (!!peerConnections[previousDealerSocketId]) {\n      if (!!peerConnections[previousDealerSocketId].pc) {\n        peerConnections[previousDealerSocketId].pc.close();\n        this.activeSocket.emit('closeClientSocket', previousDealerSocketId);\n        delete peerConnections[previousDealerSocketId];\n        this.setState({\n          peerConnections: peerConnections\n        })\n      }\n    }\n  }\n  //cleared\n  setBroadcasterAnswer = (data) => {\n    if (!data || !data.sdp || !data.dealerSocketId) {\n      return null;\n    } else {\n      let peerConnections = this.state.peerConnections;\n      if (!!peerConnections[data.dealerSocketId]) {\n        if (!!peerConnections[data.dealerSocketId].pc) {\n          peerConnections[data.dealerSocketId].pc.setRemoteDescription(new RTCSessionDescription(data.sdp));\n        }\n      }\n\n      this.setState({\n        peerConnections: peerConnections,\n      })\n\n    }\n  }\n  //cleared\n  setBroadcasterIceCandidate = (data) => {\n    if (!data || !data.candidate || !data.dealerSocketId) {\n      return null;\n    } else {\n      let peerConnections = this.state.peerConnections;\n      if (!!peerConnections[data.dealerSocketId]) {\n        if (!!peerConnections[data.dealerSocketId].pc) {\n          peerConnections[data.dealerSocketId].pc.addIceCandidate(new RTCIceCandidate(data.candidate))\n        }\n      }\n\n      this.setState({\n        peerConnections: peerConnections,\n      })\n\n    }\n  }\n\n  //cleared\n  setBroadcasterStream = (dealerSocketId, stream) => {\n    try {\n      let peerConnections = this.state.peerConnections;\n      let self = this;\n      if (!!peerConnections[dealerSocketId] && _.get(peerConnections, [dealerSocketId, 'videoRef', 'current']) && stream) {\n        peerConnections[dealerSocketId].videoRef.current.srcObject = stream;\n        peerConnections[dealerSocketId].stream = stream;\n        this.setState({\n          peerConnections: peerConnections,\n        })\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  }\n\n  //cleared\n  createOffer = (dealerSocketId) => {\n    if (!!dealerSocketId) {\n\n      let self = this;\n\n      let peerConnections = this.state.peerConnections;\n      peerConnections[dealerSocketId] = {\n        pc: new RTCPeerConnection(pc_config),\n        videoRef: React.createRef(),\n        stream: null,\n      }\n\n      peerConnections[dealerSocketId].pc.ontrack = event => {\n        self.setBroadcasterStream(dealerSocketId, event.streams[0]);\n      };\n\n      peerConnections[dealerSocketId].pc.createOffer({\n        offerToReceiveVideo: 1,\n        //for audio\n        offerToReceiveAudio: 1\n      })\n        .then(sdp => {\n          peerConnections[dealerSocketId].pc.setLocalDescription(sdp);\n\n          self.setState({\n            peerConnections: peerConnections,\n          }, () => {\n            self.sendToPeer('clientRequestVideoWithDealerSocketId', { sdp, dealerSocketId: dealerSocketId })\n          })\n\n        }).catch(x => {\n\n          console.log('offer failed');\n        });\n\n    }\n  }\n\n  //cleared\n  getRecordedLives = (skip) => {\n    if (!isValidNumber(skip)) {\n      skip = 0;\n    } else {\n      skip = parseInt(skip);\n    }\n    this.setState({\n      isLoading: true,\n    })\n    client.service('live-stream-messages').find({\n      query: {\n        $limit: RECORDED_LIVE_LIMIT,\n        $sort: {\n          createdAt: -1,\n        },\n        $skip: skip,\n        $populate: 'dealerDbId'\n      }\n    }).then(res => {\n      this.setState({\n        isLoading: false,\n      })\n      if (notEmptyLength(res.data)) {\n        this.setState({\n          recordedLives: this.state.recordedLives.concat(res.data),\n          recordedLiveTotal: res.total,\n        })\n      } else {\n        this.setState({\n          recordedLives: this.state.recordedLives.concat([]),\n          recordedLiveTotal: res.total,\n        })\n      }\n    }).catch(err => {\n      this.setState({\n        isLoading: false,\n      })\n      message.error(err.message)\n    });\n  }\n\n\n  _renderTopLives = () => {\n    let self = this;\n\n    if (notEmptyLength(this.state.broadcasters)) {\n      return (\n        this.state.broadcasters.map(function (broadcaster) {\n          return (\n            <React.Fragment>\n              <Col xs={24} sm={24} md={12} lg={8} xl={8} >\n                <Link shallow={false} href={`/live/${broadcaster.dealerSocketId}`} >\n                  <a>\n                    <LiveBoxPreview1\n                      data={broadcaster}\n                      key={`live-box-${broadcaster.dealerSocketId}`}\n                      className='cursor-pointer'\n                      videoRef={_.get(self, ['state', 'peerConnections', _.get(broadcaster, ['dealerSocketId']), 'videoRef'])}\n\n                      dealerSocketId={broadcaster.dealerSocketId}\n                      sharedSocket={self.activeSocket}\n                    />\n                  </a>\n                </Link>\n              </Col>\n            </React.Fragment>\n          )\n        })\n      )\n    } else {\n      return <Col xs={24} sm={24} md={24} lg={24} xl={24} className='background-white'>\n        <Empty />\n      </Col>\n    }\n  }\n\n  //@implementation new socket code\n\n\n  //@end new socket code\n  render() {\n    let self = this;\n    return (\n      <React.Fragment>\n        <LayoutV2>\n          <div className='section-version3'>\n            <div className='padding-x-sm padding-y-lg'>\n              <Row gutter={[10, 30]} type=\"flex\" align=\"stretch\">\n                <Col style={{padding:'0px'}} xs={24} sm={24} md={24} lg={24} xl={24} >\n                  <div className=\"font-weight-bold padding-sm\">\n                    Live Streamer\n                  </div>\n                </Col>\n\n                <Col style={{padding:'0px'}} span={4}>\n                <div className=\"width-100 background-white\">\n                    <div className=\"width-100 \">\n                      <BroadCasterListScroll\n                        showName={false}\n                        activeBroadcasters={notEmptyLength(this.state.filteredBroadcasters) ? this.state.filteredBroadcasters : []}\n                        // allowSearch\n                      />\n                    </div>\n                  </div>\n                </Col>\n\n                {/* {\n                  _.isArray(this.state.broadcasters) && !_.isEmpty(this.state.broadcasters) ?\n                    <Col xs={24} sm={24} md={24} lg={24} xl={24}>\n                      <div className=\"h6 font-weight-bold\">TOP LIVE</div>\n                    </Col>\n                    :\n                    null\n                } */}\n\n                <Col xs={20} sm={20} md={20} lg={20} xl={20}>\n                  <Row gutter={[10,10]}>\n                    {\n                      _.isArray(this.state.broadcasters) && !_.isEmpty(this.state.broadcasters) ?\n                        this._renderTopLives()\n                        :\n                        <div className=\"flex-justify-center flex-items-align-center\">\n                          <img style={{width:'50%', height:'50%'}} src=\"/assets/live-stream.png\"/>\n                        </div>\n                    }\n                  </Row>\n                </Col>\n\n                {/* <Col xs={24} sm={24} md={24} lg={24} xl={24}>\n                  <Row>\n                    <Col className=\"gutter-row\" span={24} className=\"margin-bottom-sm margin-top-sm \">\n                      <span className='d-inline-block h6 font-weight-bold grey-darken-3' style={{ marginLeft: '10px' }} >Social Videos</span>\n                    </Col>\n                    <Col xs={24} sm={24} md={24} lg={24} xl={24} style={{ overflowX: 'auto' }} >\n                      <SocialVideoTabs />\n                    </Col>\n                    <Col xs={24} sm={24} md={24} lg={24} xl={24} className=\"margin-top-md margin-bottom-md text-align-center\">\n                      <a href=\"/socialNewsAndVideo?type=videos\"><Button type=\"primary\"> Show More </Button></a>\n                    </Col>\n                  </Row>\n                </Col> */}\n\n              </Row>\n            </div>\n          </div>\n\n        </LayoutV2>\n      </React.Fragment >\n    )\n  }\n\n}\n\nconst mapStateToProps = state => ({\n  app: state.app,\n  user: state.user,\n});\n\nconst mapDispatchToProps = {\n  updateSocketInfo,\n  updateActiveMenu: updateActiveMenu,\n  fetchClientSocketIo: fetchClientSocketIo,\n  clearClientSocketIo: clearClientSocketIo,\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(withRouter(LiveIndex));\n"]},"metadata":{},"sourceType":"module"}