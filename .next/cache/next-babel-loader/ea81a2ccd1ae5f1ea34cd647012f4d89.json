{"ast":null,"code":"var __jsx = React.createElement;\nimport { Button, Card, Col, Empty, Form, message, Row, Select, Tabs } from 'antd';\nimport axios from 'axios';\nimport _ from 'lodash';\nimport moment from 'moment';\nimport { withRouter } from 'next/router';\nimport React, { useEffect, useState } from 'react';\nimport { connect } from 'react-redux';\nimport { notEmptyLength } from '../../common-function';\nimport client from '../../feathers';\nimport { loading } from '../../redux/actions/app-actions';\nimport { fetchFeaturesList, updateCheckedFeaturesDate } from '../../redux/actions/productsList-actions';\nimport CarspecsCompareTable from '../compare/CarspecsCompareTable';\nimport { isIOS, isMobile } from 'react-device-detect';\nimport OverallRating from '../rating/OverallRating';\nimport RatingProgress from '../rating/RatingProgress';\nimport WriteReviewButton from '../rating/WriteReviewButton';\nimport ReviewList2 from '../rating/ReviewList2';\nconst {\n  TabPane\n} = Tabs;\nconst {\n  Option\n} = Select;\nconst reviewContainerRef = React.createRef();\nconst RATINGPAGESIZE = 4;\nconst columns = [{\n  title: 'Category',\n  dataIndex: 'category',\n  key: 'category',\n  render: (text, row) => {\n    if (row.field == 'skip') {\n      return {\n        children: __jsx(\"span\", null, __jsx(\"strong\", null, text)),\n        props: {\n          colSpan: 3\n        }\n      };\n    } else {\n      return {\n        children: __jsx(\"span\", null, text)\n      };\n    }\n  }\n}, {\n  title: 'Field',\n  dataIndex: 'field',\n  key: 'field',\n  render: (text, row) => {\n    if (text == 'skip') {\n      return {\n        props: {\n          colSpan: 0\n        }\n      };\n    } else {\n      return {\n        children: __jsx(\"span\", null, text)\n      };\n    }\n  }\n}, {\n  title: 'Value',\n  dataIndex: 'value',\n  key: 'value',\n  render: (text, row) => {\n    if (text == 'skip') {\n      return {\n        props: {\n          colSpan: 0\n        }\n      };\n    } else {\n      return {\n        children: __jsx(\"span\", null, text)\n      };\n    }\n  }\n}];\n\nconst Description = props => {\n  const {\n    0: id,\n    1: setId\n  } = useState('');\n  const {\n    0: companyId,\n    1: setCompanyId\n  } = useState(null);\n  const {\n    0: productDetails,\n    1: setProductDetails\n  } = useState({});\n  const {\n    0: carSpecs,\n    1: setCarSpecs\n  } = useState([]);\n  const {\n    0: expandedRow,\n    1: setExpandedRow\n  } = useState([]);\n  const {\n    0: ratings,\n    1: setRatings\n  } = useState([]);\n  const {\n    0: ratingPage,\n    1: setRatingPage\n  } = useState(1);\n  const {\n    0: ratingTotal,\n    1: setRatingTotal\n  } = useState(0);\n  const {\n    0: ownRating,\n    1: setOwnRating\n  } = useState([]);\n  const {\n    0: displayContact,\n    1: setDisplayContact\n  } = useState(false);\n  const {\n    0: carspecIds,\n    1: setCarspecIds\n  } = useState([]);\n  const {\n    0: count,\n    1: setCount\n  } = useState(0);\n  useEffect(() => {\n    if (props.productDetails._id != id) {\n      setId(props.productDetails._id);\n      setProductDetails(props.productDetails);\n      setCompanyId(props.productDetails.companys._id);\n\n      let uniqSpec = _.uniqBy(props.productDetails.carspecsAll.specification, 'category');\n\n      let cloneUniqSpec = _.cloneDeep(uniqSpec);\n\n      uniqSpec.map((v, i) => {\n        cloneUniqSpec[i].key = i;\n        cloneUniqSpec[i].children = [];\n        cloneUniqSpec[i].field = 'skip';\n        cloneUniqSpec[i].value = 'skip';\n        props.productDetails.carspecsAll.specification.map((v1, i1) => {\n          if (v1.category == v.category) {\n            cloneUniqSpec[i].children.push({\n              key: i + '' + i1,\n              field: v1.field,\n              value: v1.value\n            });\n          }\n        });\n      });\n      setCarSpecs(cloneUniqSpec);\n    }\n  });\n  useEffect(() => {\n    if (!props.productsList.checkedFeaturesDate || moment(props.productsList.checkedFeaturesDate).isBefore(moment(), 'day')) {\n      props.loading(true);\n      axios.get(`${client.io.io.uri}getFeatureList`).then(res => {\n        props.loading(false);\n        props.fetchFeaturesList(res.data.data);\n        props.updateCheckedFeaturesDate(moment());\n      }).catch(err => {\n        props.loading(false);\n        message.error(err.message);\n      });\n    }\n  }, []);\n  useEffect(() => {\n    getRatings((ratingPage - 1) * RATINGPAGESIZE);\n  }, [ratingPage]);\n  useEffect(() => {\n    init();\n    setCarspecIds(_.compact([_.get(productDetails, 'carspecsAll._id')]));\n  }, [productDetails, props.user]); // useEffect(() => {\n  //     setCount(count + 1);\n  //     if (count < 10) {\n  //         console.log(props.user);\n  //         props.loading(!props.app.loading)\n  //     }\n  // }, [props.user])\n\n  function init() {\n    if (ratingPage == 1) {\n      getRatings(0);\n    } else {\n      setRatingPage(1);\n    }\n\n    setRatingTotal(0);\n    getOwnRating();\n  }\n\n  function getRatings(skip) {\n    if (_.get(productDetails, ['carspecsId', '_id'])) {\n      let query = {\n        carspecId: _.get(productDetails, ['carspecsId', '_id']),\n        type: 'carspec',\n        $populate: [{\n          path: 'carspecId',\n          ref: 'carspecs'\n        }, {\n          path: 'reviewerId',\n          ref: 'users'\n        }],\n        $limit: RATINGPAGESIZE,\n        $skip: skip\n      };\n\n      if (props.user.authenticated) {\n        query.reviewerId = {\n          $ne: props.user.info.user._id\n        };\n        query[\"hideBy.userId\"] = {\n          $ne: props.user.info.user._id\n        };\n      }\n\n      props.loading(true);\n      client.service('rating').find({\n        query\n      }).then(res => {\n        props.loading(false);\n\n        if (notEmptyLength(res.data)) {\n          let data = ratings.concat(res.data);\n          setRatingTotal(res.total);\n          setRatings(data);\n        }\n      }).catch(err => {\n        props.loading(false);\n        message.error(err.message);\n      });\n    } else {\n      setRatings([]);\n    }\n  }\n\n  function getOwnRating() {\n    if (_.get(productDetails, ['carspecsId', '_id']) && props.user.authenticated) {\n      props.loading(true);\n      client.service('rating').find({\n        query: {\n          type: 'carspec',\n          carspecId: _.get(productDetails, ['carspecsId', '_id']),\n          reviewerId: props.user.info.user._id,\n          $populate: [{\n            path: 'carspecId',\n            ref: 'carspecs'\n          }, {\n            path: 'reviewerId',\n            ref: 'users'\n          }],\n          $limit: 1\n        }\n      }).then(res => {\n        props.loading(false);\n\n        if (notEmptyLength(res.data)) {\n          setOwnRating(res.data);\n        } else {\n          setOwnRating([]);\n        }\n      }).catch(err => {\n        props.loading(false);\n        message.error(err.message);\n      });\n    } else {\n      setOwnRating([]);\n    }\n  }\n\n  const callback = key => {}; // function getFeatureText(data) {\n  //     switch (data) {\n  //         case \"abs\":\n  //             return 'ABS';\n  //         case \"adjustablesteeringwheel\":\n  //             return 'Adjustable Steering Wheel';\n  //         case \"airbags\":\n  //             return \"Air bags\"\n  //         case \"alarm\":\n  //             return \"Alarm\"\n  //         case \"blindspotmonitor\":\n  //             return \"Blind spot monitor\"\n  //         case \"bodykits\":\n  //             return \"Body Kits\"\n  //         case \"brakeassist\":\n  //             return \"Brake Assist\"\n  //         case \"bucketseat\":\n  //             return \"Bucket Seat\"\n  //         case \"cdplayer\":\n  //             return \"Cd Player\"\n  //         case \"centrallocks\":\n  //             return \"Central Locks\"\n  //         case \"centraltouchscreen\":\n  //             return \"Central touchscreen\"\n  //         case \"childsafetylock\":\n  //             return \"Child safety lock\"\n  //         case \"cruisecontrol\":\n  //             return \"Cruise Control\"\n  //         case \"daytimerunninglights\":\n  //             return \"Daytime running lights\"\n  //         case \"driveradjustablelumbar\":\n  //             return \"Driver adjustable lumbar\"\n  //         case \"drivervanityminor\":\n  //             return \"Driver Vanity minor\"\n  //         case \"electricseat\":\n  //             return \"Electric Seat\"\n  //         case \"foglamps\":\n  //             return \"Fog Lamps\"\n  //         case \"frontwheeldrive\":\n  //             return \"Front Wheel Drive\"\n  //         case \"gpsnavigation\":\n  //             return \"GPS Navigation\"\n  //         case \"heatedfrontseat\":\n  //             return \"Heated Front Seat\"\n  //         case \"keylessstart\":\n  //             return \"Keyless Start\"\n  //         case \"lanedeparturewarning\":\n  //             return \"Lane departure warning\"\n  //         case \"leatherseats\":\n  //             return \"Leather Seats\"\n  //         case \"manufacturerwarranty\":\n  //             return \"Manufacturer Warranty\"\n  //         case \"mp3players\":\n  //             return \"MP3 Players\"\n  //         case \"multifunctionsteering\":\n  //             return \"Multi Function Steering\"\n  //         case \"paddleshift\":\n  //             return \"Paddle Shift\"\n  //         case \"parkingsensor\":\n  //             return \"Parking Sensor\"\n  //         case \"passangerilluminatedvisormirror\":\n  //             return \"Passanger Illuminated visor mirror\"\n  //         case \"powersteering\":\n  //             return \"Power Steering\"\n  //         case \"powerwindow\":\n  //             return \"Power Window\"\n  //         case \"reardefrost\":\n  //             return \"Rear Defrost\"\n  //         case \"reservecamera\":\n  //             return \"Reserve Camera\"\n  //         case \"sportrims\":\n  //             return \"Sport rims\"\n  //         case \"stabilitycontrol\":\n  //             return \"Stability Control\"\n  //         case \"steeringwheelaudio\":\n  //             return \"Steering Wheel Audio\"\n  //         case \"sunroof/moonroof\":\n  //             return \"Sunroof / Moonroof\"\n  //         case \"telematics\":\n  //             return \"Telematics\"\n  //         case \"tripcomputer\":\n  //             return \"Trip Computer\"\n  //         case \"usb\":\n  //             return \"USB\"\n  //         case \"wheellock\":\n  //             return \"Wheel lock\"\n  //         case \"windowtint\":\n  //             return \"Window Tint\"\n  //         case \"wipes\":\n  //             return \"Wipes\"\n  //         default:\n  //             return null;\n  //     }\n  // }\n\n\n  function expandAllRow() {\n    if (notEmptyLength(carSpecs)) {\n      let keys = _.map(carSpecs, 'key');\n\n      if (notEmptyLength(keys)) {\n        setExpandedRow(keys);\n      }\n    } else {\n      setExpandedRow([]);\n    }\n  }\n\n  function shrinkAllRow() {\n    setExpandedRow([]);\n  }\n\n  const _renderFeatures = data => {\n    if (notEmptyLength(props.productsList.featuresList) && notEmptyLength(data)) {\n      let temp = _.filter(props.productsList.featuresList, function (item) {\n        return _.includes(data, item.value);\n      });\n\n      if (notEmptyLength(temp)) {\n        let list = temp.map(function (item) {\n          return __jsx(Col, {\n            span: 8\n          }, __jsx(\"div\", {\n            className: \"flex-justify-start flex-items-align-center padding-x-sm fill-parent \"\n          }, __jsx(\"span\", {\n            className: \"margin-x-sm relative-wrapper\",\n            style: {\n              height: \"30px\",\n              width: '30px'\n            }\n          }, __jsx(\"img\", {\n            src: item.icon ? item.icon : null,\n            className: \"fill-parent absolute-center\"\n          })), __jsx(\"span\", {\n            className: \"padding-sm headline flex-justify-center flex-items-align-center text-truncate-threeline\"\n          }, item.text ? item.text : null)));\n        });\n        return __jsx(\"div\", {\n          style: {\n            minHeight: 500\n          }\n        }, __jsx(Row, {\n          type: \"flex\",\n          align: \"middle\",\n          gutter: [10, 10]\n        }, list));\n      } else {\n        return __jsx(Empty, {\n          style: {\n            position: 'relative',\n            top: '50%',\n            transform: 'translateY(-50%)'\n          },\n          image: \"/empty.png\",\n          imageStyle: {\n            height: 60\n          },\n          description: __jsx(\"span\", null, \"No Result\")\n        });\n      }\n    } else {\n      return __jsx(Empty, {\n        style: {\n          position: 'relative',\n          top: '50%',\n          transform: 'translateY(-50%)'\n        },\n        image: \"/empty.png\",\n        imageStyle: {\n          height: 60\n        },\n        description: __jsx(\"span\", null, \"No Result\")\n      });\n    }\n  };\n\n  const _renderExpandButton = () => {\n    return __jsx(React.Fragment, null, __jsx(Button, {\n      icon: \"arrows-alt\",\n      onClick: expandAllRow,\n      className: \"background-ccar-yellow margin-x-sm\"\n    }, \"Expand All\"), __jsx(Button, {\n      icon: \"shrink\",\n      onClick: shrinkAllRow,\n      className: \"margin-x-sm\"\n    }, \"Shrink All\"));\n  };\n\n  function changeProductDetails(data, type) {\n    if (_.isEmpty(data) === true) {\n      return;\n    }\n\n    let dataString = _.cloneDeep(data);\n\n    let phoneFormat = /((601)|(01))[0-46-9]*[0-9]{7,10}/gim;\n    let phoneFormat2 = /([601]|[01]|)[0-46-9]-*[0-9]{7,10}/g;\n    dataString = dataString.split('\\n');\n    dataString = dataString.map(function (v) {\n      let v2 = v;\n      v = v.replace(/\\s/g, '');\n      v = v.replace(/\\+/g, '');\n      v = v.replace(/-/g, '');\n      let n = v.match(phoneFormat);\n      let s = v.split(phoneFormat2);\n      let x = '';\n\n      if (_.isEmpty(n) === true) {\n        return __jsx(\"p\", {\n          style: {\n            marginBottom: '0em'\n          }\n        }, v2);\n      }\n\n      s = _.without(s, '6');\n      s = _.without(s, '0');\n      s = _.without(s, '');\n      x = s.map(function (v, i) {\n        if (n[i]) {\n          if (type === 'callContact') {\n            if (n[i].charAt(0) !== '6') {\n              n[i] = '6' + n[i];\n            }\n\n            if (isMobile) {\n              v = __jsx(React.Fragment, null, __jsx(React.Fragment, null, v), \" \", __jsx(\"a\", {\n                className: \"contactShow\",\n                target: '_blank',\n                href: \"tel:\" + n[i]\n              }, n[i]));\n            } else {\n              let username = '';\n\n              try {\n                username = productDetails.createdBy.namePrefix + ' ' + productDetails.createdBy.fullName;\n              } catch (err) {\n                username = '';\n              }\n\n              v = __jsx(React.Fragment, null, __jsx(React.Fragment, null, v), \" \", __jsx(\"a\", {\n                className: \"contactShow\",\n                target: '_blank',\n                href: \"https://web.whatsapp.com/send?phone=\" + n[i].replace('+', '') + \"&text=Hi \" + username + \", I am interested in your car ad on ccar.my and I would like to know more about \" + productDetails.title + \" (RM \" + productDetails.price.toFixed(2) + \"). Thank you. https://share.ccar.my/viewCar/\" + productDetails._id\n              }, n[i]));\n            }\n          } else {\n            v = __jsx(React.Fragment, null, __jsx(React.Fragment, null, v), \" \", __jsx(\"span\", {\n              className: \"contactHide\",\n              onClick: () => {\n                setDisplayContact(true);\n              }\n            }, \"(Click to View Contact No.)\"));\n          }\n        }\n\n        return v;\n      });\n      return __jsx(\"p\", {\n        style: {\n          marginBottom: '0em'\n        }\n      }, x);\n    });\n    return dataString;\n  }\n\n  return __jsx(\"div\", null, __jsx(Card, {\n    size: \"small\"\n  }, __jsx(\"p\", {\n    style: {\n      whiteSpace: 'pre-wrap'\n    }\n  }, displayContact ? changeProductDetails(productDetails.description, 'callContact') : changeProductDetails(productDetails.description))));\n};\n\nconst mapStateToProps = state => ({\n  user: state.user,\n  app: state.app,\n  productsList: state.productsList\n});\n\nconst mapDispatchToProps = {\n  loading: loading,\n  fetchFeaturesList: fetchFeaturesList,\n  updateCheckedFeaturesDate: updateCheckedFeaturesDate\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(Form.create()(withRouter(Description)));","map":{"version":3,"sources":["/Users/faraheen/ccar-cms-next-mobile/components/product-list/Description.jsx"],"names":["Button","Card","Col","Empty","Form","message","Row","Select","Tabs","axios","_","moment","withRouter","React","useEffect","useState","connect","notEmptyLength","client","loading","fetchFeaturesList","updateCheckedFeaturesDate","CarspecsCompareTable","isIOS","isMobile","OverallRating","RatingProgress","WriteReviewButton","ReviewList2","TabPane","Option","reviewContainerRef","createRef","RATINGPAGESIZE","columns","title","dataIndex","key","render","text","row","field","children","props","colSpan","Description","id","setId","companyId","setCompanyId","productDetails","setProductDetails","carSpecs","setCarSpecs","expandedRow","setExpandedRow","ratings","setRatings","ratingPage","setRatingPage","ratingTotal","setRatingTotal","ownRating","setOwnRating","displayContact","setDisplayContact","carspecIds","setCarspecIds","count","setCount","_id","companys","uniqSpec","uniqBy","carspecsAll","specification","cloneUniqSpec","cloneDeep","map","v","i","value","v1","i1","category","push","productsList","checkedFeaturesDate","isBefore","get","io","uri","then","res","data","catch","err","error","getRatings","init","compact","user","getOwnRating","skip","query","carspecId","type","$populate","path","ref","$limit","$skip","authenticated","reviewerId","$ne","info","service","find","concat","total","callback","expandAllRow","keys","shrinkAllRow","_renderFeatures","featuresList","temp","filter","item","includes","list","height","width","icon","minHeight","position","top","transform","_renderExpandButton","changeProductDetails","isEmpty","dataString","phoneFormat","phoneFormat2","split","v2","replace","n","match","s","x","marginBottom","without","charAt","username","createdBy","namePrefix","fullName","price","toFixed","whiteSpace","description","mapStateToProps","state","app","mapDispatchToProps","create"],"mappings":";AAAA,SAASA,MAAT,EAAiBC,IAAjB,EAAuBC,GAAvB,EAA4BC,KAA5B,EAAmCC,IAAnC,EAAyCC,OAAzC,EAAkDC,GAAlD,EAAuDC,MAAvD,EAA+DC,IAA/D,QAA2E,MAA3E;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,CAAP,MAAc,QAAd;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,SAASC,UAAT,QAA2B,aAA3B;AACA,OAAOC,KAAP,IAAgBC,SAAhB,EAA2BC,QAA3B,QAA2C,OAA3C;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,SAASC,cAAT,QAA+B,uBAA/B;AACA,OAAOC,MAAP,MAAmB,gBAAnB;AACA,SAASC,OAAT,QAAwB,iCAAxB;AACA,SAASC,iBAAT,EAA4BC,yBAA5B,QAA6D,0CAA7D;AACA,OAAOC,oBAAP,MAAiC,iCAAjC;AACA,SAASC,KAAT,EAAgBC,QAAhB,QAAgC,qBAAhC;AACA,OAAOC,aAAP,MAA0B,yBAA1B;AACA,OAAOC,cAAP,MAA2B,0BAA3B;AACA,OAAOC,iBAAP,MAA8B,6BAA9B;AACA,OAAOC,WAAP,MAAwB,uBAAxB;AAGA,MAAM;AAAEC,EAAAA;AAAF,IAAcrB,IAApB;AACA,MAAM;AAAEsB,EAAAA;AAAF,IAAavB,MAAnB;AACA,MAAMwB,kBAAkB,GAAGlB,KAAK,CAACmB,SAAN,EAA3B;AAEA,MAAMC,cAAc,GAAG,CAAvB;AAIA,MAAMC,OAAO,GAAG,CACZ;AACIC,EAAAA,KAAK,EAAE,UADX;AAEIC,EAAAA,SAAS,EAAE,UAFf;AAGIC,EAAAA,GAAG,EAAE,UAHT;AAIIC,EAAAA,MAAM,EAAE,CAACC,IAAD,EAAOC,GAAP,KAAe;AACnB,QAAIA,GAAG,CAACC,KAAJ,IAAa,MAAjB,EAAyB;AACrB,aAAO;AACHC,QAAAA,QAAQ,EAAE,oBAAM,sBAASH,IAAT,CAAN,CADP;AAEHI,QAAAA,KAAK,EAAE;AACHC,UAAAA,OAAO,EAAE;AADN;AAFJ,OAAP;AAMH,KAPD,MAOO;AACH,aAAO;AACHF,QAAAA,QAAQ,EAAE,oBAAOH,IAAP;AADP,OAAP;AAGH;AACJ;AAjBL,CADY,EAoBZ;AACIJ,EAAAA,KAAK,EAAE,OADX;AAEIC,EAAAA,SAAS,EAAE,OAFf;AAGIC,EAAAA,GAAG,EAAE,OAHT;AAIIC,EAAAA,MAAM,EAAE,CAACC,IAAD,EAAOC,GAAP,KAAe;AACnB,QAAID,IAAI,IAAI,MAAZ,EAAoB;AAChB,aAAO;AACHI,QAAAA,KAAK,EAAE;AACHC,UAAAA,OAAO,EAAE;AADN;AADJ,OAAP;AAKH,KAND,MAMO;AACH,aAAO;AACHF,QAAAA,QAAQ,EAAE,oBAAOH,IAAP;AADP,OAAP;AAGH;AACJ;AAhBL,CApBY,EAsCZ;AACIJ,EAAAA,KAAK,EAAE,OADX;AAEIC,EAAAA,SAAS,EAAE,OAFf;AAGIC,EAAAA,GAAG,EAAE,OAHT;AAIIC,EAAAA,MAAM,EAAE,CAACC,IAAD,EAAOC,GAAP,KAAe;AACnB,QAAID,IAAI,IAAI,MAAZ,EAAoB;AAChB,aAAO;AACHI,QAAAA,KAAK,EAAE;AACHC,UAAAA,OAAO,EAAE;AADN;AADJ,OAAP;AAKH,KAND,MAMO;AACH,aAAO;AACHF,QAAAA,QAAQ,EAAE,oBAAOH,IAAP;AADP,OAAP;AAGH;AACJ;AAhBL,CAtCY,CAAhB;;AA0DA,MAAMM,WAAW,GAAIF,KAAD,IAAW;AAC3B,QAAM;AAAA,OAACG,EAAD;AAAA,OAAKC;AAAL,MAAchC,QAAQ,CAAC,EAAD,CAA5B;AACA,QAAM;AAAA,OAACiC,SAAD;AAAA,OAAYC;AAAZ,MAA4BlC,QAAQ,CAAC,IAAD,CAA1C;AACA,QAAM;AAAA,OAACmC,cAAD;AAAA,OAAiBC;AAAjB,MAAsCpC,QAAQ,CAAC,EAAD,CAApD;AACA,QAAM;AAAA,OAACqC,QAAD;AAAA,OAAWC;AAAX,MAA0BtC,QAAQ,CAAC,EAAD,CAAxC;AACA,QAAM;AAAA,OAACuC,WAAD;AAAA,OAAcC;AAAd,MAAgCxC,QAAQ,CAAC,EAAD,CAA9C;AACA,QAAM;AAAA,OAACyC,OAAD;AAAA,OAAUC;AAAV,MAAwB1C,QAAQ,CAAC,EAAD,CAAtC;AACA,QAAM;AAAA,OAAC2C,UAAD;AAAA,OAAaC;AAAb,MAA8B5C,QAAQ,CAAC,CAAD,CAA5C;AACA,QAAM;AAAA,OAAC6C,WAAD;AAAA,OAAcC;AAAd,MAAgC9C,QAAQ,CAAC,CAAD,CAA9C;AACA,QAAM;AAAA,OAAC+C,SAAD;AAAA,OAAYC;AAAZ,MAA4BhD,QAAQ,CAAC,EAAD,CAA1C;AACA,QAAM;AAAA,OAACiD,cAAD;AAAA,OAAiBC;AAAjB,MAAsClD,QAAQ,CAAC,KAAD,CAApD;AACA,QAAM;AAAA,OAACmD,UAAD;AAAA,OAAaC;AAAb,MAA8BpD,QAAQ,CAAC,EAAD,CAA5C;AAEA,QAAM;AAAA,OAACqD,KAAD;AAAA,OAAQC;AAAR,MAAoBtD,QAAQ,CAAC,CAAD,CAAlC;AAEAD,EAAAA,SAAS,CAAC,MAAM;AACZ,QAAI6B,KAAK,CAACO,cAAN,CAAqBoB,GAArB,IAA4BxB,EAAhC,EAAoC;AAChCC,MAAAA,KAAK,CAACJ,KAAK,CAACO,cAAN,CAAqBoB,GAAtB,CAAL;AACAnB,MAAAA,iBAAiB,CAACR,KAAK,CAACO,cAAP,CAAjB;AACAD,MAAAA,YAAY,CAACN,KAAK,CAACO,cAAN,CAAqBqB,QAArB,CAA8BD,GAA/B,CAAZ;;AAEA,UAAIE,QAAQ,GAAG9D,CAAC,CAAC+D,MAAF,CAAS9B,KAAK,CAACO,cAAN,CAAqBwB,WAArB,CAAiCC,aAA1C,EAAyD,UAAzD,CAAf;;AACA,UAAIC,aAAa,GAAGlE,CAAC,CAACmE,SAAF,CAAYL,QAAZ,CAApB;;AACAA,MAAAA,QAAQ,CAACM,GAAT,CAAa,CAACC,CAAD,EAAIC,CAAJ,KAAU;AACnBJ,QAAAA,aAAa,CAACI,CAAD,CAAb,CAAiB3C,GAAjB,GAAuB2C,CAAvB;AACAJ,QAAAA,aAAa,CAACI,CAAD,CAAb,CAAiBtC,QAAjB,GAA4B,EAA5B;AACAkC,QAAAA,aAAa,CAACI,CAAD,CAAb,CAAiBvC,KAAjB,GAAyB,MAAzB;AACAmC,QAAAA,aAAa,CAACI,CAAD,CAAb,CAAiBC,KAAjB,GAAyB,MAAzB;AACAtC,QAAAA,KAAK,CAACO,cAAN,CAAqBwB,WAArB,CAAiCC,aAAjC,CAA+CG,GAA/C,CAAmD,CAACI,EAAD,EAAKC,EAAL,KAAY;AAC3D,cAAID,EAAE,CAACE,QAAH,IAAeL,CAAC,CAACK,QAArB,EAA+B;AAC3BR,YAAAA,aAAa,CAACI,CAAD,CAAb,CAAiBtC,QAAjB,CAA0B2C,IAA1B,CAA+B;AAAEhD,cAAAA,GAAG,EAAE2C,CAAC,GAAG,EAAJ,GAASG,EAAhB;AAAoB1C,cAAAA,KAAK,EAAEyC,EAAE,CAACzC,KAA9B;AAAqCwC,cAAAA,KAAK,EAAEC,EAAE,CAACD;AAA/C,aAA/B;AACH;AACJ,SAJD;AAKH,OAVD;AAYA5B,MAAAA,WAAW,CAACuB,aAAD,CAAX;AACH;AACJ,GAtBQ,CAAT;AAwBA9D,EAAAA,SAAS,CAAC,MAAM;AAEZ,QAAI,CAAC6B,KAAK,CAAC2C,YAAN,CAAmBC,mBAApB,IAA2C5E,MAAM,CAACgC,KAAK,CAAC2C,YAAN,CAAmBC,mBAApB,CAAN,CAA+CC,QAA/C,CAAwD7E,MAAM,EAA9D,EAAkE,KAAlE,CAA/C,EAAyH;AACrHgC,MAAAA,KAAK,CAACxB,OAAN,CAAc,IAAd;AACAV,MAAAA,KAAK,CAACgF,GAAN,CAAW,GAAEvE,MAAM,CAACwE,EAAP,CAAUA,EAAV,CAAaC,GAAI,gBAA9B,EAA+CC,IAA/C,CAAoDC,GAAG,IAAI;AACvDlD,QAAAA,KAAK,CAACxB,OAAN,CAAc,KAAd;AACAwB,QAAAA,KAAK,CAACvB,iBAAN,CAAwByE,GAAG,CAACC,IAAJ,CAASA,IAAjC;AACAnD,QAAAA,KAAK,CAACtB,yBAAN,CAAgCV,MAAM,EAAtC;AACH,OAJD,EAIGoF,KAJH,CAISC,GAAG,IAAI;AACZrD,QAAAA,KAAK,CAACxB,OAAN,CAAc,KAAd;AACAd,QAAAA,OAAO,CAAC4F,KAAR,CAAcD,GAAG,CAAC3F,OAAlB;AACH,OAPD;AAQH;AACJ,GAbQ,EAaN,EAbM,CAAT;AAiBAS,EAAAA,SAAS,CAAC,MAAM;AAEZoF,IAAAA,UAAU,CAAC,CAACxC,UAAU,GAAG,CAAd,IAAmBzB,cAApB,CAAV;AACH,GAHQ,EAGN,CAACyB,UAAD,CAHM,CAAT;AAMA5C,EAAAA,SAAS,CAAC,MAAM;AACZqF,IAAAA,IAAI;AACJhC,IAAAA,aAAa,CAACzD,CAAC,CAAC0F,OAAF,CAAU,CAAC1F,CAAC,CAAC+E,GAAF,CAAMvC,cAAN,EAAuB,iBAAvB,CAAD,CAAV,CAAD,CAAb;AACH,GAHQ,EAGN,CAACA,cAAD,EAAiBP,KAAK,CAAC0D,IAAvB,CAHM,CAAT,CA9D2B,CAmE3B;AACA;AACA;AACA;AACA;AACA;AACA;;AAIA,WAASF,IAAT,GAAgB;AACZ,QAAIzC,UAAU,IAAI,CAAlB,EAAqB;AACjBwC,MAAAA,UAAU,CAAC,CAAD,CAAV;AACH,KAFD,MAEO;AACHvC,MAAAA,aAAa,CAAC,CAAD,CAAb;AACH;;AACDE,IAAAA,cAAc,CAAC,CAAD,CAAd;AACAyC,IAAAA,YAAY;AACf;;AAED,WAASJ,UAAT,CAAoBK,IAApB,EAA0B;AACtB,QAAI7F,CAAC,CAAC+E,GAAF,CAAMvC,cAAN,EAAsB,CAAC,YAAD,EAAe,KAAf,CAAtB,CAAJ,EAAkD;AAE9C,UAAIsD,KAAK,GAAG;AACRC,QAAAA,SAAS,EAAE/F,CAAC,CAAC+E,GAAF,CAAMvC,cAAN,EAAsB,CAAC,YAAD,EAAe,KAAf,CAAtB,CADH;AAERwD,QAAAA,IAAI,EAAE,SAFE;AAGRC,QAAAA,SAAS,EAAE,CACP;AACIC,UAAAA,IAAI,EAAE,WADV;AAEIC,UAAAA,GAAG,EAAE;AAFT,SADO,EAKP;AACID,UAAAA,IAAI,EAAE,YADV;AAEIC,UAAAA,GAAG,EAAE;AAFT,SALO,CAHH;AAaRC,QAAAA,MAAM,EAAE7E,cAbA;AAcR8E,QAAAA,KAAK,EAAER;AAdC,OAAZ;;AAiBA,UAAI5D,KAAK,CAAC0D,IAAN,CAAWW,aAAf,EAA8B;AAC1BR,QAAAA,KAAK,CAACS,UAAN,GAAmB;AACfC,UAAAA,GAAG,EAAEvE,KAAK,CAAC0D,IAAN,CAAWc,IAAX,CAAgBd,IAAhB,CAAqB/B;AADX,SAAnB;AAIAkC,QAAAA,KAAK,CAAC,eAAD,CAAL,GAAyB;AACrBU,UAAAA,GAAG,EAAEvE,KAAK,CAAC0D,IAAN,CAAWc,IAAX,CAAgBd,IAAhB,CAAqB/B;AADL,SAAzB;AAGH;;AACD3B,MAAAA,KAAK,CAACxB,OAAN,CAAc,IAAd;AACAD,MAAAA,MAAM,CAACkG,OAAP,CAAe,QAAf,EAAyBC,IAAzB,CAA8B;AAC1Bb,QAAAA;AAD0B,OAA9B,EAEGZ,IAFH,CAESC,GAAD,IAAS;AACblD,QAAAA,KAAK,CAACxB,OAAN,CAAc,KAAd;;AACA,YAAIF,cAAc,CAAC4E,GAAG,CAACC,IAAL,CAAlB,EAA8B;AAC1B,cAAIA,IAAI,GAAGtC,OAAO,CAAC8D,MAAR,CAAezB,GAAG,CAACC,IAAnB,CAAX;AACAjC,UAAAA,cAAc,CAACgC,GAAG,CAAC0B,KAAL,CAAd;AACA9D,UAAAA,UAAU,CAACqC,IAAD,CAAV;AACH;AACJ,OATD,EAUKC,KAVL,CAUYC,GAAD,IAAS;AACZrD,QAAAA,KAAK,CAACxB,OAAN,CAAc,KAAd;AACAd,QAAAA,OAAO,CAAC4F,KAAR,CAAcD,GAAG,CAAC3F,OAAlB;AACH,OAbL;AAcH,KA3CD,MA2CO;AACHoD,MAAAA,UAAU,CAAC,EAAD,CAAV;AACH;AACJ;;AAID,WAAS6C,YAAT,GAAwB;AACpB,QAAI5F,CAAC,CAAC+E,GAAF,CAAMvC,cAAN,EAAsB,CAAC,YAAD,EAAe,KAAf,CAAtB,KAAgDP,KAAK,CAAC0D,IAAN,CAAWW,aAA/D,EAA8E;AAE1ErE,MAAAA,KAAK,CAACxB,OAAN,CAAc,IAAd;AACAD,MAAAA,MAAM,CAACkG,OAAP,CAAe,QAAf,EAAyBC,IAAzB,CAA8B;AAC1Bb,QAAAA,KAAK,EAAE;AACHE,UAAAA,IAAI,EAAE,SADH;AAEHD,UAAAA,SAAS,EAAE/F,CAAC,CAAC+E,GAAF,CAAMvC,cAAN,EAAsB,CAAC,YAAD,EAAe,KAAf,CAAtB,CAFR;AAGH+D,UAAAA,UAAU,EAAEtE,KAAK,CAAC0D,IAAN,CAAWc,IAAX,CAAgBd,IAAhB,CAAqB/B,GAH9B;AAIHqC,UAAAA,SAAS,EAAE,CACP;AACIC,YAAAA,IAAI,EAAE,WADV;AAEIC,YAAAA,GAAG,EAAE;AAFT,WADO,EAKP;AACID,YAAAA,IAAI,EAAE,YADV;AAEIC,YAAAA,GAAG,EAAE;AAFT,WALO,CAJR;AAcHC,UAAAA,MAAM,EAAE;AAdL;AADmB,OAA9B,EAkBGlB,IAlBH,CAkBSC,GAAD,IAAS;AACblD,QAAAA,KAAK,CAACxB,OAAN,CAAc,KAAd;;AACA,YAAIF,cAAc,CAAC4E,GAAG,CAACC,IAAL,CAAlB,EAA8B;AAC1B/B,UAAAA,YAAY,CAAC8B,GAAG,CAACC,IAAL,CAAZ;AACH,SAFD,MAEO;AACH/B,UAAAA,YAAY,CAAC,EAAD,CAAZ;AACH;AACJ,OAzBD,EA0BKgC,KA1BL,CA0BYC,GAAD,IAAS;AACZrD,QAAAA,KAAK,CAACxB,OAAN,CAAc,KAAd;AACAd,QAAAA,OAAO,CAAC4F,KAAR,CAAcD,GAAG,CAAC3F,OAAlB;AACH,OA7BL;AA8BH,KAjCD,MAiCO;AACH0D,MAAAA,YAAY,CAAC,EAAD,CAAZ;AACH;AACJ;;AAED,QAAMyD,QAAQ,GAAInF,GAAD,IAAS,CACzB,CADD,CAjL2B,CAoL3B;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA,WAASoF,YAAT,GAAwB;AACpB,QAAIxG,cAAc,CAACmC,QAAD,CAAlB,EAA8B;AAC1B,UAAIsE,IAAI,GAAGhH,CAAC,CAACoE,GAAF,CAAM1B,QAAN,EAAgB,KAAhB,CAAX;;AACA,UAAInC,cAAc,CAACyG,IAAD,CAAlB,EAA0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","sourcesContent":["import { Button, Card, Col, Empty, Form, message, Row, Select, Tabs } from 'antd';\nimport axios from 'axios';\nimport _ from 'lodash';\nimport moment from 'moment';\nimport { withRouter } from 'next/router';\nimport React, { useEffect, useState } from 'react';\nimport { connect } from 'react-redux';\nimport { notEmptyLength } from '../../common-function';\nimport client from '../../feathers';\nimport { loading } from '../../redux/actions/app-actions';\nimport { fetchFeaturesList, updateCheckedFeaturesDate } from '../../redux/actions/productsList-actions';\nimport CarspecsCompareTable from '../compare/CarspecsCompareTable';\nimport { isIOS, isMobile } from 'react-device-detect'\nimport OverallRating from '../rating/OverallRating';\nimport RatingProgress from '../rating/RatingProgress';\nimport WriteReviewButton from '../rating/WriteReviewButton';\nimport ReviewList2 from '../rating/ReviewList2';\n\n\nconst { TabPane } = Tabs;\nconst { Option } = Select;\nconst reviewContainerRef = React.createRef();\n\nconst RATINGPAGESIZE = 4;\n\n\n\nconst columns = [\n    {\n        title: 'Category',\n        dataIndex: 'category',\n        key: 'category',\n        render: (text, row) => {\n            if (row.field == 'skip') {\n                return {\n                    children: <span><strong>{text}</strong></span>,\n                    props: {\n                        colSpan: 3,\n                    },\n                };\n            } else {\n                return {\n                    children: <span>{text}</span>,\n                };\n            }\n        },\n    },\n    {\n        title: 'Field',\n        dataIndex: 'field',\n        key: 'field',\n        render: (text, row) => {\n            if (text == 'skip') {\n                return {\n                    props: {\n                        colSpan: 0,\n                    },\n                };\n            } else {\n                return {\n                    children: <span>{text}</span>,\n                };\n            }\n        },\n    },\n    {\n        title: 'Value',\n        dataIndex: 'value',\n        key: 'value',\n        render: (text, row) => {\n            if (text == 'skip') {\n                return {\n                    props: {\n                        colSpan: 0,\n                    },\n                };\n            } else {\n                return {\n                    children: <span>{text}</span>,\n                };\n            }\n        },\n    },\n];\n\nconst Description = (props) => {\n    const [id, setId] = useState('')\n    const [companyId, setCompanyId] = useState(null)\n    const [productDetails, setProductDetails] = useState({})\n    const [carSpecs, setCarSpecs] = useState([])\n    const [expandedRow, setExpandedRow] = useState([])\n    const [ratings, setRatings] = useState([])\n    const [ratingPage, setRatingPage] = useState(1)\n    const [ratingTotal, setRatingTotal] = useState(0)\n    const [ownRating, setOwnRating] = useState([])\n    const [displayContact, setDisplayContact] = useState(false)\n    const [carspecIds, setCarspecIds] = useState([])\n\n    const [count, setCount] = useState(0)\n\n    useEffect(() => {\n        if (props.productDetails._id != id) {\n            setId(props.productDetails._id)\n            setProductDetails(props.productDetails)\n            setCompanyId(props.productDetails.companys._id)\n\n            let uniqSpec = _.uniqBy(props.productDetails.carspecsAll.specification, 'category')\n            let cloneUniqSpec = _.cloneDeep(uniqSpec)\n            uniqSpec.map((v, i) => {\n                cloneUniqSpec[i].key = i\n                cloneUniqSpec[i].children = []\n                cloneUniqSpec[i].field = 'skip'\n                cloneUniqSpec[i].value = 'skip'\n                props.productDetails.carspecsAll.specification.map((v1, i1) => {\n                    if (v1.category == v.category) {\n                        cloneUniqSpec[i].children.push({ key: i + '' + i1, field: v1.field, value: v1.value })\n                    }\n                })\n            })\n\n            setCarSpecs(cloneUniqSpec)\n        }\n    })\n\n    useEffect(() => {\n\n        if (!props.productsList.checkedFeaturesDate || moment(props.productsList.checkedFeaturesDate).isBefore(moment(), 'day')) {\n            props.loading(true);\n            axios.get(`${client.io.io.uri}getFeatureList`).then(res => {\n                props.loading(false);\n                props.fetchFeaturesList(res.data.data);\n                props.updateCheckedFeaturesDate(moment());\n            }).catch(err => {\n                props.loading(false);\n                message.error(err.message)\n            });\n        }\n    }, []);\n\n\n\n    useEffect(() => {\n\n        getRatings((ratingPage - 1) * RATINGPAGESIZE);\n    }, [ratingPage])\n\n\n    useEffect(() => {\n        init();\n        setCarspecIds(_.compact([_.get(productDetails , 'carspecsAll._id')]));\n    }, [productDetails, props.user])\n\n    // useEffect(() => {\n    //     setCount(count + 1);\n    //     if (count < 10) {\n    //         console.log(props.user);\n    //         props.loading(!props.app.loading)\n    //     }\n    // }, [props.user])\n\n\n\n    function init() {\n        if (ratingPage == 1) {\n            getRatings(0);\n        } else {\n            setRatingPage(1);\n        }\n        setRatingTotal(0);\n        getOwnRating();\n    }\n\n    function getRatings(skip) {\n        if (_.get(productDetails, ['carspecsId', '_id'])) {\n\n            let query = {\n                carspecId: _.get(productDetails, ['carspecsId', '_id']),\n                type: 'carspec',\n                $populate: [\n                    {\n                        path: 'carspecId',\n                        ref: 'carspecs'\n                    },\n                    {\n                        path: 'reviewerId',\n                        ref: 'users'\n                    }\n                ],\n                $limit: RATINGPAGESIZE,\n                $skip: skip,\n            }\n\n            if (props.user.authenticated) {\n                query.reviewerId = {\n                    $ne: props.user.info.user._id,\n                }\n\n                query[\"hideBy.userId\"] = {\n                    $ne: props.user.info.user._id,\n                }\n            }\n            props.loading(true);\n            client.service('rating').find({\n                query\n            }).then((res) => {\n                props.loading(false);\n                if (notEmptyLength(res.data)) {\n                    let data = ratings.concat(res.data);\n                    setRatingTotal(res.total);\n                    setRatings(data);\n                }\n            })\n                .catch((err) => {\n                    props.loading(false);\n                    message.error(err.message);\n                })\n        } else {\n            setRatings([]);\n        }\n    }\n\n\n\n    function getOwnRating() {\n        if (_.get(productDetails, ['carspecsId', '_id']) && props.user.authenticated) {\n\n            props.loading(true);\n            client.service('rating').find({\n                query: {\n                    type: 'carspec',\n                    carspecId: _.get(productDetails, ['carspecsId', '_id']),\n                    reviewerId: props.user.info.user._id,\n                    $populate: [\n                        {\n                            path: 'carspecId',\n                            ref: 'carspecs'\n                        },\n                        {\n                            path: 'reviewerId',\n                            ref: 'users'\n                        }\n                    ],\n                    $limit: 1,\n                }\n\n            }).then((res) => {\n                props.loading(false);\n                if (notEmptyLength(res.data)) {\n                    setOwnRating(res.data);\n                } else {\n                    setOwnRating([]);\n                }\n            })\n                .catch((err) => {\n                    props.loading(false);\n                    message.error(err.message);\n                })\n        } else {\n            setOwnRating([]);\n        }\n    }\n\n    const callback = (key) => {\n    }\n\n    // function getFeatureText(data) {\n\n    //     switch (data) {\n    //         case \"abs\":\n    //             return 'ABS';\n    //         case \"adjustablesteeringwheel\":\n    //             return 'Adjustable Steering Wheel';\n    //         case \"airbags\":\n    //             return \"Air bags\"\n    //         case \"alarm\":\n    //             return \"Alarm\"\n    //         case \"blindspotmonitor\":\n    //             return \"Blind spot monitor\"\n    //         case \"bodykits\":\n    //             return \"Body Kits\"\n    //         case \"brakeassist\":\n    //             return \"Brake Assist\"\n    //         case \"bucketseat\":\n    //             return \"Bucket Seat\"\n    //         case \"cdplayer\":\n    //             return \"Cd Player\"\n    //         case \"centrallocks\":\n    //             return \"Central Locks\"\n    //         case \"centraltouchscreen\":\n    //             return \"Central touchscreen\"\n    //         case \"childsafetylock\":\n    //             return \"Child safety lock\"\n    //         case \"cruisecontrol\":\n    //             return \"Cruise Control\"\n    //         case \"daytimerunninglights\":\n    //             return \"Daytime running lights\"\n    //         case \"driveradjustablelumbar\":\n    //             return \"Driver adjustable lumbar\"\n    //         case \"drivervanityminor\":\n    //             return \"Driver Vanity minor\"\n    //         case \"electricseat\":\n    //             return \"Electric Seat\"\n    //         case \"foglamps\":\n    //             return \"Fog Lamps\"\n    //         case \"frontwheeldrive\":\n    //             return \"Front Wheel Drive\"\n    //         case \"gpsnavigation\":\n    //             return \"GPS Navigation\"\n    //         case \"heatedfrontseat\":\n    //             return \"Heated Front Seat\"\n    //         case \"keylessstart\":\n    //             return \"Keyless Start\"\n    //         case \"lanedeparturewarning\":\n    //             return \"Lane departure warning\"\n    //         case \"leatherseats\":\n    //             return \"Leather Seats\"\n    //         case \"manufacturerwarranty\":\n    //             return \"Manufacturer Warranty\"\n    //         case \"mp3players\":\n    //             return \"MP3 Players\"\n    //         case \"multifunctionsteering\":\n    //             return \"Multi Function Steering\"\n    //         case \"paddleshift\":\n    //             return \"Paddle Shift\"\n    //         case \"parkingsensor\":\n    //             return \"Parking Sensor\"\n    //         case \"passangerilluminatedvisormirror\":\n    //             return \"Passanger Illuminated visor mirror\"\n    //         case \"powersteering\":\n    //             return \"Power Steering\"\n    //         case \"powerwindow\":\n    //             return \"Power Window\"\n    //         case \"reardefrost\":\n    //             return \"Rear Defrost\"\n    //         case \"reservecamera\":\n    //             return \"Reserve Camera\"\n    //         case \"sportrims\":\n    //             return \"Sport rims\"\n    //         case \"stabilitycontrol\":\n    //             return \"Stability Control\"\n    //         case \"steeringwheelaudio\":\n    //             return \"Steering Wheel Audio\"\n    //         case \"sunroof/moonroof\":\n    //             return \"Sunroof / Moonroof\"\n    //         case \"telematics\":\n    //             return \"Telematics\"\n    //         case \"tripcomputer\":\n    //             return \"Trip Computer\"\n    //         case \"usb\":\n    //             return \"USB\"\n    //         case \"wheellock\":\n    //             return \"Wheel lock\"\n    //         case \"windowtint\":\n    //             return \"Window Tint\"\n    //         case \"wipes\":\n    //             return \"Wipes\"\n    //         default:\n    //             return null;\n    //     }\n    // }\n\n    function expandAllRow() {\n        if (notEmptyLength(carSpecs)) {\n            let keys = _.map(carSpecs, 'key');\n            if (notEmptyLength(keys)) {\n                setExpandedRow(keys);\n            }\n        } else {\n            setExpandedRow([]);\n        }\n    }\n\n    function shrinkAllRow() {\n        setExpandedRow([]);\n    }\n\n    const _renderFeatures = (data) => {\n        if (notEmptyLength(props.productsList.featuresList) && notEmptyLength(data)) {\n            let temp = _.filter(props.productsList.featuresList, function (item) {\n                return _.includes(data, item.value);\n            })\n            if (notEmptyLength(temp)) {\n\n                let list = temp.map(function (item) {\n                    return (\n                        <Col span={8}>\n                            <div className=\"flex-justify-start flex-items-align-center padding-x-sm fill-parent \">\n                                {/* <div className=\"round-border wrapBorderRed\" style={{width:'50px', height:'50px'}}> */}\n                                <span className=\"margin-x-sm relative-wrapper\" style={{ height: \"30px\", width: '30px' }}>\n                                    <img src={item.icon ? item.icon : null} className=\"fill-parent absolute-center\" />\n                                </span>\n                                {/* </div> */}\n                                <span className=\"padding-sm headline flex-justify-center flex-items-align-center text-truncate-threeline\">\n                                    {item.text ? item.text : null}\n                                </span>\n                            </div>\n                        </Col>\n                    );\n                })\n\n                return (\n                    <div style={{ minHeight: 500 }}>\n                        <Row type=\"flex\" align=\"middle\" gutter={[10, 10]} >\n                            {list}\n                        </Row>\n                    </div>\n                )\n            } else {\n                return <Empty\n                    style={{ position: 'relative', top: '50%', transform: 'translateY(-50%)' }}\n                    image=\"/empty.png\"\n                    imageStyle={{\n                        height: 60,\n                    }\n                    }\n                    description={\n                        <span>\n                            No Result\n            </span>\n                    }\n                >\n                </Empty>\n            }\n\n\n        } else {\n\n            return <Empty\n                style={{ position: 'relative', top: '50%', transform: 'translateY(-50%)' }}\n                image=\"/empty.png\"\n                imageStyle={{\n                    height: 60,\n                }\n                }\n                description={\n                    <span>\n                        No Result\n            </span>\n                }\n            >\n            </Empty>\n        }\n    }\n\n    const _renderExpandButton = () => {\n        return (\n            <React.Fragment>\n\n                <Button icon=\"arrows-alt\" onClick={expandAllRow} className=\"background-ccar-yellow margin-x-sm\">\n                    Expand All\n            </Button>\n                <Button icon=\"shrink\" onClick={shrinkAllRow} className=\"margin-x-sm\">\n                    Shrink All\n            </Button>\n            </React.Fragment>\n        )\n    }\n\n    function changeProductDetails(data, type) {\n\n        if (_.isEmpty(data) === true) { return }\n        let dataString = _.cloneDeep(data)\n        let phoneFormat = /((601)|(01))[0-46-9]*[0-9]{7,10}/gim\n        let phoneFormat2 = /([601]|[01]|)[0-46-9]-*[0-9]{7,10}/g\n\n        dataString = dataString.split('\\n')\n        dataString = dataString.map(function (v) {\n\n            let v2 = v\n            v = v.replace(/\\s/g, '')\n            v = v.replace(/\\+/g, '')\n            v = v.replace(/-/g, '')\n            let n = v.match(phoneFormat);\n            let s = v.split(phoneFormat2);\n\n\n            let x = ''\n            if (_.isEmpty(n) === true) { return <p style={{ marginBottom: '0em' }}>{v2}</p> }\n\n            s = _.without(s, '6')\n            s = _.without(s, '0')\n            s = _.without(s, '')\n            x = s.map(function (v, i) {\n\n                if (n[i]) {\n                    if (type === 'callContact') {\n\n                        if (n[i].charAt(0) !== '6') {\n                            n[i] = '6' + n[i]\n                        }\n\n                        if (isMobile) {\n                            v = <><>{v}</> <a className='contactShow'\n                                target={'_blank'}\n                                href={\"tel:\" + n[i]}\n                            >{n[i]}</a></>\n                        }\n                        else {\n\n                            let username = ''\n                            try {\n                                username = productDetails.createdBy.namePrefix + ' ' + productDetails.createdBy.fullName\n                            }\n                            catch (err) { username = '' }\n\n                            v = <><>{v}</> <a className='contactShow'\n                                target={'_blank'}\n                                href={\n                                    \"https://web.whatsapp.com/send?phone=\"\n                                    + n[i].replace('+', '') + \"&text=Hi \"\n                                    + username\n                                    + \", I am interested in your car ad on ccar.my and I would like to know more about \"\n                                    + productDetails.title\n                                    + \" (RM \"\n                                    + productDetails.price.toFixed(2) + \"). Thank you. https://share.ccar.my/viewCar/\"\n                                    + productDetails._id}\n\n                            >{n[i]}</a></>\n                        }\n                    }\n                    else {\n                        v = <><>{v}</> <span className='contactHide' onClick={() => { setDisplayContact(true) }}>(Click to View Contact No.)</span></>\n                    }\n                }\n                return v\n            })\n            return <p style={{ marginBottom: '0em' }}>{x}</p>\n        })\n        return dataString\n    }\n\n    return (\n        <div>\n            <Card size=\"small\">\n                <p style={{ whiteSpace: 'pre-wrap' }}  >{displayContact ? changeProductDetails(productDetails.description, 'callContact') : changeProductDetails(productDetails.description)}</p>\n            </Card>\n        </div >\n    );\n}\n\nconst mapStateToProps = state => ({\n    user: state.user,\n    app: state.app,\n    productsList: state.productsList,\n});\n\nconst mapDispatchToProps = {\n    loading: loading,\n    fetchFeaturesList: fetchFeaturesList,\n    updateCheckedFeaturesDate: updateCheckedFeaturesDate,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Form.create()(withRouter(Description)));"]},"metadata":{},"sourceType":"module"}