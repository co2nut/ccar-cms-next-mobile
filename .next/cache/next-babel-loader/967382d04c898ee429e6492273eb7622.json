{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nvar _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { Avatar, Col, Empty, Row, Tabs, Tooltip } from 'antd';\nimport axios from \"axios\";\nimport _ from 'lodash';\nimport moment from \"moment\";\nimport React, { useEffect, useState } from 'react';\nimport { connect } from 'react-redux';\nimport YouTube from 'react-youtube';\nimport { formatDate, notEmptyLength, arrayLengthCount } from '../../common-function';\nimport client from '../../feathers';\nimport { Form } from '@ant-design/compatible';\nimport { withRouter } from 'next/dist/client/router';\nimport Scrollbars from 'react-custom-scrollbars';\nimport Loading from '../general/Loading';\nimport { allIcon } from '../../icon';\nvar opts = {\n  height: '390',\n  width: '640',\n  playerVars: {\n    // https://developers.google.com/youtube/player_parameters\n    autoplay: 0\n  }\n};\nvar VIDEOSIZE = 6;\nvar AUTHORSIZE = 10;\n\nvar SocialVideoTabs = function SocialVideoTabs(props) {\n  _s();\n\n  var _useState = useState(null),\n      activeKey = _useState[0],\n      setActiveKey = _useState[1];\n\n  var _useState2 = useState([]),\n      videolist = _useState2[0],\n      setVideolist = _useState2[1];\n\n  var _useState3 = useState(false),\n      videoLoading = _useState3[0],\n      setVideoLoading = _useState3[1];\n\n  var _useState4 = useState([]),\n      authorList = _useState4[0],\n      setAuthorList = _useState4[1];\n\n  var _useState5 = useState(false),\n      authorLoading = _useState5[0],\n      setAuthorLoading = _useState5[1];\n\n  var _useState6 = useState(null),\n      selectedAuthor = _useState6[0],\n      setSelectedAuthor = _useState6[1];\n\n  var _useState7 = useState({\n    authorId: null,\n    language: null\n  }),\n      filterGroup = _useState7[0],\n      setFilterGroup = _useState7[1];\n\n  useEffect(function () {\n    getAuthorList();\n  }, []);\n  useEffect(function () {\n    getVideolist();\n  }, [filterGroup, authorList]);\n\n  function getAuthorList() {\n    var match = {\n      publisher: 'youtube'\n    };\n\n    if (props.isNewCar) {\n      match.carYear = moment().format('YYYY');\n\n      if (notEmptyLength(props.data)) {\n        var data = _.compact([_.toLower(props.data.model)]);\n\n        if (notEmptyLength(data)) {\n          match.keywords = {\n            $in: data\n          };\n        }\n      }\n    }\n\n    setAuthorLoading(true);\n    axios.get(\"\".concat(client.io.io.uri, \"getAuthorList\"), {\n      params: {\n        limit: AUTHORSIZE,\n        $match: match\n      }\n    }).then(function (res) {\n      //Wait for render done just unloading\n      setTimeout(function () {\n        setAuthorLoading(false);\n      }, 500);\n\n      if (notEmptyLength(res.data.data)) {\n        setAuthorList(res.data.data);\n      } else {\n        setAuthorList([]);\n      }\n    })[\"catch\"](function (err) {\n      setAuthorLoading(false); // message.error(err.message)\n    });\n  }\n\n  function getVideolist(key) {\n    var query = {\n      $sort: {\n        publishedAt: -1\n      },\n      $limit: VIDEOSIZE,\n      $populate: ['authorId'],\n      publisher: 'youtube'\n    };\n\n    if (props.isNewCar) {\n      query.carYear = moment().format('YYYY');\n\n      if (notEmptyLength(props.data)) {\n        var temp = _.compact([props.data.model]);\n\n        if (notEmptyLength(temp)) {\n          temp = _.map(temp, function (item) {\n            return _.toLower(item);\n          });\n          query.keywords = {\n            $in: temp\n          };\n        }\n      }\n    }\n\n    if (filterGroup.authorId != null && filterGroup.authorId != \"\") {\n      query.authorId = filterGroup.authorId;\n    } else {\n      delete query['authorId'];\n    }\n\n    if (filterGroup.language != null && filterGroup.language != \"\" && filterGroup.language != \"all\") {\n      query.language = filterGroup.language;\n      setActiveKey(filterGroup.language);\n    } else {\n      delete query['language'];\n\n      if (languageCount() > 1) {\n        setActiveKey(null);\n      } else {\n        var langs = [];\n\n        _.forEach(authorList, function (item) {\n          langs = _.union(langs, item.language);\n        });\n\n        setActiveKey(notEmptyLength(langs) ? langs[0] : null);\n      }\n    }\n\n    if (query.language) {\n      if (query.language === 'all') {\n        delete query.language;\n      }\n    }\n\n    setVideoLoading(true);\n    client.service('news').find({\n      query: query\n    }).then(function (res) {\n      //Wait for render done just unloading\n      setTimeout(function () {\n        setVideoLoading(false);\n      }, 500);\n\n      if (res.data.length > 0) {\n        setVideolist(res.data);\n      } else {\n        setVideolist([]);\n      }\n    })[\"catch\"](function (err) {\n      setVideoLoading(false); // message.error(err.message)\n    });\n  }\n\n  function isSelectedAuthor(author, selectedAuthor) {\n    if (author == null && selectedAuthor == null) {\n      return true;\n    } else if (notEmptyLength(author) && notEmptyLength(selectedAuthor)) {\n      return author._id == selectedAuthor._id;\n    } else {\n      return false;\n    }\n  }\n\n  function languageExisted(lang) {\n    if (lang != null) {\n      if (notEmptyLength(selectedAuthor)) {\n        return _.includes(selectedAuthor.language, lang);\n      } else {\n        var langs = [];\n\n        _.forEach(authorList, function (item) {\n          langs = _.union(langs, item.language);\n        });\n\n        return _.includes(langs, lang);\n      }\n    } else {\n      return false;\n    }\n  }\n\n  function languageCount(author) {\n    var langs = [];\n\n    if (notEmptyLength(author)) {\n      return notEmptyLength(author.language) ? author.language.length : 0;\n    } else {\n      _.forEach(authorList, function (item) {\n        langs = _.union(langs, item.language);\n      });\n    }\n\n    return langs.length;\n  }\n\n  var _renderAuthorList = function _renderAuthorList(data) {\n    if (notEmptyLength(data)) {\n      var allIconHtml = __jsx(\"div\", {\n        key: \"authorList\",\n        className: !isSelectedAuthor(null, selectedAuthor) ? \"padding-md flex-justify-center flex-items-align-center\" : \"padding-md flex-justify-center flex-items-align-center border-selected-yellow thin-border\"\n      }, __jsx(Tooltip, {\n        title: \"All\",\n        placement: \"right\"\n      }, __jsx(\"a\", {\n        onClick: function onClick() {\n          setFilterGroup(_objectSpread(_objectSpread({}, filterGroup), {}, {\n            authorId: null,\n            language: null\n          }));\n          setSelectedAuthor(null);\n        }\n      }, __jsx(\"span\", {\n        className: \"d-inline-block avatar background-grey-lighten-2 overflow-hidden relative-wrapper\",\n        style: {\n          width: 50,\n          height: 50\n        }\n      }, __jsx(\"img\", {\n        src: allIcon,\n        className: \"width-50 height-50 absolute-center\"\n      })))));\n\n      var list = data.map(function (item, i) {\n        return __jsx(\"div\", {\n          key: 'authorList' + i,\n          className: !isSelectedAuthor(item, selectedAuthor) ? \"padding-md flex-justify-center flex-items-align-center\" : \"padding-md flex-justify-center flex-items-align-center border-selected-yellow thin-border\"\n        }, __jsx(Tooltip, {\n          title: item.name ? item.name : null,\n          placement: \"right\"\n        }, __jsx(\"a\", {\n          onClick: function onClick() {\n            setFilterGroup(_objectSpread(_objectSpread({}, filterGroup), {}, {\n              authorId: item._id,\n              language: languageCount(item) > 1 ? null : item.language[0]\n            }));\n            setSelectedAuthor(item);\n          }\n        }, __jsx(Avatar, {\n          size: 50,\n          src: item.thumbnailUrl ? item.thumbnailUrl : null,\n          icon: item.thumbnailUrl ? null : 'user'\n        }))));\n      });\n      list.unshift(allIconHtml);\n      return __jsx(Loading, {\n        spinning: authorLoading\n      }, list);\n    } else {\n      return null;\n    }\n  };\n\n  var _renderVideoList = function _renderVideoList(data, language) {\n    if (notEmptyLength(data)) {\n      return __jsx(Row, {\n        gutter: [10, 10]\n      }, __jsx(\"div\", {\n        key: language,\n        className: \"d-flex scroller-type\",\n        style: {\n          overflow: 'scroll'\n        }\n      }, data.map(function (item, i) {\n        return __jsx(Col, {\n          key: item._id,\n          xs: 18,\n          sm: 18,\n          md: 18,\n          lg: 18,\n          xl: 18\n        }, __jsx(\"div\", {\n          className: \"wrap box-shadow-thin round-border\",\n          style: {\n            height: '250px',\n            width: '100%'\n          }\n        }, __jsx(\"div\", {\n          className: \"video\"\n        }, __jsx(YouTube, {\n          videoId: item.youtubeId,\n          opts: opts\n        })), __jsx(\"div\", {\n          className: \"flex-items-align-start\"\n        }, __jsx(\"span\", null, __jsx(\"div\", {\n          className: \"icon\"\n        }, __jsx(\"img\", {\n          src: item.channelThumbnailUrl\n        }))), __jsx(\"span\", null, __jsx(\"div\", {\n          className: \"title\"\n        }, __jsx(\"div\", {\n          className: \"text-truncate-twoline margin-bottom-sm font-weight-bold\"\n        }, item.title), __jsx(\"span\", {\n          style: {\n            fontSize: '12px'\n          }\n        }, item.authorId ? item.authorId.name : null, \" | \", formatDate(item.publishedAt, \"DD-MM-YYYY\")))))));\n      })));\n    } else {\n      return null;\n    }\n  };\n\n  return __jsx(React.Fragment, null, __jsx(\"div\", {\n    className: \"padding-x-xs\",\n    style: {\n      touchAction: 'pan-y'\n    }\n  }, _renderVideoList(videolist)));\n};\n\n_s(SocialVideoTabs, \"MJNAn5MKeUo4EGbufGk3cDwTkjw=\");\n\n_c = SocialVideoTabs;\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    app: state.app,\n    newCars: state.newCars\n  };\n};\n\nvar mapDispatchToProps = {};\nexport default connect(mapStateToProps, mapDispatchToProps)(Form.create()(withRouter(SocialVideoTabs)));\n\nvar _c;\n\n$RefreshReg$(_c, \"SocialVideoTabs\");","map":{"version":3,"sources":["/Users/faraheen/ccar-cms-next-mobile/components/news/social-video-tabs.jsx"],"names":["Avatar","Col","Empty","Row","Tabs","Tooltip","axios","_","moment","React","useEffect","useState","connect","YouTube","formatDate","notEmptyLength","arrayLengthCount","client","Form","withRouter","Scrollbars","Loading","allIcon","opts","height","width","playerVars","autoplay","VIDEOSIZE","AUTHORSIZE","SocialVideoTabs","props","activeKey","setActiveKey","videolist","setVideolist","videoLoading","setVideoLoading","authorList","setAuthorList","authorLoading","setAuthorLoading","selectedAuthor","setSelectedAuthor","authorId","language","filterGroup","setFilterGroup","getAuthorList","getVideolist","match","publisher","isNewCar","carYear","format","data","compact","toLower","model","keywords","$in","get","io","uri","params","limit","$match","then","res","setTimeout","err","key","query","$sort","publishedAt","$limit","$populate","temp","map","item","languageCount","langs","forEach","union","service","find","length","isSelectedAuthor","author","_id","languageExisted","lang","includes","_renderAuthorList","allIconHtml","list","i","name","thumbnailUrl","unshift","_renderVideoList","overflow","youtubeId","channelThumbnailUrl","title","fontSize","touchAction","mapStateToProps","state","app","newCars","mapDispatchToProps","create"],"mappings":"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","sourcesContent":["import { Avatar, Col, Empty, Row, Tabs, Tooltip } from 'antd';\nimport axios from \"axios\";\nimport _ from 'lodash';\nimport moment from \"moment\";\nimport React, { useEffect, useState } from 'react';\nimport { connect } from 'react-redux';\nimport YouTube from 'react-youtube';\nimport { formatDate, notEmptyLength, arrayLengthCount } from '../../common-function';\nimport client from '../../feathers';\nimport { Form } from '@ant-design/compatible';\nimport { withRouter } from 'next/dist/client/router';\nimport Scrollbars from 'react-custom-scrollbars';\nimport Loading from '../general/Loading';\nimport { allIcon } from '../../icon';\n\n\n\nconst opts = {\n    height: '390',\n    width: '640',\n    playerVars: {\n        // https://developers.google.com/youtube/player_parameters\n        autoplay: 0,\n    },\n};\nconst VIDEOSIZE = 6;\nconst AUTHORSIZE = 10;\nconst SocialVideoTabs = (props) => {\n\n\n    const [activeKey, setActiveKey] = useState(null);\n    const [videolist, setVideolist] = useState([]);\n    const [videoLoading, setVideoLoading] = useState(false);\n    const [authorList, setAuthorList] = useState([]);\n    const [authorLoading, setAuthorLoading] = useState(false);\n    const [selectedAuthor, setSelectedAuthor] = useState(null);\n    const [filterGroup, setFilterGroup] = useState({\n        authorId: null,\n        language: null,\n    });\n\n\n    useEffect(() => {\n        getAuthorList();\n    }, [])\n\n    useEffect(() => {\n        getVideolist();\n    }, [filterGroup, authorList])\n\n    function getAuthorList() {\n\n        let match = {\n            publisher: 'youtube',\n        };\n\n        if (props.isNewCar) {\n            match.carYear = moment().format('YYYY');\n            if (notEmptyLength(props.data)) {\n                let data = _.compact([_.toLower(props.data.model)]);\n                if (notEmptyLength(data)) {\n                    match.keywords = {\n                        $in: data,\n                    }\n                }\n            }\n        }\n\n        setAuthorLoading(true);\n        axios.get(`${client.io.io.uri}getAuthorList`,\n            {\n                params: {\n                    limit: AUTHORSIZE,\n                    $match: match,\n                }\n            }).then((res) => {\n                //Wait for render done just unloading\n                setTimeout(() => {\n                    setAuthorLoading(false);\n                }, 500);\n                if (notEmptyLength(res.data.data)) {\n                    setAuthorList(res.data.data);\n                } else {\n                    setAuthorList([]);\n                }\n            }).catch(err => {\n                setAuthorLoading(false);\n                // message.error(err.message)\n            });\n    }\n\n    function getVideolist(key) {\n        let query = {\n            $sort: {\n                publishedAt: -1\n            },\n            $limit: VIDEOSIZE,\n            $populate: ['authorId'],\n            publisher: 'youtube'\n        }\n\n        if (props.isNewCar) {\n            query.carYear = moment().format('YYYY');\n            if (notEmptyLength(props.data)) {\n                let temp = _.compact([props.data.model]);\n                if (notEmptyLength(temp)) {\n                    temp = _.map(temp, function (item) {\n                        return _.toLower(item);\n                    })\n                    query.keywords = {\n                        $in: temp,\n                    }\n                }\n            }\n        }\n\n        if (filterGroup.authorId != null && filterGroup.authorId != \"\") {\n            query.authorId = filterGroup.authorId;\n        } else {\n            delete query['authorId'];\n        }\n\n        if (filterGroup.language != null && filterGroup.language != \"\" && filterGroup.language != \"all\") {\n            query.language = filterGroup.language;\n            setActiveKey(filterGroup.language);\n        } else {\n            delete query['language'];\n            if (languageCount() > 1) {\n                setActiveKey(null);\n            } else {\n                let langs = [];\n                _.forEach(authorList, function (item) {\n                    langs = _.union(langs, item.language);\n                })\n                setActiveKey(notEmptyLength(langs) ? langs[0] : null);\n            }\n        }\n\n        if (query.language) {\n            if (query.language === 'all') {\n                delete query.language\n            }\n        }\n\n\n        setVideoLoading(true);\n        client.service('news').find({\n            query: query,\n        }).then((res) => {\n            //Wait for render done just unloading\n            setTimeout(() => {\n                setVideoLoading(false);\n            }, 500);\n            if (res.data.length > 0) {\n                setVideolist(res.data);\n            } else {\n                setVideolist([]);\n            }\n        }).catch(err => {\n            setVideoLoading(false);\n            // message.error(err.message)\n        });\n\n    }\n\n    function isSelectedAuthor(author, selectedAuthor) {\n        if (author == null && selectedAuthor == null) {\n            return true;\n        } else if (notEmptyLength(author) && notEmptyLength(selectedAuthor)) {\n            return author._id == selectedAuthor._id;\n        } else {\n            return false;\n        }\n    }\n\n\n    function languageExisted(lang) {\n        if (lang != null) {\n            if (notEmptyLength(selectedAuthor)) {\n                return _.includes(selectedAuthor.language, lang)\n            } else {\n                let langs = [];\n                _.forEach(authorList, function (item) {\n                    langs = _.union(langs, item.language);\n                })\n\n                return _.includes(langs, lang)\n            }\n        } else {\n            return false;\n        }\n    }\n\n    function languageCount(author) {\n        let langs = [];\n        if (notEmptyLength(author)) {\n            return notEmptyLength(author.language) ? author.language.length : 0;\n        } else {\n            _.forEach(authorList, function (item) {\n                langs = _.union(langs, item.language);\n            })\n        }\n        return langs.length;\n    }\n\n\n    const _renderAuthorList = (data) => {\n\n        if (notEmptyLength(data)) {\n            let allIconHtml = (\n                <div key='authorList' className={!isSelectedAuthor(null, selectedAuthor) ? \"padding-md flex-justify-center flex-items-align-center\" : \"padding-md flex-justify-center flex-items-align-center border-selected-yellow thin-border\"} >\n                    <Tooltip title=\"All\" placement=\"right\">\n                        <a onClick={() => { setFilterGroup({ ...filterGroup, authorId: null, language: null }); setSelectedAuthor(null); }}>\n                            <span className='d-inline-block avatar background-grey-lighten-2 overflow-hidden relative-wrapper' style={{ width : 50, height : 50 }} >\n                              <img src={allIcon} className=\"width-50 height-50 absolute-center\" />\n                            </span>\n                        </a>\n                    </Tooltip>\n                </div>\n            );\n\n            let list = data.map(function (item, i) {\n                return (\n                    <div key={'authorList' + i} className={!isSelectedAuthor(item, selectedAuthor) ? \"padding-md flex-justify-center flex-items-align-center\" : \"padding-md flex-justify-center flex-items-align-center border-selected-yellow thin-border\"} >\n                        <Tooltip title={item.name ? item.name : null} placement=\"right\">\n                            <a onClick={() => { setFilterGroup({ ...filterGroup, authorId: item._id, language: languageCount(item) > 1 ? null : item.language[0] }); setSelectedAuthor(item); }}>\n                                <Avatar size={50} src={item.thumbnailUrl ? item.thumbnailUrl : null} icon={item.thumbnailUrl ? null : 'user'} />\n                            </a>\n                        </Tooltip>\n                    </div>\n                );\n\n            });\n\n            list.unshift(allIconHtml);\n            return (\n                <Loading spinning={authorLoading}>\n                    {list}\n                </Loading>\n            );\n        } else {\n            return null;\n        }\n\n    }\n\n    const _renderVideoList = (data, language) => {\n        if (notEmptyLength(data)) {\n            return (\n                    <Row gutter={[10, 10]}>\n                        <div key={language} className=\"d-flex scroller-type\" style={{overflow:'scroll' }}>\n                        {data.map(function (item, i) {\n                            return (\n                                <Col key={item._id} xs={18} sm={18} md={18} lg={18} xl={18}>\n                                    <div className=\"wrap box-shadow-thin round-border\" style={{height: '250px', width:'100%'}}>\n                                        <div className=\"video\">\n                                            <YouTube videoId={item.youtubeId} opts={opts} />\n                                            {/* <iframe controls autoplay src=\"https://www.youtube.com/watch?v=gV7YudrTmQ4\" style={{width: \"100%\"}} > */}\n                                            {/* </iframe> */}\n                                        </div>\n\n                                        <div className=\"flex-items-align-start\">\n                                            <span>\n                                                <div className=\"icon\">\n                                                    <img src={item.channelThumbnailUrl} />\n                                                </div>\n                                            </span>\n                                            <span>\n                                                <div className=\"title\">\n                                                    <div className=\"text-truncate-twoline margin-bottom-sm font-weight-bold\">\n                                                        {item.title}\n                                                    </div>\n                                                    <span style={{fontSize:'12px'}}>\n                                                            {item.authorId ? item.authorId.name : null} | {formatDate(item.publishedAt, \"DD-MM-YYYY\")}\n                                                    </span>\n                                                    {/* <div className=\"text-truncate\">\n                                                        {item.authorId ? item.authorId.name : null}\n                                                    </div>\n                                                    <div className=\"text-truncate\">\n                                                        {formatDate(item.publishedAt, \"DD-MM-YYYY\")}\n                                                    </div> */}\n                                                </div>\n\n                                            </span>\n                                        </div>\n                                    </div>\n                                </Col>\n                            )\n                        })\n                        }\n                        </div>\n                    </Row>\n            )\n        } else {\n            return null;\n        }\n    }\n    return (\n        <React.Fragment>\n            <div className=\"padding-x-xs\" style={{touchAction:'pan-y'}}>\n                {_renderVideoList(videolist)}\n            </div>\n        </React.Fragment>\n    );\n}\n\n\nconst mapStateToProps = state => ({\n    app: state.app,\n    newCars: state.newCars,\n});\n\nconst mapDispatchToProps = {\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(Form.create()(withRouter(SocialVideoTabs)));"]},"metadata":{},"sourceType":"module"}