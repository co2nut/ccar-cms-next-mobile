{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport _ from 'lodash';\nimport axios from 'axios';\nimport client from '../feathers';\nimport { isValidNumber, notEmptyLength, convertToRangeFormat, convertRangeFormatBack, convertFilterRange, objectRemoveEmptyValue } from '../common-function';\nconst PAGESIZE = 30;\n\nconst distinctArr = (value, index, self) => {\n  return self.indexOf(value) === index;\n};\n\nexport default async function (data, limit) {\n  if (!_.isPlainObject(data)) {\n    data = {};\n  }\n\n  if (!_.has(data, ['filterGroup'])) {\n    data.filterGroup = {};\n  } else {\n    data.filterGroup = _.cloneDeep(data.filterGroup);\n  }\n\n  if (!_.has(data, ['config'])) {\n    data.config = {\n      page: 1,\n      sorting: {}\n    };\n  }\n\n  if (!isValidNumber(parseInt(limit))) {\n    limit = PAGESIZE;\n  }\n\n  if (!isValidNumber(parseInt(data.config.page))) {\n    data.config.page = 1;\n  }\n\n  if (!_.get(data.config, ['sorting', 'carspec.year']) && !_.get(data.config, ['sorting', 'mileageFilter']) && !_.get(data.config, ['sorting', 'searchPrice'])) {\n    data.config.sorting = {};\n  }\n\n  let andFilter = {\n    $and: []\n  };\n\n  if (_.isArray(data.filterGroup.$and) && !_.isEmpty(data.filterGroup.$and)) {\n    andFilter.$and = [...data.filterGroup.$and];\n  }\n\n  if (notEmptyLength(data.filterGroup) && notEmptyLength(data.filterGroup.yearRange)) {\n    data.filterGroup.yearRange = convertToRangeFormat(data.filterGroup.yearRange);\n    data.filterGroup.yearRange = convertFilterRange(data.filterGroup.yearRange, 'carspec.year');\n\n    if (notEmptyLength(data.filterGroup.yearRange)) {\n      andFilter.$and = [...andFilter.$and, ...data.filterGroup.yearRange];\n      data.filterGroup = Object.assign(data.filterGroup, andFilter);\n    }\n\n    delete data.filterGroup.yearRange;\n  }\n\n  if (notEmptyLength(data.filterGroup) && notEmptyLength(data.filterGroup.priceRange)) {\n    data.filterGroup.priceRange = convertToRangeFormat(data.filterGroup.priceRange);\n    data.filterGroup.priceRange = convertFilterRange(data.filterGroup.priceRange, 'searchPrice');\n\n    if (notEmptyLength(data.filterGroup.priceRange)) {\n      andFilter.$and = [...andFilter.$and, ...data.filterGroup.priceRange];\n      data.filterGroup = Object.assign(data.filterGroup, andFilter);\n    }\n\n    delete data.filterGroup.priceRange;\n  }\n\n  if (notEmptyLength(data.filterGroup) && notEmptyLength(data.filterGroup.mileageRange)) {\n    data.filterGroup.mileageRange = convertToRangeFormat(data.filterGroup.mileageRange);\n    data.filterGroup.mileageRange = convertFilterRange(data.filterGroup.mileageRange, 'mileageFilter');\n\n    if (notEmptyLength(data.filterGroup.mileageRange)) {\n      andFilter.$and = [...andFilter.$and, ...data.filterGroup.mileageRange];\n      data.filterGroup = Object.assign(data.filterGroup, andFilter);\n    }\n\n    delete data.filterGroup.mileageRange;\n  }\n\n  if (notEmptyLength(data.filterGroup) && notEmptyLength(data.filterGroup.engineCapacityRange)) {\n    data.filterGroup.engineCapacityRange = convertToRangeFormat(data.filterGroup.engineCapacityRange);\n    data.filterGroup.engineCapacityRange = convertFilterRange(data.filterGroup.engineCapacityRange, 'carspec.engineCapacity');\n\n    if (notEmptyLength(data.filterGroup.engineCapacityRange)) {\n      andFilter.$and = [...andFilter.$and, ...data.filterGroup.engineCapacityRange];\n      data.filterGroup = Object.assign(data.filterGroup, andFilter);\n    }\n\n    delete data.filterGroup.engineCapacityRange;\n  }\n\n  data.filterGroup = objectRemoveEmptyValue(data.filterGroup);\n  let match = {\n    $match: _objectSpread({}, data.filterGroup)\n  };\n  return await axios.get(`${client.io.io.uri}carAdsFilterV3`, {\n    params: {\n      match,\n      sorting: data.config.sorting,\n      limit: limit,\n      skip: (data.config.page - 1) * limit\n    }\n  }).then(res => {\n    return res.data;\n  }).catch(err => {\n    return {};\n  });\n}","map":{"version":3,"sources":["/Users/faraheen/ccar-cms-next-mobile/api/carAdsFilter.js"],"names":["_","axios","client","isValidNumber","notEmptyLength","convertToRangeFormat","convertRangeFormatBack","convertFilterRange","objectRemoveEmptyValue","PAGESIZE","distinctArr","value","index","self","indexOf","data","limit","isPlainObject","has","filterGroup","cloneDeep","config","page","sorting","parseInt","get","andFilter","$and","isArray","isEmpty","yearRange","Object","assign","priceRange","mileageRange","engineCapacityRange","match","$match","io","uri","params","skip","then","res","catch","err"],"mappings":"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","sourcesContent":["import _ from 'lodash'\nimport axios from 'axios';\nimport client from '../feathers'\nimport { isValidNumber, notEmptyLength, convertToRangeFormat, convertRangeFormatBack, convertFilterRange, objectRemoveEmptyValue } from '../common-function';\n\nconst PAGESIZE = 30;\nconst distinctArr = (value, index, self) => {\n  return self.indexOf(value) === index\n}\n\nexport default async function (data, limit) {\n\n  if (!_.isPlainObject(data)) {\n    data = {};\n  }\n\n  if (!_.has(data, ['filterGroup'])) {\n    data.filterGroup = {};\n  } else {\n    data.filterGroup = _.cloneDeep(data.filterGroup)\n  }\n\n  if (!_.has(data, ['config'])) {\n    data.config = {\n      page: 1,\n      sorting: {},\n    };\n  }\n\n  if (!isValidNumber(parseInt(limit))) {\n    limit = PAGESIZE;\n  }\n\n  if (!isValidNumber(parseInt(data.config.page))) {\n    data.config.page = 1;\n  }\n\n  if (!_.get(data.config, ['sorting', 'carspec.year']) && !_.get(data.config, ['sorting', 'mileageFilter']) && !_.get(data.config, ['sorting', 'searchPrice'])) {\n    data.config.sorting = {};\n  }\n\n  let andFilter = { $and: [] }\n\n  if (_.isArray(data.filterGroup.$and) && !_.isEmpty(data.filterGroup.$and)) {\n    andFilter.$and = [...data.filterGroup.$and];\n  }\n\n  if (notEmptyLength(data.filterGroup) && notEmptyLength(data.filterGroup.yearRange)) {\n    data.filterGroup.yearRange = convertToRangeFormat(data.filterGroup.yearRange);\n    data.filterGroup.yearRange = convertFilterRange(data.filterGroup.yearRange, 'carspec.year')\n    if (notEmptyLength(data.filterGroup.yearRange)) {\n      andFilter.$and = [...andFilter.$and, ...data.filterGroup.yearRange]\n      data.filterGroup = Object.assign(data.filterGroup, andFilter)\n    }\n    delete data.filterGroup.yearRange;\n  }\n\n  if (notEmptyLength(data.filterGroup) && notEmptyLength(data.filterGroup.priceRange)) {\n    data.filterGroup.priceRange = convertToRangeFormat(data.filterGroup.priceRange);\n    data.filterGroup.priceRange = convertFilterRange(data.filterGroup.priceRange, 'searchPrice')\n    if (notEmptyLength(data.filterGroup.priceRange)) {\n      andFilter.$and = [...andFilter.$and, ...data.filterGroup.priceRange]\n      data.filterGroup = Object.assign(data.filterGroup, andFilter)\n    }\n    delete data.filterGroup.priceRange;\n  }\n\n  if (notEmptyLength(data.filterGroup) && notEmptyLength(data.filterGroup.mileageRange)) {\n    data.filterGroup.mileageRange = convertToRangeFormat(data.filterGroup.mileageRange);\n    data.filterGroup.mileageRange = convertFilterRange(data.filterGroup.mileageRange, 'mileageFilter')\n    if (notEmptyLength(data.filterGroup.mileageRange)) {\n      andFilter.$and = [...andFilter.$and, ...data.filterGroup.mileageRange]\n      data.filterGroup = Object.assign(data.filterGroup, andFilter)\n    }\n    delete data.filterGroup.mileageRange;\n  }\n\n  if (notEmptyLength(data.filterGroup) && notEmptyLength(data.filterGroup.engineCapacityRange)) {\n    data.filterGroup.engineCapacityRange = convertToRangeFormat(data.filterGroup.engineCapacityRange);\n    data.filterGroup.engineCapacityRange = convertFilterRange(data.filterGroup.engineCapacityRange, 'carspec.engineCapacity')\n    if (notEmptyLength(data.filterGroup.engineCapacityRange)) {\n      andFilter.$and = [...andFilter.$and, ...data.filterGroup.engineCapacityRange]\n      data.filterGroup = Object.assign(data.filterGroup, andFilter)\n    }\n    delete data.filterGroup.engineCapacityRange;\n  }\n\n\n  data.filterGroup = objectRemoveEmptyValue(data.filterGroup);\n  let match = { $match: { ...data.filterGroup } }\n  return await axios.get(`${client.io.io.uri}carAdsFilterV3`,\n    {\n      params: {\n        match,\n        sorting: data.config.sorting,\n        limit: limit,\n        skip: (data.config.page - 1) * limit,\n      }\n    }\n  ).then((res) => {\n    return res.data;\n  })\n    .catch((err) => {\n      return {};\n    })\n\n}"]},"metadata":{},"sourceType":"module"}