{"ast":null,"code":"import _ from 'lodash';\nimport { isValidNumber, toCamelCase, notEmptyLength, getTopItems } from '../../common-function';\nexport const testStreamUrl = 'https://stream-uat2.ccar.my';\nexport const liveStreamUrl = 'https://stream.ccar.my';\nexport function getStreamUrl(url) {\n  let stream = testStreamUrl;\n\n  if (url === 'http://localhost:3030/') {\n    stream = 'http://localhost:3030';\n  } else if (url === 'https://uat2-api.ccar.my/') {\n    stream = testStreamUrl;\n  } else if (url === 'https://api.ccar.my/') {\n    stream = liveStreamUrl;\n  } else if (url === 'https://preprod-api.ccar.my/') {\n    stream = testStreamUrl;\n  } else {\n    stream = 'http://localhost:3030';\n  } //default testing\n  // return 'http://192.168.0.191:7070/';\n  // return \"https://stream-uat2.ccar.my\";\n  // return 'http://localhost:7070/';\n  // return 'http://192.168.0.149:3041/';\n\n\n  return stream;\n}\nconst gifts = [{\n  name: 'kopi-ice',\n  price: 10\n}, {\n  name: 'white-rice',\n  price: 10\n}, {\n  name: 'roti-canai',\n  price: 20\n}, {\n  name: 'nasi-lemak',\n  price: 20\n}, {\n  name: 'nasi-kandar',\n  price: 50\n}, {\n  name: 'ramly-burger',\n  price: 50\n}, {\n  name: 'dimsum',\n  price: 100\n}, {\n  name: 'biryani',\n  price: 100\n}];\nexport const defaultReactions = ['like', 'heart', 'laughing', 'crying', 'angry', 'sleeping', 'rollingEye'];\nexport const defaultReactionsAnimation = ['none', 'least', 'less', 'normal', 'more', 'most'];\nlet temp = {};\n\n_.forEach(defaultReactions, function (react) {\n  temp[`${react}Gif`] = `/assets/live/${react}.gif`;\n});\n\nexport const reactionGif = temp;\ntemp = [];\ntemp = _.map(gifts, function (gift) {\n  gift.icon = `/assets/live/${gift.name}.png`;\n  gift.name = toCamelCase(gift.name, '-');\n  return gift;\n});\nexport const defaultGifts = temp;\nexport const liveIcon = '/assets/live/live.png';\nexport const supportIcon = '/assets/live/support.png';\nexport const likeIcon = '/assets/live/like.png';\nexport const commentIcon = '/assets/live/comment.png';\nexport const shareIcon = '/assets/live/share.png';\nexport const giftGif = '/assets/live/gift.gif';\nexport const ccoinIcon = '/assets/live/ccoin.png';\nexport const reactionAnimationTransitions = generateRandomTransition(30, 400, 4, 4);\nexport const LIVE_TEXT_TEMPLATE = {\n  'client-joined': 'has joined',\n  'client-left': 'has left',\n  'client-text': '',\n  'dealer-text': '',\n  \"anonymous-joined\": 'has joined',\n  \"anonymous-left\": 'has left'\n};\nexport function generateRandomTransition(maxTransitionX, maxTransitionY, eachTransitionLength, group) {\n  let reactionAnimationTransitionsTemp = [];\n  let eachTransition = [];\n\n  if (!isValidNumber(maxTransitionX)) {\n    maxTransitionX = 30;\n  } else {\n    maxTransitionX = parseInt(maxTransitionX);\n  }\n\n  if (!isValidNumber(maxTransitionY)) {\n    maxTransitionY = 400;\n  } else {\n    maxTransitionY = parseInt(maxTransitionY);\n  }\n\n  if (!isValidNumber(eachTransitionLength) || parseInt(eachTransitionLength) < 4) {\n    eachTransitionLength = 4;\n  } else {\n    eachTransitionLength = parseInt(eachTransitionLength);\n  }\n\n  if (!isValidNumber(group) || parseInt(group) < 0) {\n    group = 0;\n  } else {\n    group = parseInt(group);\n  }\n\n  _.forEach(_.range(group), function (index) {\n    eachTransition.push({\n      x: 0,\n      y: 0\n    });\n\n    _.forEach(_.range(eachTransitionLength - 2), function (index1) {\n      eachTransition.push({\n        x: _.random(-maxTransitionX, maxTransitionX, false),\n        y: -(maxTransitionY / (eachTransitionLength - index1))\n      });\n    });\n\n    eachTransition.push({\n      x: 0,\n      y: -maxTransitionY\n    });\n    reactionAnimationTransitionsTemp.push(eachTransition);\n    eachTransition = [];\n  });\n\n  return reactionAnimationTransitionsTemp;\n}\nexport function getTotalReactions(reactions) {\n  if (_.isArray(reactions) && notEmptyLength(reactions)) {\n    let total = 0;\n\n    _.forEach(reactions, function (reaction) {\n      if (!_.isNaN(parseInt(reaction.total))) {\n        total += parseInt(reaction.total);\n      }\n    });\n\n    return total;\n  } else {\n    return 0;\n  }\n}\nexport function getTopReactions(reactions, rank) {\n  if (_.isArray(reactions) && notEmptyLength(reactions)) {\n    if (!isValidNumber(rank)) {\n      rank = 3;\n    } else {\n      rank = parseInt(rank);\n    } //filter out reaction not in list\n\n\n    let filteredData = _.compact(_.map(reactions, function (reaction) {\n      if (_.indexOf(defaultReactions, reaction.type) != -1 && isValidNumber(reaction.total)) {\n        return reaction;\n      } else {\n        return null;\n      }\n    })); //get top reactions\n\n\n    filteredData = getTopItems(filteredData, rank, 'total');\n    return filteredData;\n  } else {\n    return 0;\n  }\n}\nexport function createOffer(socket, broadcaster) {\n  if (!!broadcaster && !!socket) {\n    const pc_config = {\n      iceServers: [{\n        urls: [\"stun:ss-turn2.xirsys.com\"]\n      }, {\n        username: \"K7RYJQ0iO86IzU-paa6guXxfLJ7vXWhFwfWzE3X88-LOsT0QN4vquwAUx1vsJJmqAAAAAF-yezBjY2FyMzEzMQ==\",\n        credential: \"a5e31b16-280d-11eb-89e3-0242ac140004\",\n        urls: [\"turn:ss-turn2.xirsys.com:80?transport=udp\", \"turn:ss-turn2.xirsys.com:3478?transport=udp\", \"turn:ss-turn2.xirsys.com:80?transport=tcp\", \"turn:ss-turn2.xirsys.com:3478?transport=tcp\", \"turns:ss-turn2.xirsys.com:443?transport=tcp\", \"turns:ss-turn2.xirsys.com:5349?transport=tcp\"]\n      }]\n    };\n    broadcaster.peerConnection = new RTCPeerConnection(pc_config);\n    broadcaster.peerConnection.createOffer({\n      offerToReceiveVideo: 1,\n      //for audio\n      offerToReceiveAudio: 1\n    }).then(sdp => {\n      broadcaster.peerConnection.setLocalDescription(sdp);\n      sendToPeer(socket, 'clientRequestVideoWithDealerSocketId', {\n        sdp,\n        dealerSocketId: broadcaster.dealerSocketId\n      });\n      return broadcaster;\n    }).catch(x => {\n      console.log('offer failed');\n      return null;\n    });\n  } else {\n    return null;\n  }\n}\nexport function sendToPeer(socket, messageType, payload) {\n  if (!!socket) {\n    socket.emit(messageType, {\n      senderId: socket.id,\n      payload\n    });\n  }\n}\nexport function closeThePeerConnection(socket, peerConnection, previousDealerSocketId) {\n  if (!!peerConnection && !!socket && !!previousDealerSocketId) {\n    peerConnection.close();\n    socket.emit('closeClientSocket', previousDealerSocketId);\n  }\n}\nexport function syncReactionSummary(reactionLogs) {\n  let reactionSummary = _.map(defaultReactions, function (reaction) {\n    return {\n      type: reaction,\n      total: 0\n    };\n  });\n\n  if (_.isArray(reactionLogs) && notEmptyLength(reactionLogs)) {\n    reactionSummary = _.map(reactionSummary, function (summary) {\n      let logs = _.filter(reactionLogs, ['type', summary.type]);\n\n      let total = 0;\n\n      _.forEach(logs, function (log) {\n        total += log.total;\n      });\n\n      return {\n        type: summary.type,\n        total: total\n      };\n    });\n  }\n\n  return reactionSummary;\n}","map":{"version":3,"sources":["/Users/faraheen/ccar-cms-next-mobile/components/live/config.js"],"names":["_","isValidNumber","toCamelCase","notEmptyLength","getTopItems","testStreamUrl","liveStreamUrl","getStreamUrl","url","stream","gifts","name","price","defaultReactions","defaultReactionsAnimation","temp","forEach","react","reactionGif","map","gift","icon","defaultGifts","liveIcon","supportIcon","likeIcon","commentIcon","shareIcon","giftGif","ccoinIcon","reactionAnimationTransitions","generateRandomTransition","LIVE_TEXT_TEMPLATE","maxTransitionX","maxTransitionY","eachTransitionLength","group","reactionAnimationTransitionsTemp","eachTransition","parseInt","range","index","push","x","y","index1","random","getTotalReactions","reactions","isArray","total","reaction","isNaN","getTopReactions","rank","filteredData","compact","indexOf","type","createOffer","socket","broadcaster","pc_config","iceServers","urls","username","credential","peerConnection","RTCPeerConnection","offerToReceiveVideo","offerToReceiveAudio","then","sdp","setLocalDescription","sendToPeer","dealerSocketId","catch","console","log","messageType","payload","emit","senderId","id","closeThePeerConnection","previousDealerSocketId","close","syncReactionSummary","reactionLogs","reactionSummary","summary","logs","filter"],"mappings":"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","sourcesContent":["\n\nimport _ from 'lodash';\nimport { isValidNumber, toCamelCase, notEmptyLength, getTopItems  } from '../../common-function';\n\n\nexport const testStreamUrl = 'https://stream-uat2.ccar.my';\nexport const liveStreamUrl = 'https://stream.ccar.my';\n\nexport function getStreamUrl(url){\n\n    let stream = testStreamUrl;\n    if (url==='http://localhost:3030/'){stream = 'http://localhost:3030'}\n    else if (url==='https://uat2-api.ccar.my/'){stream = testStreamUrl}\n    else if (url==='https://api.ccar.my/'){stream = liveStreamUrl}\n    else if (url==='https://preprod-api.ccar.my/'){stream = testStreamUrl}\n    else  {stream = 'http://localhost:3030'} //default testing\n    \n    // return 'http://192.168.0.191:7070/';\n    // return \"https://stream-uat2.ccar.my\";\n    // return 'http://localhost:7070/';\n    // return 'http://192.168.0.149:3041/';\n    return stream;\n}\n\n\nconst gifts = [\n    {\n        name: 'kopi-ice',\n        price: 10,\n    },\n    {\n        name: 'white-rice',\n        price: 10,\n    },\n    {\n        name: 'roti-canai',\n        price: 20,\n    },\n    {\n        name: 'nasi-lemak',\n        price: 20,\n    },\n    {\n        name: 'nasi-kandar',\n        price: 50,\n    },\n    {\n        name: 'ramly-burger',\n        price: 50,\n    },\n    {\n        name: 'dimsum',\n        price: 100,\n    },\n    {\n        name: 'biryani',\n        price: 100,\n    },\n];\nexport const defaultReactions = ['like', 'heart', 'laughing', 'crying', 'angry', 'sleeping', 'rollingEye'];\nexport const defaultReactionsAnimation = ['none', 'least', 'less', 'normal', 'more', 'most'];\n\n\nlet temp = {};\n_.forEach(defaultReactions, function (react) {\n    temp[`${react}Gif`] = `/assets/live/${react}.gif`;\n})\n\nexport const reactionGif = temp;\n\n\ntemp = [];\ntemp = _.map(gifts, function (gift) {\n    gift.icon = `/assets/live/${gift.name}.png`;\n    gift.name = toCamelCase(gift.name, '-');\n    return gift;\n})\nexport const defaultGifts = temp;\n\nexport const liveIcon = '/assets/live/live.png';\nexport const supportIcon = '/assets/live/support.png';\nexport const likeIcon = '/assets/live/like.png';\nexport const commentIcon = '/assets/live/comment.png';\nexport const shareIcon = '/assets/live/share.png';\nexport const giftGif = '/assets/live/gift.gif';\nexport const ccoinIcon = '/assets/live/ccoin.png';\n\n\nexport const reactionAnimationTransitions = generateRandomTransition(30, 400, 4, 4);\n\nexport const LIVE_TEXT_TEMPLATE = {\n    'client-joined': 'has joined',\n    'client-left': 'has left',\n    'client-text': '', \n    'dealer-text': '',\n    \"anonymous-joined\": 'has joined',\n    \"anonymous-left\":'has left',\n  }\n\nexport function generateRandomTransition(maxTransitionX, maxTransitionY, eachTransitionLength, group) {\n\n    let reactionAnimationTransitionsTemp = [];\n    let eachTransition = [];\n\n    if (!isValidNumber(maxTransitionX)) {\n        maxTransitionX = 30;\n    } else {\n        maxTransitionX = parseInt(maxTransitionX);\n    }\n\n    if (!isValidNumber(maxTransitionY)) {\n        maxTransitionY = 400;\n    } else {\n        maxTransitionY = parseInt(maxTransitionY);\n    }\n\n    if (!isValidNumber(eachTransitionLength) || parseInt(eachTransitionLength) < 4) {\n        eachTransitionLength = 4;\n    } else {\n        eachTransitionLength = parseInt(eachTransitionLength);\n    }\n\n    if (!isValidNumber(group) || parseInt(group) < 0) {\n        group = 0;\n    } else {\n        group = parseInt(group);\n    }\n\n    _.forEach(_.range(group), function (index) {\n        eachTransition.push({ x: 0, y: 0 });\n        _.forEach(_.range(eachTransitionLength - 2), function (index1) {\n            eachTransition.push({ x: _.random(-maxTransitionX, maxTransitionX, false), y: -(maxTransitionY / (eachTransitionLength - index1)) });\n        })\n        eachTransition.push({ x: 0, y: -maxTransitionY });\n        reactionAnimationTransitionsTemp.push(eachTransition);\n        eachTransition = [];\n    })\n\n    return reactionAnimationTransitionsTemp;\n}\n\n\nexport function getTotalReactions(reactions) {\n\n\n    if (_.isArray(reactions) && notEmptyLength(reactions)) {\n        let total = 0;\n        _.forEach(reactions, function (reaction) {\n            if (!_.isNaN(parseInt(reaction.total))) {\n                total += parseInt(reaction.total);\n            }\n        })\n\n        return total;\n    } else {\n        return 0;\n    }\n}\n\nexport function getTopReactions(reactions, rank) {\n\n    if (_.isArray(reactions) && notEmptyLength(reactions)) {\n        if (!isValidNumber(rank)) {\n            rank = 3;\n        } else {\n            rank = parseInt(rank);\n        }\n\n        //filter out reaction not in list\n        let filteredData = _.compact(_.map(reactions, function (reaction) {\n            if (_.indexOf(defaultReactions, reaction.type) != -1 && isValidNumber(reaction.total)) {\n                return reaction;\n            } else {\n                return null;\n            }\n        }));\n\n        //get top reactions\n        filteredData = getTopItems(filteredData, rank, 'total');\n        return filteredData;\n    } else {\n        return 0;\n    }\n}\n\nexport function createOffer(socket, broadcaster) {\n\n    if (!!broadcaster && !!socket) {\n\n        const pc_config = {\n            iceServers: [{\n              urls: [ \"stun:ss-turn2.xirsys.com\" ]\n              }, {\n              username: \"K7RYJQ0iO86IzU-paa6guXxfLJ7vXWhFwfWzE3X88-LOsT0QN4vquwAUx1vsJJmqAAAAAF-yezBjY2FyMzEzMQ==\",\n              credential: \"a5e31b16-280d-11eb-89e3-0242ac140004\",\n              urls: [\n                  \"turn:ss-turn2.xirsys.com:80?transport=udp\",\n                  \"turn:ss-turn2.xirsys.com:3478?transport=udp\",\n                  \"turn:ss-turn2.xirsys.com:80?transport=tcp\",\n                  \"turn:ss-turn2.xirsys.com:3478?transport=tcp\",\n                  \"turns:ss-turn2.xirsys.com:443?transport=tcp\",\n                  \"turns:ss-turn2.xirsys.com:5349?transport=tcp\"\n              ]\n           }]\n          }\n\n        broadcaster.peerConnection = new RTCPeerConnection(pc_config)\n\n        broadcaster.peerConnection.createOffer({\n            offerToReceiveVideo: 1,\n            //for audio\n            offerToReceiveAudio: 1\n        })\n            .then(sdp => {\n                broadcaster.peerConnection.setLocalDescription(sdp);\n \n                sendToPeer(socket, 'clientRequestVideoWithDealerSocketId', { sdp, dealerSocketId: broadcaster.dealerSocketId });\n                return broadcaster;\n            }).catch(x => {\n \n                console.log('offer failed');\n                return null;\n            });\n\n    } else {\n        return null;\n    }\n}\n\nexport function sendToPeer(socket, messageType, payload) {\n\n    if (!!socket) {\n        socket.emit(messageType, {\n            senderId: socket.id,\n            payload\n        })\n    }\n}\n\nexport function closeThePeerConnection(socket, peerConnection, previousDealerSocketId) {\n    if (!!peerConnection && !!socket && !!previousDealerSocketId) {\n        peerConnection.close();\n        socket.emit('closeClientSocket', previousDealerSocketId);\n    }\n}\n\nexport function syncReactionSummary(reactionLogs) {\n    let reactionSummary = _.map(defaultReactions, function (reaction) {\n        return {\n            type: reaction,\n            total: 0,\n        }\n    });\n    if (_.isArray(reactionLogs) && notEmptyLength(reactionLogs)) {\n        reactionSummary = _.map(reactionSummary, function (summary) {\n\n            let logs = _.filter(reactionLogs, ['type', summary.type]);\n            let total = 0;\n            _.forEach(logs, function (log) {\n                total += log.total;\n            })\n\n            return {\n                type: summary.type,\n                total: total,\n            }\n        })\n    }\n\n    return reactionSummary;\n}\n"]},"metadata":{},"sourceType":"module"}